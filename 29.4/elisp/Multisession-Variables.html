<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 29.4.

Copyright Â© 1990-1996, 1998-2024 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Multisession Variables (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Multisession Variables (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Multisession Variables (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Variables.html" rel="up" title="Variables">
<link href="Generalized-Variables.html" rel="prev" title="Generalized Variables">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Multisession-Variables">
<div class="nav-panel">
<p>
Previous: <a href="Generalized-Variables.html" accesskey="p" rel="prev">Generalized Variables</a>, Up: <a href="Variables.html" accesskey="u" rel="up">Variables</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Multisession-Variables-1"><span>12.18 Multisession Variables<a class="copiable-link" href="#Multisession-Variables-1"> &para;</a></span></h3>

<a class="index-entry-id" id="index-multisession-variable"></a>
<p>When you set a variable to a value and then close Emacs and restart
it, that value won&rsquo;t be automatically restored.  Users usually set
normal variables in their startup files, or use Customize
(see <a class="pxref" href="Customization.html">Customization Settings</a>) to set user options permanently, and various
packages have various files where they store the data (e.g., Gnus
stores this in <samp class="file">.newsrc.eld</samp> and the URL library stores cookies
in <samp class="file">~/.emacs.d/url/cookies</samp>).
</p>
<p>For things in between these two extremes (i.e., configuration which
goes in the startup file, and massive application state that goes into
separate files), Emacs provides a facility to replicate data between
sessions called <em class="dfn">multisession variables</em>.  (This facility may not
be available on all systems.)  To give you an idea of how these are
meant to be used, here&rsquo;s a small example:
</p>
<div class="example lisp">
<div class="group"><pre class="lisp-preformatted">(define-multisession-variable foo 0)
(defun my-adder (num)
  (interactive &quot;nAdd number: &quot;)
  (setf (multisession-value foo)
        (+ (multisession-value foo) num))
  (message &quot;The new number is: %s&quot; (multisession-value foo)))
</pre></div></div>

<p>This defines the variable <code class="code">foo</code> and binds it to a special
multisession object which is initialized with the value &lsquo;<samp class="samp">0</samp>&rsquo; (if
the variable doesn&rsquo;t already exist from a previous session).  The
<code class="code">my-adder</code> command queries the user for a number, adds this to
the old (possibly saved value), and then saves the new value.
</p>
<p>This facility isn&rsquo;t meant to be used for huge data structures, but
should be performant for most values.
</p>
<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-define_002dmultisession_002dvariable"><span class="category-def">Macro: </span><span><strong class="def-name">define-multisession-variable</strong> <var class="def-var-arguments">name initial-value &amp;optional doc &amp;rest args</var><a class="copiable-link" href="#index-define_002dmultisession_002dvariable"> &para;</a></span></dt>
<dd><p>This macro defines <var class="var">name</var> as a multisession variable, and gives it
the <var class="var">initial-value</var> if this variable hasn&rsquo;t been assigned a value
earlier.  <var class="var">doc</var> is the doc string, and several keyword arguments can
be used in <var class="var">args</var>:
</p>
<dl class="table">
<dt><code class="code">:package <var class="var">package-symbol</var></code></dt>
<dd><p>This keyword says that a multisession variable belongs to the package
specified by <var class="var">package-symbol</var>.  The combination of
<var class="var">package-symbol</var> and <var class="var">name</var> has to be unique.  If
<var class="var">package-symbol</var> isn&rsquo;t given, this will default to the first
&ldquo;segment&rdquo; of the <var class="var">name</var> symbol&rsquo;s name, which is the part of its
name up to and excluding the first &lsquo;<samp class="samp">-</samp>&rsquo;.  For instance, if
<var class="var">name</var> is <code class="code">foo</code> and <var class="var">package-symbol</var> isn&rsquo;t given,
<var class="var">package-symbol</var> will default to <code class="code">foo</code>.
</p>
</dd>
<dt><a id="index-synchronized-multisession-variables"></a><span><code class="code">:synchronized <var class="var">bool</var></code><a class="copiable-link" href="#index-synchronized-multisession-variables"> &para;</a></span></dt>
<dd><p>Multisession variables can be <em class="dfn">synchronized</em> if <var class="var">bool</var> is
non-<code class="code">nil</code>.  This means that if there&rsquo;re two concurrent Emacs
instances running, and the other Emacs changes the multisession
variable <code class="code">foo</code>, the current Emacs instance will retrieve that
modified data when accessing the value.  If <var class="var">synchronized</var> is
<code class="code">nil</code> or missing, this won&rsquo;t happen, and the values in all
Emacs sessions using the variable will be independent of each other.
</p>
</dd>
<dt><code class="code">:storage <var class="var">storage</var></code></dt>
<dd><p>Use the specified <var class="var">storage</var> method.  This can be either
<code class="code">sqlite</code> (in Emacs compiled with SQLite support) or <code class="code">files</code>.
If not given, this defaults to the value of the
<code class="code">multisession-storage</code> variable, described below.
</p></dd>
</dl>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-multisession_002dvalue"><span class="category-def">Function: </span><span><strong class="def-name">multisession-value</strong> <var class="def-var-arguments">variable</var><a class="copiable-link" href="#index-multisession_002dvalue"> &para;</a></span></dt>
<dd><p>This function returns the current value of <var class="var">variable</var>.  If this
variable hasn&rsquo;t been accessed before in this Emacs session, or if it&rsquo;s
changed externally, it will be read in from external storage.  If not,
the current value in this session is returned as is.  It is an error
to call this function for a <var class="var">variable</var> that is not a multisession
variable.
</p>
<p>Values retrieved via <code class="code">multisession-value</code> may or may not be
<code class="code">eq</code> to each other, but they will always be <code class="code">equal</code>.
</p>
<p>This is a generalized variable (see <a class="pxref" href="Generalized-Variables.html">Generalized Variables</a>), so the
way to update such a variable is to say, for instance:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(setf (multisession-value foo-bar) 'zot)
</pre></div>

<p>Only Emacs Lisp values that have a readable print syntax
(see <a class="pxref" href="Printed-Representation.html">Printed Representation and Read Syntax</a>) can be saved this way.
</p>
<p>If the multisession variable is synchronized, setting it may update
the value first.  For instance:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(cl-incf (multisession-value foo-bar))
</pre></div>

<p>This first checks whether the value has changed in a different
Emacs instance, retrieves that value, and then adds 1 to that value and
stores it.  But note that this is done without locking, so if many
instances are updating the value at the same time, it&rsquo;s unpredictable
which instance &ldquo;wins&rdquo;.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-multisession_002ddelete"><span class="category-def">Function: </span><span><strong class="def-name">multisession-delete</strong> <var class="def-var-arguments">object</var><a class="copiable-link" href="#index-multisession_002ddelete"> &para;</a></span></dt>
<dd><p>This function deletes <var class="var">object</var> and its value from its persistent
storage.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-make_002dmultisession"><span class="category-def">Function: </span><span><strong class="def-name">make-multisession</strong><a class="copiable-link" href="#index-make_002dmultisession"> &para;</a></span></dt>
<dd><p>You can also make persistent values that aren&rsquo;t tied to a specific
variable, but are tied to an explicit package and key.
</p>
<div class="example">
<pre class="example-preformatted">(setq foo (make-multisession :package &quot;mail&quot;
                             :key &quot;friends&quot;))
(setf (multisession-value foo) 'everybody)
</pre></div>

<p>This supports the same keywords as
<code class="code">define-multisession-variable</code>, but also supports a
<code class="code">:initial-value</code> keyword, which specifies the default value.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-multisession_002dstorage"><span class="category-def">User Option: </span><span><strong class="def-name">multisession-storage</strong><a class="copiable-link" href="#index-multisession_002dstorage"> &para;</a></span></dt>
<dd><p>This variable controls how the multisession variables are stored.  It
value defaults to <code class="code">files</code>, which means that the values are stored
in a one-file-per-variable structure inside the directory specified by
<code class="code">multisession-directory</code>.  If this value is <code class="code">sqlite</code>
instead, the values are stored in an SQLite database; this is only
available if Emacs was built with SQLite support.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-multisession_002ddirectory"><span class="category-def">User Option: </span><span><strong class="def-name">multisession-directory</strong><a class="copiable-link" href="#index-multisession_002ddirectory"> &para;</a></span></dt>
<dd><p>The multisession variables are stored under this directory, which
defaults to <samp class="file">multisession/</samp> subdirectory of the
<code class="code">user-emacs-directory</code>, which is typically
<samp class="file">~/.emacs.d/multisession/</samp>.
</p></dd></dl>

<a class="index-entry-id" id="index-multisession_002dedit_002dmode"></a>
<dl class="first-deffn">
<dt class="deffn" id="index-list_002dmultisession_002dvalues"><span class="category-def">Command: </span><span><strong class="def-name">list-multisession-values</strong><a class="copiable-link" href="#index-list_002dmultisession_002dvalues"> &para;</a></span></dt>
<dd><p>This command pops up a buffer listing all the multisession variables,
and enters a special mode <code class="code">multisession-edit-mode</code> which allows
you to delete them and edit their values.
</p></dd></dl>
</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Generalized-Variables.html">Generalized Variables</a>, Up: <a href="Variables.html">Variables</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
