<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 29.1.

Copyright Â© 1990-1996, 1998-2023 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Creating Buffer-Local (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Creating Buffer-Local (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Creating Buffer-Local (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Buffer_002dLocal-Variables.html" rel="up" title="Buffer-Local Variables">
<link href="Default-Value.html" rel="next" title="Default Value">
<link href="Intro-to-Buffer_002dLocal.html" rel="prev" title="Intro to Buffer-Local">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span.r {font-family: initial; font-weight: normal; font-style: normal}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Creating-Buffer_002dLocal">
<div class="nav-panel">
<p>
Next: <a href="Default-Value.html" accesskey="n" rel="next">The Default Value of a Buffer-Local Variable</a>, Previous: <a href="Intro-to-Buffer_002dLocal.html" accesskey="p" rel="prev">Introduction to Buffer-Local Variables</a>, Up: <a href="Buffer_002dLocal-Variables.html" accesskey="u" rel="up">Buffer-Local Variables</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Creating-and-Deleting-Buffer_002dLocal-Bindings"><span>12.11.2 Creating and Deleting Buffer-Local Bindings<a class="copiable-link" href="#Creating-and-Deleting-Buffer_002dLocal-Bindings"> &para;</a></span></h4>

<dl class="first-deffn">
<dt class="deffn" id="index-make_002dlocal_002dvariable"><span class="category-def">Command: </span><span><strong class="def-name">make-local-variable</strong> <var class="def-var-arguments">variable</var><a class="copiable-link" href="#index-make_002dlocal_002dvariable"> &para;</a></span></dt>
<dd><p>This function creates a buffer-local binding in the current buffer for
<var class="var">variable</var> (a symbol).  Other buffers are not affected.  The value
returned is <var class="var">variable</var>.
</p>
<p>The buffer-local value of <var class="var">variable</var> starts out as the same value
<var class="var">variable</var> previously had.  If <var class="var">variable</var> was void, it remains
void.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">;; <span class="r">In buffer &lsquo;<samp class="samp">b1</samp>&rsquo;:</span>
(setq foo 5)                ; <span class="r">Affects all buffers.</span>
     &rArr; 5
</pre></div><div class="group"><pre class="example-preformatted">(make-local-variable 'foo)  ; <span class="r">Now it is local in &lsquo;<samp class="samp">b1</samp>&rsquo;.</span>
     &rArr; foo
</pre></div><div class="group"><pre class="example-preformatted">foo                         ; <span class="r">That did not change</span>
     &rArr; 5                   ;   <span class="r">the value.</span>
</pre></div><div class="group"><pre class="example-preformatted">(setq foo 6)                ; <span class="r">Change the value</span>
     &rArr; 6                   ;   <span class="r">in &lsquo;<samp class="samp">b1</samp>&rsquo;.</span>
</pre></div><div class="group"><pre class="example-preformatted">foo
     &rArr; 6
</pre></div><pre class="example-preformatted">

</pre><div class="group"><pre class="example-preformatted">;; <span class="r">In buffer &lsquo;<samp class="samp">b2</samp>&rsquo;, the value hasn&rsquo;t changed.</span>
(with-current-buffer &quot;b2&quot;
  foo)
     &rArr; 5
</pre></div></div>

<p>Making a variable buffer-local within a <code class="code">let</code>-binding for that
variable does not work reliably, unless the buffer in which you do this
is not current either on entry to or exit from the <code class="code">let</code>.  This is
because <code class="code">let</code> does not distinguish between different kinds of
bindings; it knows only which variable the binding was made for.
</p>
<p>It is an error to make a constant or a read-only variable
buffer-local.  See <a class="xref" href="Constant-Variables.html">Variables that Never Change</a>.
</p>
<p>If the variable is terminal-local (see <a class="pxref" href="Multiple-Terminals.html">Multiple Terminals</a>), this
function signals an error.  Such variables cannot have buffer-local
bindings as well.
</p>
<p><strong class="strong">Warning:</strong> do not use <code class="code">make-local-variable</code> for a hook
variable.  The hook variables are automatically made buffer-local as
needed if you use the <var class="var">local</var> argument to <code class="code">add-hook</code> or
<code class="code">remove-hook</code>.
</p></dd></dl>

<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-setq_002dlocal"><span class="category-def">Macro: </span><span><strong class="def-name">setq-local</strong> <var class="def-var-arguments">&amp;rest pairs</var><a class="copiable-link" href="#index-setq_002dlocal"> &para;</a></span></dt>
<dd><p><var class="var">pairs</var> is a list of variable and value pairs.  This macro creates
a buffer-local binding in the current buffer for each of the
variables, and gives them a buffer-local value.  It is equivalent to
calling <code class="code">make-local-variable</code> followed by <code class="code">setq</code> for each of
the variables.  The variables should be unquoted symbols.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(setq-local var1 &quot;value1&quot;
            var2 &quot;value2&quot;)
</pre></div>
</dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-make_002dvariable_002dbuffer_002dlocal"><span class="category-def">Command: </span><span><strong class="def-name">make-variable-buffer-local</strong> <var class="def-var-arguments">variable</var><a class="copiable-link" href="#index-make_002dvariable_002dbuffer_002dlocal"> &para;</a></span></dt>
<dd><p>This function marks <var class="var">variable</var> (a symbol) automatically
buffer-local, so that any subsequent attempt to set it will make it
local to the current buffer at the time.  Unlike
<code class="code">make-local-variable</code>, with which it is often confused, this
cannot be undone, and affects the behavior of the variable in all
buffers.
</p>
<p>A peculiar wrinkle of this feature is that binding the variable (with
<code class="code">let</code> or other binding constructs) does not create a buffer-local
binding for it.  Only setting the variable (with <code class="code">set</code> or
<code class="code">setq</code>), while the variable does not have a <code class="code">let</code>-style
binding that was made in the current buffer, does so.
</p>
<p>If <var class="var">variable</var> does not have a default value, then calling this
command will give it a default value of <code class="code">nil</code>.  If <var class="var">variable</var>
already has a default value, that value remains unchanged.
Subsequently calling <code class="code">makunbound</code> on <var class="var">variable</var> will result
in a void buffer-local value and leave the default value unaffected.
</p>
<p>The value returned is <var class="var">variable</var>.
</p>
<p>It is an error to make a constant or a read-only variable
buffer-local.  See <a class="xref" href="Constant-Variables.html">Variables that Never Change</a>.
</p>
<p><strong class="strong">Warning:</strong> Don&rsquo;t assume that you should use
<code class="code">make-variable-buffer-local</code> for user-option variables, simply
because users <em class="emph">might</em> want to customize them differently in
different buffers.  Users can make any variable local, when they wish
to.  It is better to leave the choice to them.
</p>
<p>The time to use <code class="code">make-variable-buffer-local</code> is when it is crucial
that no two buffers ever share the same binding.  For example, when a
variable is used for internal purposes in a Lisp program which depends
on having separate values in separate buffers, then using
<code class="code">make-variable-buffer-local</code> can be the best solution.
</p></dd></dl>

<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-defvar_002dlocal"><span class="category-def">Macro: </span><span><strong class="def-name">defvar-local</strong> <var class="def-var-arguments">variable value &amp;optional docstring</var><a class="copiable-link" href="#index-defvar_002dlocal"> &para;</a></span></dt>
<dd><p>This macro defines <var class="var">variable</var> as a variable with initial value
<var class="var">value</var> and <var class="var">docstring</var>, and marks it as automatically
buffer-local.  It is equivalent to calling <code class="code">defvar</code> followed by
<code class="code">make-variable-buffer-local</code>.  <var class="var">variable</var> should be an
unquoted symbol.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-local_002dvariable_002dp"><span class="category-def">Function: </span><span><strong class="def-name">local-variable-p</strong> <var class="def-var-arguments">variable &amp;optional buffer</var><a class="copiable-link" href="#index-local_002dvariable_002dp"> &para;</a></span></dt>
<dd><p>This returns <code class="code">t</code> if <var class="var">variable</var> is buffer-local in buffer
<var class="var">buffer</var> (which defaults to the current buffer); otherwise,
<code class="code">nil</code>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-local_002dvariable_002dif_002dset_002dp"><span class="category-def">Function: </span><span><strong class="def-name">local-variable-if-set-p</strong> <var class="def-var-arguments">variable &amp;optional buffer</var><a class="copiable-link" href="#index-local_002dvariable_002dif_002dset_002dp"> &para;</a></span></dt>
<dd><p>This returns <code class="code">t</code> if <var class="var">variable</var> either has a buffer-local
value in buffer <var class="var">buffer</var>, or is automatically buffer-local.
Otherwise, it returns <code class="code">nil</code>.  If omitted or <code class="code">nil</code>,
<var class="var">buffer</var> defaults to the current buffer.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-buffer_002dlocal_002dvalue"><span class="category-def">Function: </span><span><strong class="def-name">buffer-local-value</strong> <var class="def-var-arguments">variable buffer</var><a class="copiable-link" href="#index-buffer_002dlocal_002dvalue"> &para;</a></span></dt>
<dd><p>This function returns the buffer-local binding of <var class="var">variable</var> (a
symbol) in buffer <var class="var">buffer</var>.  If <var class="var">variable</var> does not have a
buffer-local binding in buffer <var class="var">buffer</var>, it returns the default
value (see <a class="pxref" href="Default-Value.html">The Default Value of a Buffer-Local Variable</a>) of <var class="var">variable</var> instead.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-buffer_002dlocal_002dboundp"><span class="category-def">Function: </span><span><strong class="def-name">buffer-local-boundp</strong> <var class="def-var-arguments">variable buffer</var><a class="copiable-link" href="#index-buffer_002dlocal_002dboundp"> &para;</a></span></dt>
<dd><p>This returns non-<code class="code">nil</code> if there&rsquo;s either a buffer-local binding
of <var class="var">variable</var> (a symbol) in buffer <var class="var">buffer</var>, or <var class="var">variable</var>
has a global binding.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-buffer_002dlocal_002dvariables"><span class="category-def">Function: </span><span><strong class="def-name">buffer-local-variables</strong> <var class="def-var-arguments">&amp;optional buffer</var><a class="copiable-link" href="#index-buffer_002dlocal_002dvariables"> &para;</a></span></dt>
<dd><p>This function returns a list describing the buffer-local variables in
buffer <var class="var">buffer</var>.  (If <var class="var">buffer</var> is omitted, the current buffer
is used.)  Normally, each list element has the form
<code class="code">(<var class="var">sym</var>&nbsp;.&nbsp;<var class="var">val</var>)</code><!-- /@w -->, where <var class="var">sym</var> is a buffer-local
variable (a symbol) and <var class="var">val</var> is its buffer-local value.  But when
a variable&rsquo;s buffer-local binding in <var class="var">buffer</var> is void, its list
element is just <var class="var">sym</var>.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(make-local-variable 'foobar)
(makunbound 'foobar)
(make-local-variable 'bind-me)
(setq bind-me 69)
</pre></div><pre class="example-preformatted">(setq lcl (buffer-local-variables))
    ;; <span class="r">First, built-in variables local in all buffers:</span>
&rArr; ((mark-active . nil)
    (buffer-undo-list . nil)
    (mode-name . &quot;Fundamental&quot;)
    ...
</pre><div class="group"><pre class="example-preformatted">    ;; <span class="r">Next, non-built-in buffer-local variables.</span>
    ;; <span class="r">This one is buffer-local and void:</span>
    foobar
    ;; <span class="r">This one is buffer-local and nonvoid:</span>
    (bind-me . 69))
</pre></div></div>

<p>Note that storing new values into the <small class="sc">CDR</small>s of cons cells in this
list does <em class="emph">not</em> change the buffer-local values of the variables.
</p></dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-kill_002dlocal_002dvariable"><span class="category-def">Command: </span><span><strong class="def-name">kill-local-variable</strong> <var class="def-var-arguments">variable</var><a class="copiable-link" href="#index-kill_002dlocal_002dvariable"> &para;</a></span></dt>
<dd><p>This function deletes the buffer-local binding (if any) for
<var class="var">variable</var> (a symbol) in the current buffer.  As a result, the
default binding of <var class="var">variable</var> becomes visible in this buffer.  This
typically results in a change in the value of <var class="var">variable</var>, since the
default value is usually different from the buffer-local value just
eliminated.
</p>
<p>If you kill the buffer-local binding of a variable that automatically
becomes buffer-local when set, this makes the default value visible in
the current buffer.  However, if you set the variable again, that will
once again create a buffer-local binding for it.
</p>
<p><code class="code">kill-local-variable</code> returns <var class="var">variable</var>.
</p>
<p>This function is a command because it is sometimes useful to kill one
buffer-local variable interactively, just as it is useful to create
buffer-local variables interactively.
</p></dd></dl>

<a class="index-entry-id" id="index-local-variables_002c-killed-by-major-mode"></a>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-kill_002dall_002dlocal_002dvariables"><span class="category-def">Function: </span><span><strong class="def-name">kill-all-local-variables</strong> <var class="def-var-arguments">&amp;optional kill-permanent</var><a class="copiable-link" href="#index-kill_002dall_002dlocal_002dvariables"> &para;</a></span></dt>
<dd><p>This function eliminates all the buffer-local variable bindings of the
current buffer.  As a result, the buffer will see the default values
of most variables.  By default, for variables marked as permanent and
local hook functions that have a non-<code class="code">nil</code>
<code class="code">permanent-local-hook</code> property (see <a class="pxref" href="Setting-Hooks.html">Setting Hooks</a>) won&rsquo;t be
killed, but if the optional <var class="var">kill-permanent</var> argument is
non-<code class="code">nil</code>, even these variables will be killed.
</p>
<p>This function also resets certain other information pertaining to the
buffer: it sets the local keymap to <code class="code">nil</code>, the syntax table to the
value of <code class="code">(standard-syntax-table)</code>, the case table to
<code class="code">(standard-case-table)</code>, and the abbrev table to the value of
<code class="code">fundamental-mode-abbrev-table</code>.
</p>
<p>The very first thing this function does is run the normal hook
<code class="code">change-major-mode-hook</code> (see below).
</p>
<p>Every major mode command begins by calling this function, which has the
effect of switching to Fundamental mode and erasing most of the effects
of the previous major mode.  To ensure that this does its job, the
variables that major modes set should not be marked permanent.
</p>
<p><code class="code">kill-all-local-variables</code> returns <code class="code">nil</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-change_002dmajor_002dmode_002dhook"><span class="category-def">Variable: </span><span><strong class="def-name">change-major-mode-hook</strong><a class="copiable-link" href="#index-change_002dmajor_002dmode_002dhook"> &para;</a></span></dt>
<dd><p>The function <code class="code">kill-all-local-variables</code> runs this normal hook
before it does anything else.  This gives major modes a way to arrange
for something special to be done if the user switches to a different
major mode.  It is also useful for buffer-specific minor modes
that should be forgotten if the user changes the major mode.
</p>
<p>For best results, make this variable buffer-local, so that it will
disappear after doing its job and will not interfere with the
subsequent major mode.  See <a class="xref" href="Hooks.html">Hooks</a>.
</p></dd></dl>

<a class="index-entry-id" id="index-permanent-local-variable"></a>
<p>A buffer-local variable is <em class="dfn">permanent</em> if the variable name (a
symbol) has a <code class="code">permanent-local</code> property that is non-<code class="code">nil</code>.
Such variables are unaffected by <code class="code">kill-all-local-variables</code>, and
their local bindings are therefore not cleared by changing major modes.
Permanent locals are appropriate for data pertaining to where the file
came from or how to save it, rather than with how to edit the contents.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Default-Value.html">The Default Value of a Buffer-Local Variable</a>, Previous: <a href="Intro-to-Buffer_002dLocal.html">Introduction to Buffer-Local Variables</a>, Up: <a href="Buffer_002dLocal-Variables.html">Buffer-Local Variables</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
