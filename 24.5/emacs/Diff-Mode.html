<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Manual,
updated for Emacs version 24.5.

Copyright Â© 1985-1987, 1993-2015 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Diff Mode (GNU Emacs Manual)</title>

<meta name="description" content="Diff Mode (GNU Emacs Manual)">
<meta name="keywords" content="Diff Mode (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Files.html" rel="up" title="Files">
<link href="Misc-File-Ops.html" rel="next" title="Misc File Ops">
<link href="Comparing-Files.html" rel="prev" title="Comparing Files">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Diff-Mode">
<div class="nav-panel">
<p>
Next: <a href="Misc-File-Ops.html" accesskey="n" rel="next">Miscellaneous File Operations</a>, Previous: <a href="Comparing-Files.html" accesskey="p" rel="prev">Comparing Files</a>, Up: <a href="Files.html" accesskey="u" rel="up">File Handling</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Diff-Mode-1"><span>18.10 Diff Mode<a class="copiable-link" href="#Diff-Mode-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-Diff-mode"></a>
<a class="index-entry-id" id="index-diff_002dmode"></a>
<a class="index-entry-id" id="index-patches_002c-editing"></a>

<p>Diff mode is a major mode used for the output of <kbd class="kbd">M-x diff</kbd> and
other similar commands.  This kind of output is called a <em class="dfn">patch</em>,
because it can be passed to the <code class="command">patch</code> command to
automatically apply the specified changes.  To select Diff mode
manually, type <kbd class="kbd">M-x diff-mode</kbd>.
</p>
<a class="index-entry-id" id="index-hunk_002c-diff"></a>
<p>The changes specified in a patch are grouped into <em class="dfn">hunks</em>, which
are contiguous chunks of text that contain one or more changed lines.
Hunks can also include unchanged lines to provide context for the
changes.  Each hunk is preceded by a <em class="dfn">hunk header</em>, which
specifies the old and new line numbers at which the hunk occurs.  Diff
mode highlights each hunk header, to distinguish it from the actual
contents of the hunk.
</p>
<a class="index-entry-id" id="index-diff_002dupdate_002don_002dthe_002dfly"></a>
<p>You can edit a Diff mode buffer like any other buffer.  (If it is
read-only, you need to make it writable first.  See <a class="xref" href="Misc-Buffer.html">Miscellaneous Buffer Operations</a>.)
Whenever you change a hunk, Diff mode attempts to automatically
correct the line numbers in the hunk headers, to ensure that the patch
remains &ldquo;correct&rdquo;.  To disable automatic line number correction,
change the variable <code class="code">diff-update-on-the-fly</code> to <code class="code">nil</code>.
</p>
<p>Diff mode treats each hunk as an &ldquo;error message&rdquo;, similar to
Compilation mode.  Thus, you can use commands such as <kbd class="kbd">C-x '</kbd> to
visit the corresponding source locations.  See <a class="xref" href="Compilation-Mode.html">Compilation Mode</a>.
</p>
<p>In addition, Diff mode provides the following commands to navigate,
manipulate and apply parts of patches:
</p>
<dl class="table">
<dt><a id="index-diff_002dhunk_002dnext"></a><span><kbd class="kbd">M-n</kbd><a class="copiable-link" href="#index-diff_002dhunk_002dnext"> &para;</a></span></dt>
<dd><p>Move to the next hunk-start (<code class="code">diff-hunk-next</code>).
</p>
<a class="index-entry-id" id="index-diff_002dauto_002drefine_002dmode"></a>
<a class="index-entry-id" id="index-mode_002c-Diff-Auto_002dRefine"></a>
<a class="index-entry-id" id="index-Diff-Auto_002dRefine-mode"></a>
<p>This command has a side effect: it <em class="dfn">refines</em> the hunk you move to,
highlighting its changes with better granularity.  To disable this
feature, type <kbd class="kbd">M-x diff-auto-refine-mode</kbd> to toggle off the minor
mode Diff Auto-Refine mode.  To disable Diff Auto Refine mode by
default, add this to your init file (see <a class="pxref" href="Hooks.html">Hooks</a>):
</p>
<div class="example">
<pre class="example-preformatted">(add-hook 'diff-mode-hook
          (lambda () (diff-auto-refine-mode -1)))
</pre></div>

</dd>
<dt><a id="index-diff_002dhunk_002dprev"></a><span><kbd class="kbd">M-p</kbd><a class="copiable-link" href="#index-diff_002dhunk_002dprev"> &para;</a></span></dt>
<dd><p>Move to the previous hunk-start (<code class="code">diff-hunk-prev</code>).  Like
<kbd class="kbd">M-n</kbd>, this has the side-effect of refining the hunk you move to,
unless you disable Diff Auto-Refine mode.
</p>
</dd>
<dt><a id="index-diff_002dfile_002dnext"></a><span><kbd class="kbd">M-}</kbd><a class="copiable-link" href="#index-diff_002dfile_002dnext"> &para;</a></span></dt>
<dd><p>Move to the next file-start, in a multi-file patch
(<code class="code">diff-file-next</code>).
</p>
</dd>
<dt><a id="index-diff_002dfile_002dprev"></a><span><kbd class="kbd">M-{</kbd><a class="copiable-link" href="#index-diff_002dfile_002dprev"> &para;</a></span></dt>
<dd><p>Move to the previous file-start, in a multi-file patch
(<code class="code">diff-file-prev</code>).
</p>
</dd>
<dt><a id="index-diff_002dhunk_002dkill"></a><span><kbd class="kbd">M-k</kbd><a class="copiable-link" href="#index-diff_002dhunk_002dkill"> &para;</a></span></dt>
<dd><p>Kill the hunk at point (<code class="code">diff-hunk-kill</code>).
</p>
</dd>
<dt><a id="index-diff_002dfile_002dkill"></a><span><kbd class="kbd">M-K</kbd><a class="copiable-link" href="#index-diff_002dfile_002dkill"> &para;</a></span></dt>
<dd><p>In a multi-file patch, kill the current file part.
(<code class="code">diff-file-kill</code>).
</p>
</dd>
<dt><a class="index-entry-id" id="index-patches_002c-applying"></a>
<a id="index-diff_002dapply_002dhunk"></a><span><kbd class="kbd">C-c C-a</kbd><a class="copiable-link" href="#index-diff_002dapply_002dhunk"> &para;</a></span></dt>
<dd><p>Apply this hunk to its target file (<code class="code">diff-apply-hunk</code>).  With a
prefix argument of <kbd class="kbd">C-u</kbd>, revert this hunk.
</p>
</dd>
<dt><a id="index-diff_002drefine_002dhunk"></a><span><kbd class="kbd">C-c C-b</kbd><a class="copiable-link" href="#index-diff_002drefine_002dhunk"> &para;</a></span></dt>
<dd><p>Highlight the changes of the hunk at point with a finer granularity
(<code class="code">diff-refine-hunk</code>).  This allows you to see exactly which parts
of each changed line were actually changed.
</p>
</dd>
<dt><a id="index-diff_002dgoto_002dsource"></a><span><kbd class="kbd">C-c C-c</kbd><a class="copiable-link" href="#index-diff_002dgoto_002dsource"> &para;</a></span></dt>
<dd><p>Go to the source file and line corresponding to this hunk
(<code class="code">diff-goto-source</code>).
</p>
</dd>
<dt><a id="index-diff_002dediff_002dpatch"></a><span><kbd class="kbd">C-c C-e</kbd><a class="copiable-link" href="#index-diff_002dediff_002dpatch"> &para;</a></span></dt>
<dd><p>Start an Ediff session with the patch (<code class="code">diff-ediff-patch</code>).
See <a data-manual="ediff" href="https://www.gnu.org/software/emacs/manual/html_node/ediff/index.html#Top">Ediff</a> in <cite class="cite">The Ediff Manual</cite>.
</p>
</dd>
<dt><a id="index-diff_002drestrict_002dview"></a><span><kbd class="kbd">C-c C-n</kbd><a class="copiable-link" href="#index-diff_002drestrict_002dview"> &para;</a></span></dt>
<dd><p>Restrict the view to the current hunk (<code class="code">diff-restrict-view</code>).
See <a class="xref" href="Narrowing.html">Narrowing</a>.  With a prefix argument of <kbd class="kbd">C-u</kbd>, restrict the
view to the current file of a multiple-file patch.  To widen again,
use <kbd class="kbd">C-x n w</kbd> (<code class="code">widen</code>).
</p>
</dd>
<dt><a id="index-diff_002dreverse_002ddirection"></a><span><kbd class="kbd">C-c C-r</kbd><a class="copiable-link" href="#index-diff_002dreverse_002ddirection"> &para;</a></span></dt>
<dd><p>Reverse the direction of comparison for the entire buffer
(<code class="code">diff-reverse-direction</code>).
</p>
</dd>
<dt><a id="index-diff_002dsplit_002dhunk"></a><span><kbd class="kbd">C-c C-s</kbd><a class="copiable-link" href="#index-diff_002dsplit_002dhunk"> &para;</a></span></dt>
<dd><p>Split the hunk at point (<code class="code">diff-split-hunk</code>).  This is for
manually editing patches, and only works with the <em class="dfn">unified diff
format</em> produced by the <samp class="option">-u</samp> or <samp class="option">--unified</samp> options to
the <code class="command">diff</code> program.  If you need to split a hunk in the
<em class="dfn">context diff format</em> produced by the <samp class="option">-c</samp> or
<samp class="option">--context</samp> options to <code class="command">diff</code>, first convert the buffer
to the unified diff format with <kbd class="kbd">C-c C-u</kbd>.
</p>
</dd>
<dt><a id="index-diff_002dunified_002d_003econtext"></a><span><kbd class="kbd">C-c C-d</kbd><a class="copiable-link" href="#index-diff_002dunified_002d_003econtext"> &para;</a></span></dt>
<dd><p>Convert the entire buffer to the <em class="dfn">context diff format</em>
(<code class="code">diff-unified-&gt;context</code>).  With a prefix argument, convert only
the text within the region.
</p>
</dd>
<dt><a id="index-diff_002dcontext_002d_003eunified"></a><span><kbd class="kbd">C-c C-u</kbd><a class="copiable-link" href="#index-diff_002dcontext_002d_003eunified"> &para;</a></span></dt>
<dd><p>Convert the entire buffer to unified diff format
(<code class="code">diff-context-&gt;unified</code>).  With a prefix argument, convert
unified format to context format.  When the mark is active, convert
only the text within the region.
</p>
</dd>
<dt><a id="index-diff_002drefine_002dhunk-1"></a><span><kbd class="kbd">C-c C-w</kbd><a class="copiable-link" href="#index-diff_002drefine_002dhunk-1"> &para;</a></span></dt>
<dd><p>Refine the current hunk so that it disregards changes in whitespace
(<code class="code">diff-refine-hunk</code>).
</p>
</dd>
<dt><a class="index-entry-id" id="index-add_002dchange_002dlog_002dentry_002dother_002dwindow_002c-in-Diff-mode"></a>
<a id="index-diff_002dadd_002dchange_002dlog_002dentries_002dother_002dwindow"></a><span><kbd class="kbd">C-x 4 A</kbd><a class="copiable-link" href="#index-diff_002dadd_002dchange_002dlog_002dentries_002dother_002dwindow"> &para;</a></span></dt>
<dd><p>Generate a ChangeLog entry, like <kbd class="kbd">C-x 4 a</kbd> does (see <a class="pxref" href="Change-Log.html">Change Logs</a>), for each one of the hunks
(<code class="code">diff-add-change-log-entries-other-window</code>).  This creates a
skeleton of the log of changes that you can later fill with the actual
descriptions of the changes.  <kbd class="kbd">C-x 4 a</kbd> itself in Diff mode
operates on behalf of the current hunk&rsquo;s file, but gets the function
name from the patch itself.  This is useful for making log entries for
functions that are deleted by the patch.
</p></dd>
</dl>

<a class="index-entry-id" id="index-trailing-whitespace_002c-in-patches"></a>
<a class="index-entry-id" id="index-diff_002ddelete_002dtrailing_002dwhitespace"></a>
<p>Patches sometimes include trailing whitespace on modified lines, as
an unintentional and undesired change.  There are two ways to deal
with this problem.  Firstly, if you enable Whitespace mode in a Diff
buffer (see <a class="pxref" href="Useless-Whitespace.html">Useless Whitespace</a>), it automatically highlights
trailing whitespace in modified lines.  Secondly, you can use the
command <kbd class="kbd">M-x diff-delete-trailing-whitespace</kbd>, which searches for
trailing whitespace in the lines modified by the patch, and removes
that whitespace in both the patch and the patched source file(s).
This command does not save the modifications that it makes, so you can
decide whether to save the changes (the list of modified files is
displayed in the echo area).  With a prefix argument, it tries to
modify the original source files rather than the patched source files.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Misc-File-Ops.html">Miscellaneous File Operations</a>, Previous: <a href="Comparing-Files.html">Comparing Files</a>, Up: <a href="Files.html">File Handling</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
