<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 26.2.

Copyright Â© 1990-1996, 1998-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Module Values (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Module Values (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Module Values (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Writing-Dynamic-Modules.html" rel="up" title="Writing Dynamic Modules">
<link href="Module-Misc.html" rel="next" title="Module Misc">
<link href="Module-Functions.html" rel="prev" title="Module Functions">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Module-Values">
<div class="nav-panel">
<p>
Next: <a href="Module-Misc.html" accesskey="n" rel="next">Miscellaneous Convenience Functions for Modules</a>, Previous: <a href="Module-Functions.html" accesskey="p" rel="prev">Writing Module Functions</a>, Up: <a href="Writing-Dynamic-Modules.html" accesskey="u" rel="up">Writing Dynamically-Loaded Modules</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Conversion-Between-Lisp-and-Module-Values"><span>E.8.3 Conversion Between Lisp and Module Values<a class="copiable-link" href="#Conversion-Between-Lisp-and-Module-Values"> &para;</a></span></h4>
<a class="index-entry-id" id="index-module-values_002c-conversion"></a>

<a class="index-entry-id" id="index-emacs_005fvalue-data-type"></a>
<p>With very few exceptions, most modules need to exchange data with
Lisp programs that call them: accept arguments to module functions and
return values from module functions.  For this purpose, the module
<abbr class="acronym">API</abbr> provides the <code class="code">emacs_value</code> type, which represents
Emacs Lisp objects communicated via the <abbr class="acronym">API</abbr>; it is the
functional equivalent of the <code class="code">Lisp_Object</code> type used in Emacs C
primitives (see <a class="pxref" href="Writing-Emacs-Primitives.html">Writing Emacs Primitives</a>).  This section describes
the parts of the module <abbr class="acronym">API</abbr> that allow to create
<code class="code">emacs_value</code> objects corresponding to basic Lisp data types, and
how to access from C data in <code class="code">emacs_value</code> objects that
correspond to Lisp objects.
</p>
<p>All of the functions described below are actually <em class="emph">function
pointers</em> provided via the pointer to the environment which every
module function accepts.  Therefore, module code should call these
functions through the environment pointer, like this:
</p>
<div class="example">
<pre class="example-preformatted">emacs_env *env;  /* the environment pointer */
env-&gt;some_function (arguments...);
</pre></div>

<p>The <code class="code">emacs_env</code> pointer will usually come from the first argument
to the module function, or from the call to <code class="code">get_environment</code> if
you need the environment in the module initialization function.
</p>
<p>Most of the functions described below became available in Emacs 25,
the first Emacs release that supported dynamic modules.  For the few
functions that became available in later Emacs releases, we mention
the first Emacs version that supported them.
</p>
<p>The following <abbr class="acronym">API</abbr> functions extract values of various C data
types from <code class="code">emacs_value</code> objects.  They all raise the
<code class="code">wrong-type-argument</code> error condition (see <a class="pxref" href="Type-Predicates.html">Type Predicates</a>)
if the argument <code class="code">emacs_value</code> object is not of the type expected
by the function.  See <a class="xref" href="Module-Nonlocal.html">Nonlocal Exits in Modules</a>, for details of how signaling
errors works in Emacs modules, and how to catch error conditions
inside the module before they are reported to Emacs.  The
<abbr class="acronym">API</abbr> function <code class="code">type_of</code> (see <a class="pxref" href="Module-Misc.html">type_of</a>)
can be used to obtain the type of a <code class="code">emacs_value</code> object.
</p>
<dl class="first-deftypefn">
<dt class="deftypefn" id="index-extract_005finteger"><span class="category-def">Function: </span><span><code class="def-type">intmax_t</code> <strong class="def-name">extract_integer</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">arg</var>)</code><a class="copiable-link" href="#index-extract_005finteger"> &para;</a></span></dt>
<dd><p>This function returns the value of a Lisp integer specified by
<var class="var">arg</var>.  The C data type of the return value, <code class="code">intmax_t</code>, is
the widest integral data type supported by the C compiler, typically
<code class="code">long&nbsp;long</code><!-- /@w -->.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-extract_005ffloat"><span class="category-def">Function: </span><span><code class="def-type">double</code> <strong class="def-name">extract_float</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">arg</var>)</code><a class="copiable-link" href="#index-extract_005ffloat"> &para;</a></span></dt>
<dd><p>This function returns the value of a Lisp float specified by
<var class="var">arg</var>, as a C <code class="code">double</code> value.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-copy_005fstring_005fcontents"><span class="category-def">Function: </span><span><code class="def-type">bool</code> <strong class="def-name">copy_string_contents</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">arg</var>, char *<var class="var">buf</var>, ptrdiff_t *<var class="var">len</var>)</code><a class="copiable-link" href="#index-copy_005fstring_005fcontents"> &para;</a></span></dt>
<dd><p>This function stores the UTF-8 encoded text of a Lisp string specified
by <var class="var">arg</var> in the array of <code class="code">char</code> pointed by <var class="var">buf</var>, which
should have enough space to hold at least <code class="code">*<var class="var">len</var></code> bytes,
including the terminating null byte.  The argument <var class="var">len</var> must not
be a <code class="code">NULL</code> pointer, and, when the function is called, it should
point to a value that specifies the size of <var class="var">buf</var> in bytes.
</p>
<p>If the buffer size specified by <code class="code">*<var class="var">len</var></code> is large enough to
hold the string&rsquo;s text, the function stores in <code class="code">*<var class="var">len</var></code> the
actual number of bytes copied to <var class="var">buf</var>, including the terminating
null byte, and returns <code class="code">true</code>.  If the buffer is too small, the
function raises the <code class="code">args-out-of-range</code> error condition, stores
the required number of bytes in <code class="code">*<var class="var">len</var></code>, and returns
<code class="code">false</code>.  See <a class="xref" href="Module-Nonlocal.html">Nonlocal Exits in Modules</a>, for how to handle pending error
conditions.
</p>
<p>The argument <var class="var">buf</var> can be a <code class="code">NULL</code> pointer, in which case the
function stores in <code class="code">*<var class="var">len</var></code> the number of bytes required for
storing the contents of <var class="var">arg</var>, and returns <code class="code">true</code>.  This is
how you can determine the size of <var class="var">buf</var> needed to store a
particular string: first call <code class="code">copy_string_contents</code> with
<code class="code">NULL</code> as <var class="var">buf</var>, then allocate enough memory to hold the
number of bytes stored by the function in <code class="code">*<var class="var">len</var></code>, and call
the function again with non-<code class="code">NULL</code> <var class="var">buf</var> to actually perform
the text copying.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-vec_005fget"><span class="category-def">Function: </span><span><code class="def-type">emacs_value</code> <strong class="def-name">vec_get</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">vector</var>, ptrdiff_t <var class="var">index</var>)</code><a class="copiable-link" href="#index-vec_005fget"> &para;</a></span></dt>
<dd><p>This function returns the element of <var class="var">vector</var> at <var class="var">index</var>.  The
<var class="var">index</var> of the first vector element is zero.  The function raises
the <code class="code">args-out-of-range</code> error condition if the value of
<var class="var">index</var> is invalid.  To extract C data from the value the function
returns, use the other extraction functions described here, as
appropriate for the Lisp data type stored in that element of the
vector.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-vec_005fsize"><span class="category-def">Function: </span><span><code class="def-type">ptrdiff_t</code> <strong class="def-name">vec_size</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">vector</var>)</code><a class="copiable-link" href="#index-vec_005fsize"> &para;</a></span></dt>
<dd><p>This function returns the number of elements in <var class="var">vector</var>.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-vec_005fset"><span class="category-def">Function: </span><span><code class="def-type">void</code> <strong class="def-name">vec_set</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">vector</var>, ptrdiff_t <var class="var">index</var>, emacs_value <var class="var">value</var>)</code><a class="copiable-link" href="#index-vec_005fset"> &para;</a></span></dt>
<dd><p>This function stores <var class="var">value</var> in the element of <var class="var">vector</var> whose
index is <var class="var">index</var>.  It raises the <code class="code">args-out-of-range</code> error
condition if the value of <var class="var">index</var> is invalid.
</p></dd></dl>

<p>The following <abbr class="acronym">API</abbr> functions create <code class="code">emacs_value</code>
objects from basic C data types.  They all return the created
<code class="code">emacs_value</code> object.
</p>
<dl class="first-deftypefn">
<dt class="deftypefn" id="index-make_005finteger"><span class="category-def">Function: </span><span><code class="def-type">emacs_value</code> <strong class="def-name">make_integer</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, intmax_t <var class="var">n</var>)</code><a class="copiable-link" href="#index-make_005finteger"> &para;</a></span></dt>
<dd><p>This function takes an integer argument <var class="var">n</var> and returns the
corresponding <code class="code">emacs_value</code> object.  It raises the
<code class="code">overflow-error</code> error condition if the value of <var class="var">n</var> cannot
be represented as an Emacs integer, i.e. is not inside the limits
set by <code class="code">most-negative-fixnum</code> and <code class="code">most-positive-fixnum</code>
(see <a class="pxref" href="Integer-Basics.html">Integer Basics</a>).
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-make_005ffloat"><span class="category-def">Function: </span><span><code class="def-type">emacs_value</code> <strong class="def-name">make_float</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, double <var class="var">d</var>)</code><a class="copiable-link" href="#index-make_005ffloat"> &para;</a></span></dt>
<dd><p>This function takes a <code class="code">double</code> argument <var class="var">d</var> and returns the
corresponding Emacs floating-point value.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-make_005fstring"><span class="category-def">Function: </span><span><code class="def-type">emacs_value</code> <strong class="def-name">make_string</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, const char *<var class="var">str</var>, ptrdiff_t <var class="var">strlen</var>)</code><a class="copiable-link" href="#index-make_005fstring"> &para;</a></span></dt>
<dd><p>This function creates an Emacs string from C text string pointed by
<var class="var">str</var> whose length in bytes, not including the terminating null
byte, is <var class="var">strlen</var>.  The original string in <var class="var">str</var> can be either
an <abbr class="acronym">ASCII</abbr> string or a UTF-8 encoded non-<abbr class="acronym">ASCII</abbr>
string; it can include embedded null bytes, and doesn&rsquo;t have to end in
a terminating null byte at <code class="code"><var class="var">str</var>[<var class="var">strlen</var>]</code>.  The
function raises the <code class="code">overflow-error</code> error condition if
<var class="var">strlen</var> is negative or exceeds the maximum length of an Emacs
string.
</p></dd></dl>

<p>The <abbr class="acronym">API</abbr> does not provide functions to manipulate Lisp data
structures, for example, create lists with <code class="code">cons</code> and <code class="code">list</code>
(see <a class="pxref" href="Building-Lists.html">Building Cons Cells and Lists</a>), extract list members with <code class="code">car</code> and
<code class="code">cdr</code> (see <a class="pxref" href="List-Elements.html">Accessing Elements of Lists</a>), create vectors with <code class="code">vector</code>
(see <a class="pxref" href="Vector-Functions.html">Functions for Vectors</a>), etc.  For these, use <code class="code">intern</code> and
<code class="code">funcall</code>, described in the next subsection, to call the
corresponding Lisp functions.
</p>
<p>Normally, <code class="code">emacs_value</code> objects have a rather short lifetime: it
ends when the <code class="code">emacs_env</code> pointer used for their creation goes
out of scope.  Occasionally, you may need to create <em class="dfn">global
references</em>: <code class="code">emacs_value</code> objects that live as long as you
wish.  Use the following two functions to manage such objects.
</p>
<dl class="first-deftypefn">
<dt class="deftypefn" id="index-make_005fglobal_005fref"><span class="category-def">Function: </span><span><code class="def-type">emacs_value</code> <strong class="def-name">make_global_ref</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">value</var>)</code><a class="copiable-link" href="#index-make_005fglobal_005fref"> &para;</a></span></dt>
<dd><p>This function returns a global reference for <var class="var">value</var>.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-free_005fglobal_005fref"><span class="category-def">Function: </span><span><code class="def-type">void</code> <strong class="def-name">free_global_ref</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">global_value</var>)</code><a class="copiable-link" href="#index-free_005fglobal_005fref"> &para;</a></span></dt>
<dd><p>This function frees the <var class="var">global_value</var> previously created by
<code class="code">make_global_ref</code>.  The <var class="var">global_value</var> is no longer valid
after the call.  Your module code should pair each call to
<code class="code">make_global_ref</code> with the corresponding <code class="code">free_global_ref</code>.
</p></dd></dl>

<a class="index-entry-id" id="index-user-pointer_002c-using-in-module-functions"></a>
<p>An alternative to keeping around C data structures that need to be
passed to module functions later is to create <em class="dfn">user pointer</em>
objects.  A user pointer, or <code class="code">user-ptr</code>, object is a Lisp object
that encapsulates a C pointer and can have an associated finalizer
function, which is called when the object is garbage-collected
(see <a class="pxref" href="Garbage-Collection.html">Garbage Collection</a>).  The module <abbr class="acronym">API</abbr> provides
functions to create and access <code class="code">user-ptr</code> objects.  These
functions raise the <code class="code">wrong-type-argument</code> error condition if they
are called on <code class="code">emacs_value</code> that doesn&rsquo;t represent a
<code class="code">user-ptr</code> object.
</p>
<dl class="first-deftypefn">
<dt class="deftypefn" id="index-make_005fuser_005fptr"><span class="category-def">Function: </span><span><code class="def-type">emacs_value</code> <strong class="def-name">make_user_ptr</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_finalizer <var class="var">fin</var>, void *<var class="var">ptr</var>)</code><a class="copiable-link" href="#index-make_005fuser_005fptr"> &para;</a></span></dt>
<dd><p>This function creates and returns a <code class="code">user-ptr</code> object which wraps
the C pointer <var class="var">ptr</var>.  The finalizer function <var class="var">fin</var> can be a
<code class="code">NULL</code> pointer (meaning no finalizer), or it can be a function of
the following signature:
</p>
<div class="example">
<pre class="example-preformatted">typedef void (*emacs_finalizer) (void *<var class="var">ptr</var>);
</pre></div>

<p>If <var class="var">fin</var> is not a <code class="code">NULL</code> pointer, it will be called with the
<var class="var">ptr</var> as the argument when the <code class="code">user-ptr</code> object is
garbage-collected.  Don&rsquo;t run any expensive code in a finalizer,
because GC must finish quickly to keep Emacs responsive.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-_002aget_005fuser_005fptr"><span class="category-def">Function: </span><span><code class="def-type">void</code> <strong class="def-name">*get_user_ptr</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value val)</code><a class="copiable-link" href="#index-_002aget_005fuser_005fptr"> &para;</a></span></dt>
<dd><p>This function extracts the C pointer from the Lisp object represented
by <var class="var">val</var>.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-set_005fuser_005fptr"><span class="category-def">Function: </span><span><code class="def-type">void</code> <strong class="def-name">set_user_ptr</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">value</var>, void *<var class="var">ptr</var>)</code><a class="copiable-link" href="#index-set_005fuser_005fptr"> &para;</a></span></dt>
<dd><p>This function sets the C pointer embedded in the <code class="code">user-ptr</code>
object represented by <var class="var">value</var> to <var class="var">ptr</var>.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-get_005fuser_005ffinalizer"><span class="category-def">Function: </span><span><code class="def-type">emacs_finalizer</code> <strong class="def-name">get_user_finalizer</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value val)</code><a class="copiable-link" href="#index-get_005fuser_005ffinalizer"> &para;</a></span></dt>
<dd><p>This function returns the finalizer of the <code class="code">user-ptr</code> object
represented by <var class="var">val</var>, or <code class="code">NULL</code> if it doesn&rsquo;t have a finalizer.
</p></dd></dl>

<dl class="first-deftypefn">
<dt class="deftypefn" id="index-set_005fuser_005ffinalizer"><span class="category-def">Function: </span><span><code class="def-type">void</code> <strong class="def-name">set_user_finalizer</strong> <code class="def-code-arguments">(emacs_env *<var class="var">env</var>, emacs_value <var class="var">val</var>, emacs_finalizer <var class="var">fin</var>)</code><a class="copiable-link" href="#index-set_005fuser_005ffinalizer"> &para;</a></span></dt>
<dd><p>This function changes the finalizer of the <code class="code">user-ptr</code> object
represented by <var class="var">val</var> to be <var class="var">fin</var>.  If <var class="var">fin</var> is a
<code class="code">NULL</code> pointer, the <code class="code">user-ptr</code> object will have no finalizer.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Module-Misc.html">Miscellaneous Convenience Functions for Modules</a>, Previous: <a href="Module-Functions.html">Writing Module Functions</a>, Up: <a href="Writing-Dynamic-Modules.html">Writing Dynamically-Loaded Modules</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
