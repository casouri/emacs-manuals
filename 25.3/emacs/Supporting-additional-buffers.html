<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Manual,
updated for Emacs version 25.3.

Copyright Â© 1985-1987, 1993-2017 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Supporting additional buffers (GNU Emacs Manual)</title>

<meta name="description" content="Supporting additional buffers (GNU Emacs Manual)">
<meta name="keywords" content="Supporting additional buffers (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Autorevert.html" rel="up" title="Autorevert">
<link href="Auto-Reverting-Dired.html" rel="prev" title="Auto Reverting Dired">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
kbd.key {font-style: normal}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Supporting-additional-buffers">
<div class="nav-panel">
<p>
Previous: <a href="Auto-Reverting-Dired.html" accesskey="p" rel="prev">Auto Reverting Dired buffers</a>, Up: <a href="Autorevert.html" accesskey="u" rel="up">Auto Reverting Non-File Buffers</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Adding-Support-for-Auto_002dReverting-additional-Buffers_002e"><span>18.5.3 Adding Support for Auto-Reverting additional Buffers.<a class="copiable-link" href="#Adding-Support-for-Auto_002dReverting-additional-Buffers_002e"> &para;</a></span></h4>

<p>This section is intended for Elisp programmers who would like to add
support for auto-reverting new types of buffers.
</p>
<p>To support auto-reverting the buffer must first of all have a suitable
<code class="code">revert-buffer-function</code>.  See <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Definition-of-revert_002dbuffer_002dfunction.html#Definition-of-revert_002dbuffer_002dfunction">Reverting</a> in <cite class="cite">the Emacs Lisp Reference Manual</cite>.
</p>
<p>In addition, it must have a suitable <code class="code">buffer-stale-function</code>.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-buffer_002dstale_002dfunction"><span class="category-def">Variable: </span><span><strong class="def-name">buffer-stale-function</strong><a class="copiable-link" href="#index-buffer_002dstale_002dfunction"> &para;</a></span></dt>
<dd><p>The value of this variable is a function to check whether a
buffer needs reverting.  This should be a function with one optional
argument <var class="var">noconfirm</var>.  The function should return non-<code class="code">nil</code>
if the buffer should be reverted.  The buffer is current when this
function is called.
</p>
<p>While this function is mainly intended for use in auto-reverting, it
could be used for other purposes as well.  For instance, if
auto-reverting is not enabled, it could be used to warn the user that
the buffer needs reverting.  The idea behind the <var class="var">noconfirm</var>
argument is that it should be <code class="code">t</code> if the buffer is going to be
reverted without asking the user and <code class="code">nil</code> if the function is
just going to be used to warn the user that the buffer is out of date.
In particular, for use in auto-reverting, <var class="var">noconfirm</var> is <code class="code">t</code>.
If the function is only going to be used for auto-reverting, you can
ignore the <var class="var">noconfirm</var> argument.
</p>
<p>If you just want to automatically auto-revert every
<code class="code">auto-revert-interval</code> seconds (like the Buffer Menu), use:
</p>
<div class="example">
<pre class="example-preformatted">(setq-local buffer-stale-function
     #'(lambda (&amp;optional noconfirm) 'fast))
</pre></div>

<p>in the buffer&rsquo;s mode function.
</p>
<p>The special return value &lsquo;<samp class="samp">fast</samp>&rsquo; tells the caller that the need
for reverting was not checked, but that reverting the buffer is fast.
It also tells Auto Revert not to print any revert messages, even if
<code class="code">auto-revert-verbose</code> is non-<code class="code">nil</code>.  This is important, as
getting revert messages every <code class="code">auto-revert-interval</code> seconds can
be very annoying.  The information provided by this return value could
also be useful if the function is consulted for purposes other than
auto-reverting.
</p></dd></dl>

<p>Once the buffer has a suitable <code class="code">revert-buffer-function</code> and
<code class="code">buffer-stale-function</code>, several problems usually remain.
</p>
<p>The buffer will only auto-revert if it is marked unmodified.  Hence,
you will have to make sure that various functions mark the buffer
modified if and only if either the buffer contains information that
might be lost by reverting, or there is reason to believe that the user
might be inconvenienced by auto-reverting, because he is actively
working on the buffer.  The user can always override this by manually
adjusting the modified status of the buffer.  To support this, calling
the <code class="code">revert-buffer-function</code> on a buffer that is marked
unmodified should always keep the buffer marked unmodified.
</p>
<p>It is important to assure that point does not continuously jump around
as a consequence of auto-reverting.  Of course, moving point might be
inevitable if the buffer radically changes.
</p>
<p>You should make sure that the <code class="code">revert-buffer-function</code> does not
print messages that unnecessarily duplicate Auto Revert&rsquo;s own messages,
displayed if <code class="code">auto-revert-verbose</code> is <code class="code">t</code>, and effectively
override a <code class="code">nil</code> value for <code class="code">auto-revert-verbose</code>.  Hence,
adapting a mode for auto-reverting often involves getting rid of such
messages.  This is especially important for buffers that automatically
revert every <code class="code">auto-revert-interval</code> seconds.
</p>
<p>If the new auto-reverting is part of Emacs, you should mention it
in the documentation string of <code class="code">global-auto-revert-non-file-buffers</code>.
</p>
<p>Similarly, you should add a section to this chapter.  This section
should at the very least make clear whether enabling auto-reverting
for the buffer reliably assures that all information in the buffer is
completely up to date (or will be after <code class="code">auto-revert-interval</code>
seconds).
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Auto-Reverting-Dired.html">Auto Reverting Dired buffers</a>, Up: <a href="Autorevert.html">Auto Reverting Non-File Buffers</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
