<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 25.3.

Copyright Â© 1990-1996, 1998-2017 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Minor Mode Conventions (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Minor Mode Conventions (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Minor Mode Conventions (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Minor-Modes.html" rel="up" title="Minor Modes">
<link href="Keymaps-and-Minor-Modes.html" rel="next" title="Keymaps and Minor Modes">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span.r {font-family: initial; font-weight: normal; font-style: normal}
span:hover a.copiable-link {visibility: visible}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Minor-Mode-Conventions">
<div class="nav-panel">
<p>
Next: <a href="Keymaps-and-Minor-Modes.html" accesskey="n" rel="next">Keymaps and Minor Modes</a>, Up: <a href="Minor-Modes.html" accesskey="u" rel="up">Minor Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Conventions-for-Writing-Minor-Modes"><span>22.3.1 Conventions for Writing Minor Modes<a class="copiable-link" href="#Conventions-for-Writing-Minor-Modes"> &para;</a></span></h4>
<a class="index-entry-id" id="index-minor-mode-conventions"></a>
<a class="index-entry-id" id="index-conventions-for-writing-minor-modes"></a>

<p>There are conventions for writing minor modes just as there are for
major modes.  These conventions are described below.  The easiest way to
follow them is to use the macro <code class="code">define-minor-mode</code>.
See <a class="xref" href="Defining-Minor-Modes.html">Defining Minor Modes</a>.
</p>
<ul class="itemize mark-bullet">
<li><a class="index-entry-id" id="index-mode-variable"></a>
Define a variable whose name ends in &lsquo;<samp class="samp">-mode</samp>&rsquo;.  We call this the
<em class="dfn">mode variable</em>.  The minor mode command should set this variable.
The value will be <code class="code">nil</code> if the mode is disabled, and non-<code class="code">nil</code>
if the mode is enabled.  The variable should be buffer-local if the
minor mode is buffer-local.

<p>This variable is used in conjunction with the <code class="code">minor-mode-alist</code> to
display the minor mode name in the mode line.  It also determines
whether the minor mode keymap is active, via <code class="code">minor-mode-map-alist</code>
(see <a class="pxref" href="Controlling-Active-Maps.html">Controlling the Active Keymaps</a>).  Individual commands or hooks can
also check its value.
</p>
</li><li>Define a command, called the <em class="dfn">mode command</em>, whose name is the same
as the mode variable.  Its job is to set the value of the mode variable,
plus anything else that needs to be done to actually enable or disable
the mode&rsquo;s features.

<p>The mode command should accept one optional argument.  If called
interactively with no prefix argument, it should toggle the mode
(i.e., enable if it is disabled, and disable if it is enabled).  If
called interactively with a prefix argument, it should enable the mode
if the argument is positive and disable it otherwise.
</p>
<p>If the mode command is called from Lisp (i.e., non-interactively), it
should enable the mode if the argument is omitted or <code class="code">nil</code>; it
should toggle the mode if the argument is the symbol <code class="code">toggle</code>;
otherwise it should treat the argument in the same way as for an
interactive call with a numeric prefix argument, as described above.
</p>
<p>The following example shows how to implement this behavior (it is
similar to the code generated by the <code class="code">define-minor-mode</code> macro):
</p>
<div class="example">
<pre class="example-preformatted">(interactive (list (or current-prefix-arg 'toggle)))
(let ((enable (if (eq arg 'toggle)
                  (not foo-mode) ; <span class="r">this mode&rsquo;s mode variable</span>
                (&gt; (prefix-numeric-value arg) 0))))
  (if enable
      <var class="var">do-enable</var>
    <var class="var">do-disable</var>))
</pre></div>

<p>The reason for this somewhat complex behavior is that it lets users
easily toggle the minor mode interactively, and also lets the minor mode
be easily enabled in a mode hook, like this:
</p>
<div class="example">
<pre class="example-preformatted">(add-hook 'text-mode-hook 'foo-mode)
</pre></div>

<p>This behaves correctly whether or not <code class="code">foo-mode</code> was already
enabled, since the <code class="code">foo-mode</code> mode command unconditionally enables
the minor mode when it is called from Lisp with no argument.  Disabling
a minor mode in a mode hook is a little uglier:
</p>
<div class="example">
<pre class="example-preformatted">(add-hook 'text-mode-hook (lambda () (foo-mode -1)))
</pre></div>

<p>However, this is not very commonly done.
</p>
</li><li>Add an element to <code class="code">minor-mode-alist</code> for each minor mode
(see <a class="pxref" href="Mode-Line-Variables.html#Definition-of-minor_002dmode_002dalist">Definition of minor-mode-alist</a>), if you want to indicate the
minor mode in the mode line.  This element should be a list of the
following form:

<div class="example smallexample">
<pre class="example-preformatted">(<var class="var">mode-variable</var> <var class="var">string</var>)
</pre></div>

<p>Here <var class="var">mode-variable</var> is the variable that controls enabling of the
minor mode, and <var class="var">string</var> is a short string, starting with a space,
to represent the mode in the mode line.  These strings must be short so
that there is room for several of them at once.
</p>
<p>When you add an element to <code class="code">minor-mode-alist</code>, use <code class="code">assq</code> to
check for an existing element, to avoid duplication.  For example:
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">(unless (assq 'leif-mode minor-mode-alist)
  (push '(leif-mode &quot; Leif&quot;) minor-mode-alist))
</pre></div></div>

<p>or like this, using <code class="code">add-to-list</code> (see <a class="pxref" href="List-Variables.html">Modifying List Variables</a>):
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">(add-to-list 'minor-mode-alist '(leif-mode &quot; Leif&quot;))
</pre></div></div>
</li></ul>

<p>In addition, several major mode conventions apply to minor modes as
well: those regarding the names of global symbols, the use of a hook at
the end of the initialization function, and the use of keymaps and other
tables.
</p>
<p>The minor mode should, if possible, support enabling and disabling via
Custom (see <a class="pxref" href="Customization.html">Customization Settings</a>).  To do this, the mode variable should be
defined with <code class="code">defcustom</code>, usually with <code class="code">:type 'boolean</code>.  If
just setting the variable is not sufficient to enable the mode, you
should also specify a <code class="code">:set</code> method which enables the mode by
invoking the mode command.  Note in the variable&rsquo;s documentation string
that setting the variable other than via Custom may not take effect.
Also, mark the definition with an autoload cookie (see <a class="pxref" href="Autoload.html#autoload-cookie">autoload cookie</a>), and specify a <code class="code">:require</code> so that customizing the variable
will load the library that defines the mode.  For example:
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">;;;###autoload
(defcustom msb-mode nil
  &quot;Toggle msb-mode.
Setting this variable directly does not take effect;
use either \\[customize] or the function `msb-mode'.&quot;
  :set 'custom-set-minor-mode
  :initialize 'custom-initialize-default
  :version &quot;20.4&quot;
  :type    'boolean
  :group   'msb
  :require 'msb)
</pre></div></div>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Keymaps-and-Minor-Modes.html">Keymaps and Minor Modes</a>, Up: <a href="Minor-Modes.html">Minor Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
