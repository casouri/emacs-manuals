<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 29.3.

Copyright Â© 1990-1996, 1998-2024 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Command Loop Info (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Command Loop Info (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Command Loop Info (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Command-Loop.html" rel="up" title="Command Loop">
<link href="Adjusting-Point.html" rel="next" title="Adjusting Point">
<link href="Distinguish-Interactive.html" rel="prev" title="Distinguish Interactive">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span.r {font-family: initial; font-weight: normal; font-style: normal}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Command-Loop-Info">
<div class="nav-panel">
<p>
Next: <a href="Adjusting-Point.html" accesskey="n" rel="next">Adjusting Point After Commands</a>, Previous: <a href="Distinguish-Interactive.html" accesskey="p" rel="prev">Distinguish Interactive Calls</a>, Up: <a href="Command-Loop.html" accesskey="u" rel="up">Command Loop</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Information-from-the-Command-Loop"><span>22.5 Information from the Command Loop<a class="copiable-link" href="#Information-from-the-Command-Loop"> &para;</a></span></h3>
<a class="index-entry-id" id="index-command-loop-variables"></a>

<p>The editor command loop sets several Lisp variables to keep status
records for itself and for commands that are run.  With the exception of
<code class="code">this-command</code> and <code class="code">last-command</code> it&rsquo;s generally a bad idea to
change any of these variables in a Lisp program.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002dcommand"><span class="category-def">Variable: </span><span><strong class="def-name">last-command</strong><a class="copiable-link" href="#index-last_002dcommand"> &para;</a></span></dt>
<dd><p>This variable records the name of the previous command executed by the
command loop (the one before the current command).  Normally the value
is a symbol with a function definition, but this is not guaranteed.
</p>
<p>The value is copied from <code class="code">this-command</code> when a command returns to
the command loop, except when the command has specified a prefix
argument for the following command.
</p>
<p>This variable is always local to the current terminal and cannot be
buffer-local.  See <a class="xref" href="Multiple-Terminals.html">Multiple Terminals</a>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-real_002dlast_002dcommand"><span class="category-def">Variable: </span><span><strong class="def-name">real-last-command</strong><a class="copiable-link" href="#index-real_002dlast_002dcommand"> &para;</a></span></dt>
<dd><p>This variable is set up by Emacs just like <code class="code">last-command</code>,
but never altered by Lisp programs.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002drepeatable_002dcommand"><span class="category-def">Variable: </span><span><strong class="def-name">last-repeatable-command</strong><a class="copiable-link" href="#index-last_002drepeatable_002dcommand"> &para;</a></span></dt>
<dd><p>This variable stores the most recently executed command that was not
part of an input event.  This is the command <code class="code">repeat</code> will try to
repeat, See <a data-manual="emacs" href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Repeating.html#Repeating">Repeating</a> in <cite class="cite">The GNU Emacs Manual</cite>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-this_002dcommand"><span class="category-def">Variable: </span><span><strong class="def-name">this-command</strong><a class="copiable-link" href="#index-this_002dcommand"> &para;</a></span></dt>
<dd><a class="index-entry-id" id="index-current-command"></a>
<p>This variable records the name of the command now being executed by
the editor command loop.  Like <code class="code">last-command</code>, it is normally a symbol
with a function definition.
</p>
<p>The command loop sets this variable just before running a command, and
copies its value into <code class="code">last-command</code> when the command finishes
(unless the command specified a prefix argument for the following
command).
</p>
<a class="index-entry-id" id="index-kill-command-repetition"></a>
<p>Some commands set this variable during their execution, as a flag for
whatever command runs next.  In particular, the functions for killing text
set <code class="code">this-command</code> to <code class="code">kill-region</code> so that any kill commands
immediately following will know to append the killed text to the
previous kill.
</p></dd></dl>

<p>If you do not want a particular command to be recognized as the previous
command in the case where it got an error, you must code that command to
prevent this.  One way is to set <code class="code">this-command</code> to <code class="code">t</code> at the
beginning of the command, and set <code class="code">this-command</code> back to its proper
value at the end, like this:
</p>
<div class="example">
<pre class="example-preformatted">(defun foo (args...)
  (interactive ...)
  (let ((old-this-command this-command))
    (setq this-command t)
    <span class="r">...do the work...</span>
    (setq this-command old-this-command)))
</pre></div>

<p>We do not bind <code class="code">this-command</code> with <code class="code">let</code> because that would
restore the old value in case of error&mdash;a feature of <code class="code">let</code> which
in this case does precisely what we want to avoid.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-this_002doriginal_002dcommand"><span class="category-def">Variable: </span><span><strong class="def-name">this-original-command</strong><a class="copiable-link" href="#index-this_002doriginal_002dcommand"> &para;</a></span></dt>
<dd><p>This has the same value as <code class="code">this-command</code> except when command
remapping occurs (see <a class="pxref" href="Remapping-Commands.html">Remapping Commands</a>).  In that case,
<code class="code">this-command</code> gives the command actually run (the result of
remapping), and <code class="code">this-original-command</code> gives the command that
was specified to run but remapped into another command.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-current_002dminibuffer_002dcommand"><span class="category-def">Variable: </span><span><strong class="def-name">current-minibuffer-command</strong><a class="copiable-link" href="#index-current_002dminibuffer_002dcommand"> &para;</a></span></dt>
<dd><p>This has the same value as <code class="code">this-command</code>, but is bound
recursively when entering a minibuffer.  This variable can be used
from minibuffer hooks and the like to determine what command opened
the current minibuffer session.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-this_002dcommand_002dkeys"><span class="category-def">Function: </span><span><strong class="def-name">this-command-keys</strong><a class="copiable-link" href="#index-this_002dcommand_002dkeys"> &para;</a></span></dt>
<dd><p>This function returns a string or vector containing the key sequence
that invoked the present command.  Any events read by the command
using <code class="code">read-event</code> without a timeout get tacked on to the end.
</p>
<p>However, if the command has called <code class="code">read-key-sequence</code>, it
returns the last read key sequence.  See <a class="xref" href="Key-Sequence-Input.html">Key Sequence Input</a>.  The
value is a string if all events in the sequence were characters that
fit in a string.  See <a class="xref" href="Input-Events.html">Input Events</a>.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(this-command-keys)
;; <span class="r">Now use <kbd class="kbd">C-u C-x C-e</kbd> to evaluate that.</span>
     &rArr; &quot;^X^E&quot;
</pre></div></div>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-this_002dcommand_002dkeys_002dvector"><span class="category-def">Function: </span><span><strong class="def-name">this-command-keys-vector</strong><a class="copiable-link" href="#index-this_002dcommand_002dkeys_002dvector"> &para;</a></span></dt>
<dd><a class="anchor" id="Definition-of-this_002dcommand_002dkeys_002dvector"></a><p>Like <code class="code">this-command-keys</code>, except that it always returns the events
in a vector, so you don&rsquo;t need to deal with the complexities of storing
input events in a string (see <a class="pxref" href="Strings-of-Events.html">Putting Keyboard Events in Strings</a>).
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-clear_002dthis_002dcommand_002dkeys"><span class="category-def">Function: </span><span><strong class="def-name">clear-this-command-keys</strong> <var class="def-var-arguments">&amp;optional keep-record</var><a class="copiable-link" href="#index-clear_002dthis_002dcommand_002dkeys"> &para;</a></span></dt>
<dd><p>This function empties out the table of events for
<code class="code">this-command-keys</code> to return.  Unless <var class="var">keep-record</var> is
non-<code class="code">nil</code>, it also empties the records that the function
<code class="code">recent-keys</code> (see <a class="pxref" href="Recording-Input.html">Recording Input</a>) will subsequently return.
This is useful after reading a password, to prevent the password from
echoing inadvertently as part of the next command in certain cases.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002dnonmenu_002devent"><span class="category-def">Variable: </span><span><strong class="def-name">last-nonmenu-event</strong><a class="copiable-link" href="#index-last_002dnonmenu_002devent"> &para;</a></span></dt>
<dd><p>This variable holds the last input event read as part of a key sequence,
not counting events resulting from mouse menus.
</p>
<p>One use of this variable is for telling <code class="code">x-popup-menu</code> where to pop
up a menu.  It is also used internally by <code class="code">y-or-n-p</code>
(see <a class="pxref" href="Yes_002dor_002dNo-Queries.html">Yes-or-No Queries</a>).
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002dcommand_002devent"><span class="category-def">Variable: </span><span><strong class="def-name">last-command-event</strong><a class="copiable-link" href="#index-last_002dcommand_002devent"> &para;</a></span></dt>
<dd><p>This variable is set to the last input event that was read by the
command loop as part of a command.  The principal use of this variable
is in <code class="code">self-insert-command</code>, which uses it to decide which
character to insert, and in <code class="code">post-self-insert-hook</code>
(see <a class="pxref" href="Commands-for-Insertion.html">User-Level Insertion Commands</a>), which uses it to access the
character that was just inserted.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">last-command-event
;; <span class="r">Now use <kbd class="kbd">C-u C-x C-e</kbd> to evaluate that.</span>
     &rArr; 5
</pre></div></div>

<p>The value is 5 because that is the <abbr class="acronym">ASCII</abbr> code for <kbd class="kbd">C-e</kbd>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002devent_002dframe"><span class="category-def">Variable: </span><span><strong class="def-name">last-event-frame</strong><a class="copiable-link" href="#index-last_002devent_002dframe"> &para;</a></span></dt>
<dd><p>This variable records which frame the last input event was directed to.
Usually this is the frame that was selected when the event was
generated, but if that frame has redirected input focus to another
frame, the value is the frame to which the event was redirected.
See <a class="xref" href="Input-Focus.html">Input Focus</a>.
</p>
<p>If the last event came from a keyboard macro, the value is <code class="code">macro</code>.
</p></dd></dl>

<a class="index-entry-id" id="index-input-devices"></a>
<a class="index-entry-id" id="index-device-names"></a>
<p>Input events must come from somewhere; sometimes, that is a keyboard
macro, a signal, or &lsquo;unread-command-events&rsquo;, but it is usually a
physical input device connected to a computer that is controlled by
the user.  Those devices are referred to as <em class="dfn">input devices</em>, and
Emacs associates each input event with the input device from which it
originated.  They are identified by a name that is unique to each
input device.
</p>
<p>The ability to determine the precise input device used depends on the
details of each system.  When that information is unavailable, Emacs
reports keyboard events as originating from the &lsquo;<samp class="samp">&quot;Virtual core
keyboard&quot;</samp>&rsquo;, and other events as originating from the &lsquo;<samp class="samp">&quot;Virtual
core pointer&quot;</samp>&rsquo;.  (These values are used on every platform because the
X server reports them when detailed device information is not known.)
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002devent_002ddevice"><span class="category-def">Variable: </span><span><strong class="def-name">last-event-device</strong><a class="copiable-link" href="#index-last_002devent_002ddevice"> &para;</a></span></dt>
<dd><p>This variable records the name of the input device from which the last
input event read was generated.  It is <code class="code">nil</code> if no such device
exists, i.e., the last input event was read from
<code class="code">unread-command-events</code>, or it came from a keyboard macro.
</p>
<p>When the X Input Extension is being used on X Windows, the device name
is a string that is unique to each physical keyboard, pointing device
and touchscreen attached to the X server.  Otherwise, it is either the
string &lsquo;<samp class="samp">&quot;Virtual core pointer&quot;</samp>&rsquo; or &lsquo;<samp class="samp">&quot;Virtual core
keyboard&quot;</samp>&rsquo;, depending on whether the event was generated by a pointing
device (such as a mouse) or a keyboard.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-device_002dclass"><span class="category-def">Function: </span><span><strong class="def-name">device-class</strong> <var class="def-var-arguments">frame name</var><a class="copiable-link" href="#index-device_002dclass"> &para;</a></span></dt>
<dd><p>There are various different types of devices, which can be determined
from their names.  This function can be used to determined the correct
type of the device <var class="var">name</var> for an event originating from
<var class="var">frame</var>.
</p>
<p>The return value is one of the following symbols (&ldquo;device classes&rdquo;):
</p>
<dl class="table">
<dt><code class="code">core-keyboard</code></dt>
<dd><p>The core keyboard; this is means the device is a keyboard-like device,
but no other characteristics are unknown.
</p>
</dd>
<dt><code class="code">core-pointer</code></dt>
<dd><p>The core pointer; this means the device is a pointing device, but no
other characteristics are known.
</p>
</dd>
<dt><code class="code">mouse</code></dt>
<dd><p>A computer mouse.
</p>
</dd>
<dt><code class="code">trackpoint</code></dt>
<dd><p>A trackpoint or joystick (or other similar control.)
</p>
</dd>
<dt><code class="code">eraser</code></dt>
<dd><p>The other end of a stylus on a graphics tablet, or a standalone
eraser.
</p>
</dd>
<dt><code class="code">pen</code></dt>
<dd><p>The pointed end of a pen on a graphics tablet, a stylus, or some other
similar device.
</p>
</dd>
<dt><code class="code">puck</code></dt>
<dd><p>A device that looks like a computer mouse, but reports absolute
coordinates relative to some other surface.
</p>
</dd>
<dt><code class="code">power-button</code></dt>
<dd><p>A power button or volume button (or other similar control.)
</p>
</dd>
<dt><code class="code">keyboard</code></dt>
<dd><p>A computer keyboard.
</p>
</dd>
<dt><code class="code">touchscreen</code></dt>
<dd><p>A computer touchpad.
</p>
</dd>
<dt><code class="code">pad</code></dt>
<dd><p>A collection of sensitive buttons, rings, and strips commonly found
around a drawing tablet.
</p>
</dd>
<dt><code class="code">touchpad</code></dt>
<dd><p>An indirect touch device such as a touchpad.
</p>
</dd>
<dt><code class="code">piano</code></dt>
<dd><p>A musical instrument such as an electronic keyboard.
</p>
</dd>
<dt><code class="code">test</code></dt>
<dd><p>A device used by the XTEST extension to report input.
</p></dd>
</dl>
</dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Adjusting-Point.html">Adjusting Point After Commands</a>, Previous: <a href="Distinguish-Interactive.html">Distinguish Interactive Calls</a>, Up: <a href="Command-Loop.html">Command Loop</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
