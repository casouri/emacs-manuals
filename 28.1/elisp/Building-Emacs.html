<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 28.1.

Copyright Â© 1990-1996, 1998-2022 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Building Emacs (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Building Emacs (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Building Emacs (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="GNU-Emacs-Internals.html" rel="up" title="GNU Emacs Internals">
<link href="Pure-Storage.html" rel="next" title="Pure Storage">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Building-Emacs">
<div class="nav-panel">
<p>
Next: <a href="Pure-Storage.html" accesskey="n" rel="next">Pure Storage</a>, Up: <a href="GNU-Emacs-Internals.html" accesskey="u" rel="up">GNU Emacs Internals</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Building-Emacs-1"><span>E.1 Building Emacs<a class="copiable-link" href="#Building-Emacs-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-building-Emacs"></a>
<a class="index-entry-id" id="index-temacs"></a>

<p>This section explains the steps involved in building the Emacs
executable.  You don&rsquo;t have to know this material to build and install
Emacs, since the makefiles do all these things automatically.  This
information is pertinent to Emacs developers.
</p>
<p>Building Emacs requires GNU Make version 3.81 or later.
</p>
<p>Compilation of the C source files in the <samp class="file">src</samp> directory
produces an executable file called <samp class="file">temacs</samp>, also called a
<em class="dfn">bare impure Emacs</em>.  It contains the Emacs Lisp interpreter and
I/O routines, but not the editing commands.
</p>
<a class="index-entry-id" id="index-loadup_002eel"></a>
<p>The command <code class="command">temacs&nbsp;-l&nbsp;loadup</code><!-- /@w --> would run <samp class="file">temacs</samp>
and direct it to load <samp class="file">loadup.el</samp>.  The <code class="code">loadup</code> library
loads additional Lisp libraries, which set up the normal Emacs editing
environment.  After this step, the Emacs executable is no longer
<em class="dfn">bare</em>.
</p>
<a class="index-entry-id" id="index-dumping-Emacs"></a>
<a class="index-entry-id" id="index-_002d_002dtemacs-option_002c-and-dumping-method"></a>
<p>Because it takes some time to load the standard Lisp files, the
<samp class="file">temacs</samp> executable usually isn&rsquo;t run directly by users.
Instead, one of the last steps of building Emacs runs the command
&lsquo;<samp class="samp">temacs&nbsp;-batch&nbsp;-l&nbsp;loadup&nbsp;--temacs=<var class="var">dump-method</var></samp>&rsquo;<!-- /@w -->.  The
special option <samp class="option">--temacs</samp> tells <code class="command">temacs</code> how to record
all the standard preloaded Lisp functions and variables, so that when
you subsequently run Emacs, it will start much faster.  The
<samp class="option">--temacs</samp> option requires an argument <var class="var">dump-method</var>, which
can be one of the following:
</p>
<dl class="table">
<dt><a id="index-dump-file"></a><span>&lsquo;<samp class="samp">pdump</samp>&rsquo;<a class="copiable-link" href="#index-dump-file"> &para;</a></span></dt>
<dd><p>Record the preloaded Lisp data in a <em class="dfn">dump file</em>.  This
method produces an additional data file which Emacs will load at
startup.  The produced dump file is usually called <samp class="file">emacs.pdmp</samp>,
and is installed in the Emacs <code class="code">exec-directory</code> (see <a class="pxref" href="Help-Functions.html">Help Functions</a>).  This method is the most preferred one, as it does not
require Emacs to employ any special techniques of memory allocation,
which might get in the way of various memory-layout techniques used by
modern systems to enhance security and privacy.
</p>
</dd>
<dt><a id="index-bootstrapping-Emacs"></a><span>&lsquo;<samp class="samp">pbootstrap</samp>&rsquo;<a class="copiable-link" href="#index-bootstrapping-Emacs"> &para;</a></span></dt>
<dd><p>Like &lsquo;<samp class="samp">pdump</samp>&rsquo;, but used while <em class="dfn">bootstrapping</em> Emacs, when no
previous Emacs binary and no <samp class="file">*.elc</samp> byte-compiled Lisp files are
available.  The produced dump file is usually named
<samp class="file">bootstrap-emacs.pdmp</samp> in this case.
</p>
</dd>
<dt><a id="index-unexec"></a><span>&lsquo;<samp class="samp">dump</samp>&rsquo;<a class="copiable-link" href="#index-unexec"> &para;</a></span></dt>
<dd><p>This method causes <code class="command">temacs</code> to dump out an executable program,
called <samp class="file">emacs</samp>, which has all the standard Lisp files already
preloaded into it.  (The &lsquo;<samp class="samp">-batch</samp>&rsquo; argument prevents
<code class="command">temacs</code> from trying to initialize any of its data on the
terminal, so that the tables of terminal information are empty in the
dumped Emacs.)  This method is also known as <em class="dfn">unexec</em>, because it
produces a program file from a running process, and thus is in some
sense the opposite of executing a program to start a process.
Although this method was the way that Emacs traditionally saved its
state, it is now deprecated.
</p>
</dd>
<dt>&lsquo;<samp class="samp">bootstrap</samp>&rsquo;</dt>
<dd><p>Like &lsquo;<samp class="samp">dump</samp>&rsquo;, but used when bootstrapping Emacs with the
<code class="code">unexec</code> method.
</p></dd>
</dl>

<a class="index-entry-id" id="index-preloaded-Lisp-files"></a>
<a class="index-entry-id" id="index-preloaded_002dfile_002dlist"></a>
<p>The dumped <samp class="file">emacs</samp> executable (also called a <em class="dfn">pure</em> Emacs)
is the one which is installed.  If the portable dumper was used to
build Emacs, the <samp class="file">emacs</samp> executable is actually an exact copy of
<samp class="file">temacs</samp>, and the corresponding <samp class="file">emacs.pdmp</samp> file is
installed as well.  The variable <code class="code">preloaded-file-list</code> stores a
list of the preloaded Lisp files recorded in the dump file or
in the dumped Emacs executable.  If you port Emacs to a new operating
system, and are not able to implement dumping of any kind, then Emacs
must load <samp class="file">loadup.el</samp> each time it starts.
</p>
<a class="index-entry-id" id="index-build-details"></a>
<a class="index-entry-id" id="index-deterministic-build"></a>
<a class="index-entry-id" id="index-_002d_002ddisable_002dbuild_002ddetails-option-to-configure"></a>
<p>By default the dumped <samp class="file">emacs</samp> executable records details such
as the build time and host name.  Use the
<samp class="option">--disable-build-details</samp> option of <code class="command">configure</code> to
suppress these details, so that building and installing Emacs twice
from the same sources is more likely to result in identical copies of
Emacs.
</p>
<a class="index-entry-id" id="index-site_002dload_002eel"></a>
<p>You can specify additional files to preload by writing a library named
<samp class="file">site-load.el</samp> that loads them.  You may need to rebuild Emacs
with an added definition
</p>
<div class="example">
<pre class="example-preformatted">#define SITELOAD_PURESIZE_EXTRA <var class="var">n</var>
</pre></div>

<p>to make <var class="var">n</var> added bytes of pure space to hold the additional files;
see <samp class="file">src/puresize.h</samp>.
(Try adding increments of 20000 until it is big enough.)  However, the
advantage of preloading additional files decreases as machines get
faster.  On modern machines, it is usually not advisable.
</p>
<p>After <samp class="file">loadup.el</samp> reads <samp class="file">site-load.el</samp>, it finds the
documentation strings for primitive and preloaded functions (and
variables) in the file <samp class="file">etc/DOC</samp> where they are stored, by
calling <code class="code">Snarf-documentation</code> (see <a class="pxref" href="Accessing-Documentation.html#Definition-of-Snarf_002ddocumentation">Accessing Documentation</a>).
</p>
<a class="index-entry-id" id="index-site_002dinit_002eel"></a>
<a class="index-entry-id" id="index-preloading-additional-functions-and-variables"></a>
<p>You can specify other Lisp expressions to execute just before dumping
by putting them in a library named <samp class="file">site-init.el</samp>.  This file is
executed after the documentation strings are found.
</p>
<p>If you want to preload function or variable definitions, there are
three ways you can do this and make their documentation strings
accessible when you subsequently run Emacs:
</p>
<ul class="itemize mark-bullet">
<li>Arrange to scan these files when producing the <samp class="file">etc/DOC</samp> file,
and load them with <samp class="file">site-load.el</samp>.

</li><li>Load the files with <samp class="file">site-init.el</samp>, then copy the files into the
installation directory for Lisp files when you install Emacs.

</li><li>Specify a <code class="code">nil</code> value for <code class="code">byte-compile-dynamic-docstrings</code>
as a local variable in each of these files, and load them with either
<samp class="file">site-load.el</samp> or <samp class="file">site-init.el</samp>.  (This method has the
drawback that the documentation strings take up space in Emacs all the
time.)
</li></ul>

<a class="index-entry-id" id="index-change-load_002dpath-at-configure-time"></a>
<a class="index-entry-id" id="index-_002d_002denable_002dlocallisppath-option-to-configure"></a>
<p>It is not advisable to put anything in <samp class="file">site-load.el</samp> or
<samp class="file">site-init.el</samp> that would alter any of the features that users
expect in an ordinary unmodified Emacs.  If you feel you must override
normal features for your site, do it with <samp class="file">default.el</samp>, so that
users can override your changes if they wish.  See <a class="xref" href="Startup-Summary.html">Summary: Sequence of Actions at Startup</a>.
Note that if either <samp class="file">site-load.el</samp> or <samp class="file">site-init.el</samp> changes
<code class="code">load-path</code>, the changes will be lost after dumping.
See <a class="xref" href="Library-Search.html">Library Search</a>.  To make a permanent change to
<code class="code">load-path</code>, use the <samp class="option">--enable-locallisppath</samp> option
of <code class="command">configure</code>.
</p>
<p>In a package that can be preloaded, it is sometimes necessary (or
useful) to delay certain evaluations until Emacs subsequently starts
up.  The vast majority of such cases relate to the values of
customizable variables.  For example, <code class="code">tutorial-directory</code> is a
variable defined in <samp class="file">startup.el</samp>, which is preloaded.  The default
value is set based on <code class="code">data-directory</code>.  The variable needs to
access the value of <code class="code">data-directory</code> when Emacs starts, not when
it is dumped, because the Emacs executable has probably been installed
in a different location since it was dumped.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-custom_002dinitialize_002ddelay"><span class="category-def">Function: </span><span><strong class="def-name">custom-initialize-delay</strong> <var class="def-var-arguments">symbol value</var><a class="copiable-link" href="#index-custom_002dinitialize_002ddelay"> &para;</a></span></dt>
<dd><p>This function delays the initialization of <var class="var">symbol</var> to the next
Emacs start.  You normally use this function by specifying it as the
<code class="code">:initialize</code> property of a customizable variable.  (The argument
<var class="var">value</var> is unused, and is provided only for compatibility with the
form Custom expects.)
</p></dd></dl>

<p>In the unlikely event that you need a more general functionality than
<code class="code">custom-initialize-delay</code> provides, you can use
<code class="code">before-init-hook</code> (see <a class="pxref" href="Startup-Summary.html">Summary: Sequence of Actions at Startup</a>).
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-dump_002demacs_002dportable"><span class="category-def">Function: </span><span><strong class="def-name">dump-emacs-portable</strong> <var class="def-var-arguments">to-file &amp;optional track-referrers</var><a class="copiable-link" href="#index-dump_002demacs_002dportable"> &para;</a></span></dt>
<dd><p>This function dumps the current state of Emacs into a dump
file <var class="var">to-file</var>, using the <code class="code">pdump</code> method.  Normally, the
dump file is called <samp class="file"><var class="var">emacs-name</var>.dmp</samp>, where
<var class="var">emacs-name</var> is the name of the Emacs executable file.  The
optional argument <var class="var">track-referrers</var>, if non-<code class="code">nil</code>, causes the
portable dumper to keep additional information to help track
down the provenance of object types that are not yet supported by the
<code class="code">pdump</code> method.
</p>
<p>Although the portable dumper code can run on many platforms, the dump
files that it produces are not portable&mdash;they can be loaded only by
the Emacs executable that dumped them.
</p>
<p>If you want to use this function in an Emacs that was already dumped,
you must run Emacs with the &lsquo;<samp class="samp">-batch</samp>&rsquo; option.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-dump_002demacs"><span class="category-def">Function: </span><span><strong class="def-name">dump-emacs</strong> <var class="def-var-arguments">to-file from-file</var><a class="copiable-link" href="#index-dump_002demacs"> &para;</a></span></dt>
<dd><a class="index-entry-id" id="index-unexec-1"></a>
<p>This function dumps the current state of Emacs into an executable file
<var class="var">to-file</var>, using the <code class="code">unexec</code> method.  It takes symbols from
<var class="var">from-file</var> (this is normally the executable file <samp class="file">temacs</samp>).
</p>
<p>This function cannot be used in an Emacs that was already dumped.
This function is deprecated, and by default Emacs is built without
<code class="code">unexec</code> support so this function is not available.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-pdumper_002dstats"><span class="category-def">Function: </span><span><strong class="def-name">pdumper-stats</strong><a class="copiable-link" href="#index-pdumper_002dstats"> &para;</a></span></dt>
<dd><p>If the current Emacs session restored its state from a dump
file, this function returns information about the dump file and the
time it took to restore the Emacs state.  The value is an alist
<code class="code">((dumped-with-pdumper&nbsp;.&nbsp;t)&nbsp;(load-time&nbsp;.&nbsp;<var class="var">time</var>)&nbsp;(dump-file-name&nbsp;.&nbsp;<var class="var">file</var>))</code><!-- /@w -->,
where <var class="var">file</var> is the name of the dump file, and <var class="var">time</var> is the
time in seconds it took to restore the state from the dump file.
If the current session was not restored from a dump file, the
value is nil.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Pure-Storage.html">Pure Storage</a>, Up: <a href="GNU-Emacs-Internals.html">GNU Emacs Internals</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
