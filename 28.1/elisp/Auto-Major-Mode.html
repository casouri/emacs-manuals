<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 28.1.

Copyright Â© 1990-1996, 1998-2022 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Auto Major Mode (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Auto Major Mode (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Auto Major Mode (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Major-Modes.html" rel="up" title="Major Modes">
<link href="Mode-Help.html" rel="next" title="Mode Help">
<link href="Major-Mode-Conventions.html" rel="prev" title="Major Mode Conventions">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span.r {font-family: initial; font-weight: normal; font-style: normal}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Auto-Major-Mode">
<div class="nav-panel">
<p>
Next: <a href="Mode-Help.html" accesskey="n" rel="next">Getting Help about a Major Mode</a>, Previous: <a href="Major-Mode-Conventions.html" accesskey="p" rel="prev">Major Mode Conventions</a>, Up: <a href="Major-Modes.html" accesskey="u" rel="up">Major Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="How-Emacs-Chooses-a-Major-Mode"><span>24.2.2 How Emacs Chooses a Major Mode<a class="copiable-link" href="#How-Emacs-Chooses-a-Major-Mode"> &para;</a></span></h4>
<a class="index-entry-id" id="index-major-mode_002c-automatic-selection"></a>

<p>When Emacs visits a file, it automatically selects a major mode for
the buffer based on information in the file name or in the file itself.
It also processes local variables specified in the file text.
</p>
<dl class="first-deffn">
<dt class="deffn" id="index-normal_002dmode"><span class="category-def">Command: </span><span><strong class="def-name">normal-mode</strong> <var class="def-var-arguments">&amp;optional find-file</var><a class="copiable-link" href="#index-normal_002dmode"> &para;</a></span></dt>
<dd><p>This function establishes the proper major mode and buffer-local
variable bindings for the current buffer.  It calls
<code class="code">set-auto-mode</code> (see below).  As of Emacs 26.1, it no longer
runs <code class="code">hack-local-variables</code>, this now being done in
<code class="code">run-mode-hooks</code> at the initialization of major modes
(see <a class="pxref" href="Mode-Hooks.html">Mode Hooks</a>).
</p>
<p>If the <var class="var">find-file</var> argument to <code class="code">normal-mode</code> is non-<code class="code">nil</code>,
<code class="code">normal-mode</code> assumes that the <code class="code">find-file</code> function is calling
it.  In this case, it may process local variables in the &lsquo;<samp class="samp">-*-</samp>&rsquo;
line or at the end of the file.  The variable
<code class="code">enable-local-variables</code> controls whether to do so.  See <a data-manual="emacs" href="https://www.gnu.org/software/emacs/manual/html_node/emacs/File-Variables.html#File-Variables">Local Variables in Files</a> in <cite class="cite">The GNU Emacs Manual</cite>,
for the syntax of the local variables section of a file.
</p>
<p>If you run <code class="code">normal-mode</code> interactively, the argument
<var class="var">find-file</var> is normally <code class="code">nil</code>.  In this case,
<code class="code">normal-mode</code> unconditionally processes any file local variables.
</p>
<p>The function calls <code class="code">set-auto-mode</code> to choose and set a major
mode.  If this does not specify a mode, the buffer stays in the major
mode determined by the default value of <code class="code">major-mode</code> (see below).
</p>
<a class="index-entry-id" id="index-file-mode-specification-error"></a>
<p><code class="code">normal-mode</code> uses <code class="code">condition-case</code> around the call to the
major mode command, so errors are caught and reported as a &lsquo;<samp class="samp">File
mode specification error</samp>&rsquo;, followed by the original error message.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-set_002dauto_002dmode"><span class="category-def">Function: </span><span><strong class="def-name">set-auto-mode</strong> <var class="def-var-arguments">&amp;optional keep-mode-if-same</var><a class="copiable-link" href="#index-set_002dauto_002dmode"> &para;</a></span></dt>
<dd><a class="index-entry-id" id="index-visited-file-mode"></a>
<p>This function selects and sets the major mode that is appropriate
for the current buffer.  It bases its decision (in order of
precedence) on the &lsquo;<samp class="samp">-*-</samp>&rsquo;<!-- /@w --> line, on any &lsquo;<samp class="samp">mode:</samp>&rsquo; local
variable near the end of a file, on the &lsquo;<samp class="samp">#!</samp>&rsquo;<!-- /@w --> line (using
<code class="code">interpreter-mode-alist</code>), on the text at the beginning of the
buffer (using <code class="code">magic-mode-alist</code>), and finally on the visited
file name (using <code class="code">auto-mode-alist</code>).  See <a data-manual="emacs" href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Choosing-Modes.html#Choosing-Modes">How
Major Modes are Chosen</a> in <cite class="cite">The GNU Emacs Manual</cite>.  If
<code class="code">enable-local-variables</code> is <code class="code">nil</code>, <code class="code">set-auto-mode</code> does
not check the &lsquo;<samp class="samp">-*-</samp>&rsquo;<!-- /@w --> line, or near the end of the file, for
any mode tag.
</p>
<a class="index-entry-id" id="index-inhibit_002dlocal_002dvariables_002dregexps-1"></a>
<p>There are some file types where it is not appropriate to scan the file
contents for a mode specifier.  For example, a tar archive may happen to
contain, near the end of the file, a member file that has a local
variables section specifying a mode for that particular file.  This
should not be applied to the containing tar file.  Similarly, a tiff
image file might just happen to contain a first line that seems to
match the &lsquo;<samp class="samp">-*-</samp>&rsquo;<!-- /@w --> pattern.  For these reasons, both these file
extensions are members of the list <code class="code">inhibit-local-variables-regexps</code>.
Add patterns to this list to prevent Emacs searching them for local
variables of any kind (not just mode specifiers).
</p>
<p>If <var class="var">keep-mode-if-same</var> is non-<code class="code">nil</code>, this function does not
call the mode command if the buffer is already in the proper major
mode.  For instance, <code class="code">set-visited-file-name</code> sets this to
<code class="code">t</code> to avoid killing buffer local variables that the user may
have set.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-set_002dbuffer_002dmajor_002dmode"><span class="category-def">Function: </span><span><strong class="def-name">set-buffer-major-mode</strong> <var class="def-var-arguments">buffer</var><a class="copiable-link" href="#index-set_002dbuffer_002dmajor_002dmode"> &para;</a></span></dt>
<dd><p>This function sets the major mode of <var class="var">buffer</var> to the default value of
<code class="code">major-mode</code>; if that is <code class="code">nil</code>, it uses the
current buffer&rsquo;s major mode (if that is suitable).  As an exception,
if <var class="var">buffer</var>&rsquo;s name is <samp class="file">*scratch*</samp>, it sets the mode to
<code class="code">initial-major-mode</code>.
</p>
<p>The low-level primitives for creating buffers do not use this function,
but medium-level commands such as <code class="code">switch-to-buffer</code> and
<code class="code">find-file-noselect</code> use it whenever they create buffers.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-initial_002dmajor_002dmode"><span class="category-def">User Option: </span><span><strong class="def-name">initial-major-mode</strong><a class="copiable-link" href="#index-initial_002dmajor_002dmode"> &para;</a></span></dt>
<dd><a class="index-entry-id" id="index-_002ascratch_002a"></a>
<p>The value of this variable determines the major mode of the initial
<samp class="file">*scratch*</samp> buffer.  The value should be a symbol that is a major
mode command.  The default value is <code class="code">lisp-interaction-mode</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-interpreter_002dmode_002dalist"><span class="category-def">Variable: </span><span><strong class="def-name">interpreter-mode-alist</strong><a class="copiable-link" href="#index-interpreter_002dmode_002dalist"> &para;</a></span></dt>
<dd><p>This variable specifies major modes to use for scripts that specify a
command interpreter in a &lsquo;<samp class="samp">#!</samp>&rsquo; line.  Its value is an alist with
elements of the form <code class="code">(<var class="var">regexp</var> . <var class="var">mode</var>)</code>; this says to
use mode <var class="var">mode</var> if the file specifies an interpreter which matches
<code class="code">\\`<var class="var">regexp</var>\\'</code>.  For example, one of the default elements
is <code class="code">(&quot;python[0-9.]*&quot; . python-mode)</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-magic_002dmode_002dalist"><span class="category-def">Variable: </span><span><strong class="def-name">magic-mode-alist</strong><a class="copiable-link" href="#index-magic_002dmode_002dalist"> &para;</a></span></dt>
<dd><p>This variable&rsquo;s value is an alist with elements of the form
<code class="code">(<var class="var">regexp</var> .  <var class="var">function</var>)</code>, where <var class="var">regexp</var> is a
regular expression and <var class="var">function</var> is a function or <code class="code">nil</code>.
After visiting a file, <code class="code">set-auto-mode</code> calls <var class="var">function</var> if
the text at the beginning of the buffer matches <var class="var">regexp</var> and
<var class="var">function</var> is non-<code class="code">nil</code>; if <var class="var">function</var> is <code class="code">nil</code>,
<code class="code">auto-mode-alist</code> gets to decide the mode.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-magic_002dfallback_002dmode_002dalist"><span class="category-def">Variable: </span><span><strong class="def-name">magic-fallback-mode-alist</strong><a class="copiable-link" href="#index-magic_002dfallback_002dmode_002dalist"> &para;</a></span></dt>
<dd><p>This works like <code class="code">magic-mode-alist</code>, except that it is handled
only if <code class="code">auto-mode-alist</code> does not specify a mode for this file.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-auto_002dmode_002dalist"><span class="category-def">Variable: </span><span><strong class="def-name">auto-mode-alist</strong><a class="copiable-link" href="#index-auto_002dmode_002dalist"> &para;</a></span></dt>
<dd><p>This variable contains an association list of file name patterns
(regular expressions) and corresponding major mode commands.  Usually,
the file name patterns test for suffixes, such as &lsquo;<samp class="samp">.el</samp>&rsquo; and
&lsquo;<samp class="samp">.c</samp>&rsquo;, but this need not be the case.  An ordinary element of the
alist looks like <code class="code">(<var class="var">regexp</var> .  <var class="var">mode-function</var>)</code>.
</p>
<p>For example,
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">((&quot;\\`/tmp/fol/&quot; . text-mode)
 (&quot;\\.texinfo\\'&quot; . texinfo-mode)
 (&quot;\\.texi\\'&quot; . texinfo-mode)
</pre></div><div class="group"><pre class="example-preformatted"> (&quot;\\.el\\'&quot; . emacs-lisp-mode)
 (&quot;\\.c\\'&quot; . c-mode)
 (&quot;\\.h\\'&quot; . c-mode)
 ...)
</pre></div></div>

<p>When you visit a file whose expanded file name (see <a class="pxref" href="File-Name-Expansion.html">Functions that Expand Filenames</a>), with version numbers and backup suffixes removed using
<code class="code">file-name-sans-versions</code> (see <a class="pxref" href="File-Name-Components.html">File Name Components</a>), matches
a <var class="var">regexp</var>, <code class="code">set-auto-mode</code> calls the corresponding
<var class="var">mode-function</var>.  This feature enables Emacs to select the proper
major mode for most files.
</p>
<p>If an element of <code class="code">auto-mode-alist</code> has the form <code class="code">(<var class="var">regexp</var>
<var class="var">function</var> t)</code>, then after calling <var class="var">function</var>, Emacs searches
<code class="code">auto-mode-alist</code> again for a match against the portion of the file
name that did not match before.  This feature is useful for
uncompression packages: an entry of the form <code class="code">(&quot;\\.gz\\'&quot;
<var class="var">function</var> t)</code> can uncompress the file and then put the uncompressed
file in the proper mode according to the name sans &lsquo;<samp class="samp">.gz</samp>&rsquo;.
</p>
<p>If <code class="code">auto-mode-alist</code> has more than one element whose <var class="var">regexp</var>
matches the file name, Emacs will use the first match.
</p>
<p>Here is an example of how to prepend several pattern pairs to
<code class="code">auto-mode-alist</code>.  (You might use this sort of expression in your
init file.)
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">(setq auto-mode-alist
  (append
   ;; <span class="r">File name (within directory) starts with a dot.</span>
   '((&quot;/\\.[^/]*\\'&quot; . fundamental-mode)
     ;; <span class="r">File name has no dot.</span>
     (&quot;/[^\\./]*\\'&quot; . fundamental-mode)
     ;; <span class="r">File name ends in &lsquo;<samp class="samp">.C</samp>&rsquo;.</span>
     (&quot;\\.C\\'&quot; . c++-mode))
   auto-mode-alist))
</pre></div></div>
</dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Mode-Help.html">Getting Help about a Major Mode</a>, Previous: <a href="Major-Mode-Conventions.html">Major Mode Conventions</a>, Up: <a href="Major-Modes.html">Major Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
