<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 28.1.

Copyright Â© 1990-1996, 1998-2022 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Auto-Indentation (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Auto-Indentation (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Auto-Indentation (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Modes.html" rel="up" title="Modes">
<link href="Desktop-Save-Mode.html" rel="next" title="Desktop Save Mode">
<link href="Font-Lock-Mode.html" rel="prev" title="Font Lock Mode">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Auto_002dIndentation">
<div class="nav-panel">
<p>
Next: <a href="Desktop-Save-Mode.html" accesskey="n" rel="next">Desktop Save Mode</a>, Previous: <a href="Font-Lock-Mode.html" accesskey="p" rel="prev">Font Lock Mode</a>, Up: <a href="Modes.html" accesskey="u" rel="up">Major and Minor Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Automatic-Indentation-of-code"><span>24.7 Automatic Indentation of code<a class="copiable-link" href="#Automatic-Indentation-of-code"> &para;</a></span></h3>

<p>For programming languages, an important feature of a major mode is to
provide automatic indentation.  There are two parts: one is to decide what
is the right indentation of a line, and the other is to decide when to
reindent a line.  By default, Emacs reindents a line whenever you
type a character in <code class="code">electric-indent-chars</code>, which by default only
includes Newline.  Major modes can add chars to <code class="code">electric-indent-chars</code>
according to the syntax of the language.
</p>
<p>Deciding what is the right indentation is controlled in Emacs by
<code class="code">indent-line-function</code> (see <a class="pxref" href="Mode_002dSpecific-Indent.html">Indentation Controlled by Major Mode</a>).  For some modes,
the <em class="emph">right</em> indentation cannot be known reliably, typically because
indentation is significant so several indentations are valid but with different
meanings.  In that case, the mode should set <code class="code">electric-indent-inhibit</code> to
make sure the line is not constantly re-indented against the user&rsquo;s wishes.
</p>
<p>Writing a good indentation function can be difficult and to a large extent it
is still a black art.  Many major mode authors will start by writing a simple
indentation function that works for simple cases, for example by comparing with
the indentation of the previous text line.  For most programming languages that
are not really line-based, this tends to scale very poorly: improving
such a function to let it handle more diverse situations tends to become more
and more difficult, resulting in the end with a large, complex, unmaintainable
indentation function which nobody dares to touch.
</p>
<p>A good indentation function will usually need to actually parse the
text, according to the syntax of the language.  Luckily, it is not
necessary to parse the text in as much detail as would be needed
for a compiler, but on the other hand, the parser embedded in the
indentation code will want to be somewhat friendly to syntactically
incorrect code.
</p>
<p>Good maintainable indentation functions usually fall into two categories:
either parsing forward from some safe starting point until the
position of interest, or parsing backward from the position of interest.
Neither of the two is a clearly better choice than the other: parsing
backward is often more difficult than parsing forward because
programming languages are designed to be parsed forward, but for the
purpose of indentation it has the advantage of not needing to
guess a safe starting point, and it generally enjoys the property
that only a minimum of text will be analyzed to decide the indentation
of a line, so indentation will tend to be less affected by syntax errors in
some earlier unrelated piece of code.  Parsing forward on the other hand
is usually easier and has the advantage of making it possible to
reindent efficiently a whole region at a time, with a single parse.
</p>
<p>Rather than write your own indentation function from scratch, it is
often preferable to try and reuse some existing ones or to rely
on a generic indentation engine.  There are sadly few such
engines.  The CC-mode indentation code (used with C, C++, Java, Awk
and a few other such modes) has been made more generic over the years,
so if your language seems somewhat similar to one of those languages,
you might try to use that engine.  Another one is SMIE which takes an approach in the spirit
of Lisp sexps and adapts it to non-Lisp languages.
</p>

<ul class="mini-toc">
<li><a href="SMIE.html" accesskey="1">Simple Minded Indentation Engine</a></li>
</ul>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Desktop-Save-Mode.html">Desktop Save Mode</a>, Previous: <a href="Font-Lock-Mode.html">Font Lock Mode</a>, Up: <a href="Modes.html">Major and Minor Modes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
