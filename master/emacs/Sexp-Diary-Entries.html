<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Manual,
updated for Emacs version 29.0.50.

Copyright © 1985-1987, 1993-2021 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "The GNU Manifesto," "Distribution" and
"GNU GENERAL PUBLIC LICENSE," with the Front-Cover Texts being "A GNU
Manual," and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Sexp Diary Entries (GNU Emacs Manual)</title>

<meta name="description" content="Sexp Diary Entries (GNU Emacs Manual)">
<meta name="keywords" content="Sexp Diary Entries (GNU Emacs Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Key-Index.html" rel="index" title="Key Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Advanced-Calendar_002fDiary-Usage.html" rel="up" title="Advanced Calendar/Diary Usage">
<link href="Sending-Mail.html" rel="next" title="Sending Mail">
<link href="Fancy-Diary-Display.html" rel="prev" title="Fancy Diary Display">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<span id="Sexp-Diary-Entries"></span><div class="header">
<p>
Previous: <a href="Fancy-Diary-Display.html" accesskey="p" rel="prev">Fancy Diary Display</a>, Up: <a href="Advanced-Calendar_002fDiary-Usage.html" accesskey="u" rel="up">Advanced Calendar/Diary Usage</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Sexp-Entries-and-the-Fancy-Diary-Display"></span><h4 class="subsection">31.13.10 Sexp Entries and the Fancy Diary Display</h4>
<span id="index-sexp-diary-entries"></span>

<span id="index-diary_002dsexp_002dentry_002dsymbol"></span>
<p>Sexp diary entries allow you to do more than just have complicated
conditions under which a diary entry applies.  Sexp entries should be
preceded by <code>diary-sexp-entry-symbol</code> (default &lsquo;<samp>%%</samp>&rsquo;) in the
diary file.  With the fancy diary display, sexp entries can generate the
text of the entry depending on the date itself.
</p>
<p>For example, an anniversary diary entry can insert
the number of years since the anniversary date into the text of the
diary entry.  Thus the &lsquo;<samp>%d</samp>&rsquo; in this diary entry:
</p>
<span id="index-diary_002danniversary_002c-and-sexp-diary-entries"></span>
<div class="example">
<pre class="example">%%(diary-anniversary 10 31 1948) Arthur's birthday (%d years old)
</pre></div>

<p>gets replaced by the age, so on October 31, 1990 the entry appears in
the fancy diary buffer like this:
</p>
<div class="example">
<pre class="example">Arthur's birthday (42 years old)
</pre></div>

<p>If the diary file instead contains this entry:
</p>
<div class="example">
<pre class="example">%%(diary-anniversary 10 31 1948) Arthur's %d%s birthday
</pre></div>

<p>the entry in the fancy diary buffer for October 31, 1990 appears like this:
</p>
<div class="example">
<pre class="example">Arthur's 42nd birthday
</pre></div>

<p>Similarly, cyclic diary entries can interpolate the number of repetitions
that have occurred:
</p>
<span id="index-diary_002dcyclic_002c-and-sexp-diary-entries"></span>
<div class="example">
<pre class="example">%%(diary-cyclic 50 1 1 2012) Renew medication (%d%s time)
</pre></div>

<p>looks like this:
</p>
<div class="example">
<pre class="example">Renew medication (5th time)
</pre></div>

<p>in the fancy diary display on September 7, 2012.
</p>
<p>There is an early-reminder diary sexp that includes its entry in the
diary not only on the date of occurrence, but also on earlier dates.
For example, if you want a reminder a week before your anniversary, you
can use
</p>
<span id="index-diary_002dremind"></span>
<div class="example">
<pre class="example">%%(diary-remind '(diary-anniversary 12 22 1968) 7) Ed's anniversary
</pre></div>

<p>and the fancy diary will show &lsquo;<samp>Ed's anniversary</samp>&rsquo; both on December
15 and on December 22.
</p>
<span id="index-diary_002ddate"></span>
<p>The function <code>diary-date</code> applies to dates described by a month,
day, year combination, each of which can be an integer, a list of
integers, or <code>t</code> (meaning all values).  For example,
</p>
<div class="example">
<pre class="example">%%(diary-date '(10 11 12) 22 t) Rake leaves
</pre></div>

<p>causes the fancy diary to show
</p>
<div class="example">
<pre class="example">Rake leaves
</pre></div>

<p>on October 22, November 22, and December 22 of every year.
</p>
<span id="index-diary_002dfloat_002c-and-sexp-diary-entries"></span>
<p>The function <code>diary-float</code> allows you to describe diary entries
that apply to dates like the third Friday of November, or the last
Tuesday in April.  The parameters are the <var>month</var>, <var>dayname</var>,
and an index <var>n</var>.  The entry appears on the <var>n</var>th <var>dayname</var>
after the first day of <var>month</var>, where <var>dayname</var>=0 means Sunday,
1 means Monday, and so on.  If <var>n</var> is negative it counts backward
from the end of <var>month</var>.  The value of <var>month</var> can be a list of
months, a single month, or <code>t</code> to specify all months.  You can also
use an optional parameter <var>day</var> to specify the <var>n</var>th
<var>dayname</var> on or after/before <var>day</var> of <var>month</var>; the value of
<var>day</var> defaults to 1 if <var>n</var> is positive and to the last day of
<var>month</var> if <var>n</var> is negative.  For example,
</p>
<div class="example">
<pre class="example">%%(diary-float t 1 -1) Pay rent
</pre></div>

<p>causes the fancy diary to show
</p>
<div class="example">
<pre class="example">Pay rent
</pre></div>

<p>on the last Monday of every month.
</p>
<p>The generality of sexp diary entries lets you specify any diary
entry that you can describe algorithmically.  A sexp diary entry
contains an expression that computes whether the entry applies to any
given date.  If its value is non-<code>nil</code>, the entry applies to that
date; otherwise, it does not.  The expression can use the variable
<code>date</code> to find the date being considered; its value is a list
(<var>month</var> <var>day</var> <var>year</var>) that refers to the Gregorian
calendar.
</p>
<p>The sexp diary entry applies to a date when the expression&rsquo;s value
is non-<code>nil</code>, but some values have more specific meanings.  If
the value is a string, that string is a description of the event which
occurs on that date.  The value can also have the form
<code>(<var>mark</var> . <var>string</var>)</code>; then <var>mark</var> specifies how to
mark the date in the calendar, and <var>string</var> is the description of
the event.  If <var>mark</var> is a single-character string, that character
appears next to the date in the calendar.  If <var>mark</var> is a face
name, the date is displayed in that face.  If <var>mark</var> is
<code>nil</code>, that specifies no particular highlighting for the date.
</p>
<p>Suppose you get paid on the 21st of the month if it is a weekday, and
on the Friday before if the 21st is on a weekend.  Here is how to write
a sexp diary entry that matches those dates:
</p>
<div class="example">
<pre class="example">&amp;%%(let ((dayname (calendar-day-of-week date))
         (day (cadr date)))
      (or (and (= day 21) (memq dayname '(1 2 3 4 5)))
          (and (memq day '(19 20)) (= dayname 5)))
         ) Pay check deposited
</pre></div>

<p>The following sexp diary entries take advantage of the ability (in the fancy
diary display) to concoct diary entries whose text varies based on the date:
</p>
<span id="index-diary_002dsunrise_002dsunset"></span>
<span id="index-diary_002dlunar_002dphases"></span>
<span id="index-diary_002dday_002dof_002dyear"></span>
<span id="index-diary_002diso_002ddate"></span>
<span id="index-diary_002djulian_002ddate"></span>
<span id="index-diary_002dastro_002dday_002dnumber"></span>
<span id="index-diary_002dbahai_002ddate"></span>
<span id="index-diary_002dchinese_002ddate"></span>
<span id="index-diary_002dcoptic_002ddate"></span>
<span id="index-diary_002dethiopic_002ddate"></span>
<span id="index-diary_002dhebrew_002ddate"></span>
<span id="index-diary_002dislamic_002ddate"></span>
<span id="index-diary_002dfrench_002ddate"></span>
<span id="index-diary_002dmayan_002ddate"></span>
<span id="index-diary_002dpersian_002ddate"></span>
<dl compact="compact">
<dt><code>%%(diary-sunrise-sunset)</code></dt>
<dd><p>Make a diary entry for today&rsquo;s local times of sunrise and sunset.
</p></dd>
<dt><code>%%(diary-lunar-phases)</code></dt>
<dd><p>Make a diary entry for the phases (quarters) of the moon.
</p></dd>
<dt><code>%%(diary-day-of-year)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s day number in the current year and the number
of days remaining in the current year.
</p></dd>
<dt><code>%%(diary-iso-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent ISO commercial date.
</p></dd>
<dt><code>%%(diary-julian-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Julian calendar date.
</p></dd>
<dt><code>%%(diary-astro-day-number)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent astronomical (Julian) day number.
</p></dd>
<dt><code>%%(diary-bahai-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Bahá&rsquo;í calendar date.
</p></dd>
<dt><code>%%(diary-chinese-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Chinese calendar date.
</p></dd>
<dt><code>%%(diary-coptic-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Coptic calendar date.
</p></dd>
<dt><code>%%(diary-ethiopic-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Ethiopic calendar date.
</p></dd>
<dt><code>%%(diary-french-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent date on the French Revolutionary
calendar.
</p></dd>
<dt><code>%%(diary-hebrew-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Hebrew calendar date.
</p></dd>
<dt><code>%%(diary-islamic-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Islamic calendar date.
</p></dd>
<dt><code>%%(diary-mayan-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Mayan calendar date.
</p></dd>
<dt><code>%%(diary-persian-date)</code></dt>
<dd><p>Make a diary entry with today&rsquo;s equivalent Persian calendar date.
</p></dd>
</dl>

<p>For example, including the diary entry
</p>
<div class="example">
<pre class="example">&amp;%%(diary-hebrew-date)
</pre></div>

<p>causes every day&rsquo;s diary display to contain the equivalent date on the
Hebrew calendar, if you are using the fancy diary display.  (With simple
diary display, the literal line &lsquo;<samp>&amp;%%(diary-hebrew-date)</samp>&rsquo; appears in
the diary for any date.)
</p>
<p>This function has been used to construct certain standard Hebrew sexp
diary entries:
</p>
<span id="index-rosh-hodesh"></span>
<span id="index-diary_002dhebrew_002drosh_002dhodesh"></span>
<span id="index-parasha_002c-weekly"></span>
<span id="index-diary_002dhebrew_002dparasha"></span>
<span id="index-candle-lighting-times"></span>
<span id="index-diary_002dhebrew_002dsabbath_002dcandles"></span>
<span id="index-omer-count"></span>
<span id="index-diary_002dhebrew_002domer"></span>
<span id="index-yahrzeits_002c-and-sexp-diary-entries"></span>
<span id="index-diary_002dhebrew_002dyahrzeit"></span>
<span id="index-diary_002dhebrew_002dbirthday"></span>
<dl compact="compact">
<dt><code>%%(diary-hebrew-rosh-hodesh)</code></dt>
<dd><p>Make a diary entry that tells the occurrence and ritual announcement of each
new Hebrew month.
</p></dd>
<dt><code>%%(diary-hebrew-parasha)</code></dt>
<dd><p>Make a Saturday diary entry that tells the weekly synagogue scripture reading.
</p></dd>
<dt><code>%%(diary-hebrew-sabbath-candles)</code></dt>
<dd><p>Make a Friday diary entry that tells the <em>local time</em> of Sabbath
candle lighting.
</p></dd>
<dt><code>%%(diary-hebrew-omer)</code></dt>
<dd><p>Make a diary entry that gives the omer count, when appropriate.
</p></dd>
<dt><code>%%(diary-hebrew-yahrzeit <var>month</var> <var>day</var> <var>year</var>) <var>name</var></code></dt>
<dd><p>Make a diary entry marking the anniversary of a date of death.  The date
is the <em>Gregorian</em> (civil) date of death.  The diary entry appears
on the proper Hebrew calendar anniversary and on the day before.  (The
order of the parameters changes according to the calendar date style;
for example in the European style to <var>day</var>, <var>month</var>, <var>year</var>.)
</p></dd>
<dt><code>%%(diary-hebrew-birthday <var>month</var> <var>day</var> <var>year</var>)</code></dt>
<dd><p>Make a diary entry for a birthday on the Hebrew calendar.
</p></dd>
</dl>

<p>All the functions documented above take an optional argument
<var>mark</var> which specifies how to mark the date in the calendar display.
If one of these functions decides that it applies to a certain date,
it returns a value that contains <var>mark</var>, as described above.
</p><hr>
<div class="header">
<p>
Previous: <a href="Fancy-Diary-Display.html" accesskey="p" rel="prev">Fancy Diary Display</a>, Up: <a href="Advanced-Calendar_002fDiary-Usage.html" accesskey="u" rel="up">Advanced Calendar/Diary Usage</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Key-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
