<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 31.0.50.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Touchscreen Events (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Touchscreen Events (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Touchscreen Events (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Input-Events.html" rel="up" title="Input Events">
<link href="Focus-Events.html" rel="next" title="Focus Events">
<link href="Motion-Events.html" rel="prev" title="Motion Events">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Touchscreen-Events">
<div class="nav-panel">
<p>
Next: <a href="Focus-Events.html" accesskey="n" rel="next">Focus Events</a>, Previous: <a href="Motion-Events.html" accesskey="p" rel="prev">Motion Events</a>, Up: <a href="Input-Events.html" accesskey="u" rel="up">Input Events</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Touchscreen-Events-1"><span>22.7.9 Touchscreen Events<a class="copiable-link" href="#Touchscreen-Events-1"> &para;</a></span></h4>
<a class="index-entry-id" id="index-touchscreen-events"></a>
<a class="index-entry-id" id="index-support-for-touchscreens"></a>

<p>Some window systems provide support for input devices that react to
the user&rsquo;s touching the screen and moving fingers while touching the
screen.  These input devices are known as touchscreens, and Emacs
reports the events they generate as <em class="dfn">touchscreen events</em>.
</p>
<p>Most individual events generated by a touchscreen only have meaning as
part of a larger sequence of other events: for instance, the simple
operation of tapping the touchscreen involves the user placing and
raising a finger on the touchscreen, and swiping the display to
scroll it involves placing a finger, moving it many times upwards or
downwards, and then raising the finger.
</p>
<a class="index-entry-id" id="index-touch-point_002c-in-touchscreen-events"></a>
<p>While a simplistic model consisting of one finger is adequate for taps
and scrolling, more complicated gestures require support for keeping
track of multiple fingers, where the position of each finger is
represented by a <em class="dfn">touch point</em>.  For example, a &ldquo;pinch to zoom&rdquo;
gesture might consist of the user placing two fingers and moving them
individually in opposite directions, where the distance between the
positions of their individual points determine the amount by which to
zoom the display, and the center of an imaginary line between those
positions determines where to pan the display after zooming.
</p>
<p>The low-level touchscreen events described below can be used to
implement all the touch sequences described above.  In those events,
each point is represented by a cons of an arbitrary number identifying
the point and a mouse position list (see <a class="pxref" href="Click-Events.html">Click Events</a>) specifying
the position of the finger when the event occurred.
</p>
<dl class="table">
<dt><a id="index-touchscreen_002dbegin-event"></a><span><code class="code">(touchscreen-begin <var class="var">point</var>)</code><a class="copiable-link" href="#index-touchscreen_002dbegin-event"> &para;</a></span></dt>
<dd><p>This event is sent when <var class="var">point</var> is created by the user pressing a
finger against the touchscreen.
</p>
<p>Imaginary prefix keys are also affixed to these events
<code class="code">read-key-sequence</code> when they originate on top of a special part
of a frame or window.  See <a class="xref" href="Key-Sequence-Input.html">Key Sequence Input</a>.
</p>
</dd>
<dt><a id="index-touchscreen_002dupdate-event"></a><span><code class="code">(touchscreen-update <var class="var">points</var>)</code><a class="copiable-link" href="#index-touchscreen_002dupdate-event"> &para;</a></span></dt>
<dd><p>This event is sent when a point on the touchscreen has changed
position.  <var class="var">points</var> is a list of touch points containing the
up-to-date positions of each touch point currently on the touchscreen.
</p>
</dd>
<dt><a id="index-touchscreen_002dend-event"></a><span><code class="code">(touchscreen-end <var class="var">point</var> <var class="var">canceled</var>)</code><a class="copiable-link" href="#index-touchscreen_002dend-event"> &para;</a></span></dt>
<dd><p>This event is sent when <var class="var">point</var> is no longer present on the
display, because another program took the grab, or because the user
raised the finger from the touchscreen.
</p>
<p><var class="var">canceled</var> is non-<code class="code">nil</code> if the touch sequence has been
intercepted by another program (such as the window manager), and Emacs
should undo or avoid any editing commands that would otherwise result
from the touch sequence.
</p>
<p>Imaginary prefix keys are also affixed to these events
<code class="code">read-key-sequence</code> when they originate on top of a special part
of a frame or window.
</p></dd>
</dl>

<p>If a touchpoint is pressed against the menu bar, then Emacs will not
generate any corresponding <code class="code">touchscreen-begin</code> or
<code class="code">touchscreen-end</code> events; instead, the menu bar may be displayed
after <code class="code">touchscreen-end</code> would have been delivered under other
circumstances.
</p>
<a class="index-entry-id" id="index-mouse-emulation-from-touch-screen-events"></a>
<p>When no command is bound to <code class="code">touchscreen-begin</code>,
<code class="code">touchscreen-end</code> or <code class="code">touchscreen-update</code>, Emacs calls a
&ldquo;key translation function&rdquo; (see <a class="pxref" href="Translation-Keymaps.html">Keymaps for Translating Sequences of Events</a>) to
translate key sequences containing touch screen events into ordinary
mouse events (see <a class="pxref" href="Mouse-Events.html">Mouse Events</a>.)  Since Emacs doesn&rsquo;t support
distinguishing events originating from separate mouse devices, it
assumes that a maximum of two touchpoints are active while translation
takes place, and does not place any guarantees on the results of event
translation when that restriction is overstepped.
</p>
<p>Emacs applies two different strategies for translating touch events
into mouse events, contingent on factors such as the commands bound to
keymaps that are active at the location of the
<code class="code">touchscreen-begin</code> event.  If a command is bound to
<code class="code">down-mouse-1</code> at that location, the initial translation consists
of a single <code class="code">down-mouse-1</code> event, with subsequent
<code class="code">touchscreen-update</code> events translated to mouse motion events
(see <a class="pxref" href="Motion-Events.html">Motion Events</a>), and a final <code class="code">touchscreen-end</code> event
translated to a <code class="code">mouse-1</code> or <code class="code">drag-mouse-1</code> event (unless
the <code class="code">touchscreen-end</code> event indicates that the touch sequence has
been intercepted by another program.)  This is dubbed &ldquo;simple
translation&rdquo;, and produces a simple correspondence between touchpoint
motion and mouse motion.
</p>
<a class="index-entry-id" id="index-ignored_002dmouse_002dcommand-_0028symbol-property_0029"></a>
<p>However, some commands bound to
<code class="code">down-mouse-1</code>&ndash;<code class="code">mouse-drag-region</code>, for example&ndash;either
conflict with defined touch screen gestures (such as &ldquo;long-press to
drag&rdquo;), or with user expectations for touch input, and should not
subject the touch sequence to simple translation.  If a command whose
name contains the property (see <a class="pxref" href="Symbol-Properties.html">Symbol Properties</a>)
<code class="code">ignored-mouse-command</code> is encountered or there is no command
bound to <code class="code">down-mouse-1</code>, a more irregular form of translation
takes place: here, Emacs processes touch screen gestures
(see <a data-manual="emacs" href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Touchscreens.html#Touchscreens">Touchscreens</a> in <cite class="cite">The GNU Emacs Manual</cite>) first, and
finally attempts to translate touch screen events into mouse events if
no gesture was detected prior to a closing <code class="code">touchscreen-end</code>
event (with its <var class="var">canceled</var> parameter <code class="code">nil</code>, as with simple
translation) and a command is bound to <code class="code">mouse-1</code> at the location
of that event.  Before generating the <code class="code">mouse-1</code> event, point is
also set to the location of the <code class="code">touchscreen-end</code> event, and the
window containing the position of that event is selected, as a
compromise for packages which assume <code class="code">mouse-drag-region</code> has
already set point to the location of any mouse click and selected the
window where it took place.
</p>
<p>To prevent unwanted <code class="code">mouse-1</code> events from arriving after a mouse
menu is dismissed (see <a class="pxref" href="Mouse-Menus.html">Menus and the Mouse</a>), Emacs also disables simple
translation if <code class="code">down-mouse-1</code> is bound to a keymap, making it a
prefix key.  In lieu of simple translation, it translates the closing
<code class="code">touchscreen-end</code> to a <code class="code">down-mouse-1</code> event with the starting
position of the touch sequence, consequently displaying the mouse menu.
</p>
<a class="index-entry-id" id="index-touch_002dscreen_002dsimple_002dmouse_002dconversion"></a>
<p>Simple conversion will be enabled without regard to the existence of
command or menu bindings if the variable
<code class="code">touch-screen-simple-mouse-conversion</code> is bound or set to a
non-<code class="code">nil</code> value, as, for example, it may be by a caller of
<code class="code">read-key</code> expecting to receive <code class="code">mouse-movement</code> and
<code class="code">drag-mouse-1</code> events.
</p>
<a class="index-entry-id" id="index-mouse_002d1_002dmenu_002dcommand-_0028symbol-property_0029"></a>
<p>Since certain commands are also bound to <code class="code">down-mouse-1</code> for the
purpose of displaying pop-up menus, Emacs additionally behaves as
illustrated in the last paragraph if <code class="code">down-mouse-1</code> is bound to a
command whose name has the property <code class="code">mouse-1-menu-command</code>.
</p>
<a class="index-entry-id" id="index-pinch_002dto_002dzoom-touchscreen-gesture-translation"></a>
<p>When a second touch point is registered as a touch point is already
being translated, gesture translation is terminated, and the distance
from the second touch point (the <em class="dfn">ancillary tool</em>) to the first is
measured.  Subsequent motion from either of those touch points will
yield <code class="code">touchscreen-pinch</code> events incorporating the ratio formed
by the distance between their new positions and the distance measured
at the outset, as illustrated in the following table.
</p>
<a class="index-entry-id" id="index-touchscreen-gesture-events"></a>
<p>If touch gestures are detected during translation, one of the
following input events may be generated:
</p>
<dl class="table">
<dt><a id="index-touchscreen_002dscroll-event"></a><span><code class="code">(touchscreen-scroll <var class="var">window</var> <var class="var">dx</var> <var class="var">dy</var>)</code><a class="copiable-link" href="#index-touchscreen_002dscroll-event"> &para;</a></span></dt>
<dd><p>If a &ldquo;scrolling&rdquo; gesture is detected during the translation process,
each subsequent <code class="code">touchscreen-update</code> event is translated to a
<code class="code">touchscreen-scroll</code> event, where <var class="var">dx</var> and <var class="var">dy</var> specify,
in pixels, the relative motion of the touchpoint from the position of
the <code class="code">touchscreen-begin</code> event that started the sequence or the
last <code class="code">touchscreen-scroll</code> event, whichever came later.
</p>
</dd>
<dt><a id="index-touchscreen_002dhold-event"></a><span><code class="code">(touchscreen-hold <var class="var">posn</var>)</code><a class="copiable-link" href="#index-touchscreen_002dhold-event"> &para;</a></span></dt>
<dd><p>If the single active touchpoint remains stationary for more than
<code class="code">touch-screen-delay</code> seconds after a <code class="code">touchscreen-begin</code> is
generated, a &ldquo;long-press&rdquo; gesture is detected during the translation
process, and a <code class="code">touchscreen-hold</code> event is sent, with <var class="var">posn</var>
set to a mouse position list containing the position of the
<code class="code">touchscreen-begin</code> event.
</p>
</dd>
<dt><a id="index-touchscreen_002ddrag-event"></a><span><code class="code">(touchscreen-drag <var class="var">posn</var>)</code><a class="copiable-link" href="#index-touchscreen_002ddrag-event"> &para;</a></span></dt>
<dd><p>If a &ldquo;long-press&rdquo; gesture is detected while translating the current
touch sequence or &ldquo;drag-to-select&rdquo; is being resumed as a result of
the <code class="code">touch-screen-extend-selection</code> user option, a
<code class="code">touchscreen-drag</code> event is sent upon each subsequent
<code class="code">touchscreen-update</code> event with <var class="var">posn</var> set to the new
position of the touchpoint.
</p>
</dd>
<dt><a id="index-touchscreen_002drestart_002ddrag-event"></a><span><code class="code">(touchscreen-restart-drag <var class="var">posn</var>)</code><a class="copiable-link" href="#index-touchscreen_002drestart_002ddrag-event"> &para;</a></span></dt>
<dd><p>This event is sent upon the start of a touch sequence resulting in the
continuation of a &ldquo;drag-to-select&rdquo; gesture (subject to the
aforementioned user option) with <var class="var">posn</var> set to the position list of
the initial <code class="code">touchscreen-begin</code> event within that touch sequence.
</p>
</dd>
<dt><a id="index-touchscreen_002dpinch-event"></a><span><code class="code">(touchscreen-pinch <var class="var">posn</var> <var class="var">ratio</var> <var class="var">pan-x</var> <var class="var">pan-y</var> <var class="var">ratio-diff</var>)</code><a class="copiable-link" href="#index-touchscreen_002dpinch-event"> &para;</a></span></dt>
<dd><p>This event is delivered upon significant changes to the positions of
either active touch point when an ancillary tool is active.
</p>
<p><var class="var">posn</var> is a mouse position list for the midpoint of a line drawn
from the ancillary tool to the other touch point being observed.
</p>
<p><var class="var">ratio</var> is the distance between both touch points being observed
divided by that distance when the ancillary point was first
registered; which is to say, the scale of the &ldquo;pinch&rdquo; gesture.
</p>
<p><var class="var">pan-x</var> and <var class="var">pan-y</var> are the difference between the pixel
position of <var class="var">posn</var> and this position within the last event
delivered appertaining to this series of touch events, or in the case
that no such event exists, the centerpoint between both touch points
when the ancillary tool was first registered.
</p>
<p><var class="var">ratio-diff</var> is the difference between this event&rsquo;s ratio and
<var class="var">ratio</var> in the last event delivered; it is <var class="var">ratio</var> if no such
event exists.
</p>
<p>Such events are sent when the magnitude of the changes they represent
will yield a <var class="var">ratio</var> which differs by more than <code class="code">0.2</code> from
that in the previous event, or the sum of <var class="var">pan-x</var> and <var class="var">pan-y</var>
will surpass half the frame&rsquo;s character width in pixels (see <a class="pxref" href="Frame-Font.html">Frame Font</a>).
</p></dd>
</dl>

<a class="index-entry-id" id="index-handling-touch-screen-events"></a>
<a class="index-entry-id" id="index-tap-and-drag_002c-touch-screen-gestures"></a>
<p>Several functions are provided for Lisp programs that handle touch
screen events.  The intended use of the first two functions described
below is from commands bound directly to <code class="code">touchscreen-begin</code>
events; they allow responding to commonly used touch screen gestures
separately from mouse event translation.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-touch_002dscreen_002dtrack_002dtap"><span class="category-def">Function: </span><span><strong class="def-name">touch-screen-track-tap</strong> <var class="def-var-arguments">event &amp;optional update data threshold</var><a class="copiable-link" href="#index-touch_002dscreen_002dtrack_002dtap"> &para;</a></span></dt>
<dd><p>This function is used to track a single &ldquo;tap&rdquo; gesture originating
from the <code class="code">touchscreen-begin</code> event <var class="var">event</var>, often used to
set the point or to activate a button.  It waits for a
<code class="code">touchscreen-end</code> event with the same touch identifier to arrive,
at which point it returns <code class="code">t</code>, signifying the end of the gesture.
</p>
<p>If a <code class="code">touchscreen-update</code> event arrives in the mean time and
contains at least one touchpoint with the same identifier as in
<var class="var">event</var>, the function <var class="var">update</var> is called with two arguments,
the list of touchpoints in that <code class="code">touchscreen-update</code> event, and
<var class="var">data</var>.
</p>
<p>If <var class="var">threshold</var> is non-<code class="code">nil</code> and such an event indicates that
the touchpoint represented by <var class="var">event</var> has moved beyond a threshold
of either <var class="var">threshold</var> or 10 pixels if it is not a number from the
position of <var class="var">event</var>, <code class="code">nil</code> is returned and mouse event
translation is resumed for that touchpoint, so as not to impede the
recognition of any subsequent touchscreen gesture arising from its
sequence.
</p>
<p>If any other event arrives in the mean time, <code class="code">nil</code> is returned.
The caller should not perform any action in that case.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-touch_002dscreen_002dtrack_002ddrag"><span class="category-def">Function: </span><span><strong class="def-name">touch-screen-track-drag</strong> <var class="def-var-arguments">event update &amp;optional data</var><a class="copiable-link" href="#index-touch_002dscreen_002dtrack_002ddrag"> &para;</a></span></dt>
<dd><p>This function is used to track a single &ldquo;drag&rdquo; gesture originating
from the <code class="code">touchscreen-begin</code> event <code class="code">event</code>.
</p>
<p>It behaves like <code class="code">touch-screen-track-tap</code>, except that it returns
<code class="code">no-drag</code> and refrains from calling <var class="var">update</var> if the
touchpoint in <code class="code">event</code> did not move far enough (by default, 5
pixels from its position in <code class="code">event</code>) to qualify as an actual
drag.
</p></dd></dl>

<p>In addition to those two functions, a function is provided for
commands bound to some types of events generated through mouse event
translation to prevent unwanted events from being generated after it
is called.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-touch_002dscreen_002dinhibit_002ddrag"><span class="category-def">Function: </span><span><strong class="def-name">touch-screen-inhibit-drag</strong><a class="copiable-link" href="#index-touch_002dscreen_002dinhibit_002ddrag"> &para;</a></span></dt>
<dd><p>This function inhibits the generation of <code class="code">touchscreen-drag</code>
events during mouse event translation for the duration of the touch
sequence being translated after it is called.  It must be called from
a command which is bound to a <code class="code">touchscreen-hold</code> or
<code class="code">touchscreen-drag</code> event, and signals an error otherwise.
</p>
<p>Since this function can only be called after a gesture is already
recognized during mouse event translation, no mouse events will be
generated from touch events constituting the previously mentioned
touch sequence after it is called.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Focus-Events.html">Focus Events</a>, Previous: <a href="Motion-Events.html">Motion Events</a>, Up: <a href="Input-Events.html">Input Events</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
