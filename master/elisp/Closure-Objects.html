<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 31.0.50.

Copyright Â© 1990-1996, 1998-2026 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Closure Objects (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Closure Objects (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Closure Objects (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Byte-Compilation.html" rel="up" title="Byte Compilation">
<link href="Disassembly.html" rel="next" title="Disassembly">
<link href="Compiler-Errors.html" rel="prev" title="Compiler Errors">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Closure-Objects">
<div class="nav-panel">
<p>
Next: <a href="Disassembly.html" accesskey="n" rel="next">Disassembled Byte-Code</a>, Previous: <a href="Compiler-Errors.html" accesskey="p" rel="prev">Compiler Errors</a>, Up: <a href="Byte-Compilation.html" accesskey="u" rel="up">Byte Compilation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Closure-Function-Objects"><span>17.6 Closure Function Objects<a class="copiable-link" href="#Closure-Function-Objects"> &para;</a></span></h3>
<a class="index-entry-id" id="index-compiled-function"></a>
<a class="index-entry-id" id="index-byte_002dcode-function"></a>
<a class="index-entry-id" id="index-byte_002dcode-object"></a>

<p>Byte-compiled functions use a special data type: they are closures.
Closures are used both for byte-compiled Lisp functions as well as for
interpreted Lisp functions.  Whenever such an object appears as
a function to be called, Emacs uses the appropriate interpreter to
execute either the byte-code or the non-compiled Lisp code.
</p>
<p>Internally, a closure is much like a vector; its
elements can be accessed using <code class="code">aref</code>.  Its printed
representation is like that for a vector, with an additional &lsquo;<samp class="samp">#</samp>&rsquo;
before the opening &lsquo;<samp class="samp">[</samp>&rsquo;.  It must have at least three elements;
there is no maximum number, but only the first six elements have any
normal use.  They are:
</p>
<dl class="table">
<dt><var class="var">argdesc</var></dt>
<dd><p>The descriptor of the arguments.  This can either be a list of
arguments, as described in <a class="ref" href="Argument-List.html">Features of Argument Lists</a>, or an integer encoding
the required number of arguments.  In the latter case, the value of
the descriptor specifies the minimum number of arguments in the bits
zero to 6, and the maximum number of arguments in bits 8 to 14.  If
the argument list uses <code class="code">&amp;rest</code>, then bit 7 is set; otherwise it&rsquo;s
cleared.
</p>
<p>When the closure is a byte-code function,
if <var class="var">argdesc</var> is a list, the arguments will be dynamically bound
before executing the byte code.  If <var class="var">argdesc</var> is an integer, the
arguments will be instead pushed onto the stack of the byte-code
interpreter, before executing the code.
</p>
</dd>
<dt><var class="var">code</var></dt>
<dd><p>For interpreted functions, this element is the (non-empty) list of Lisp
forms that make up the function&rsquo;s body.  For byte-compiled functions, it
is the string containing the byte-code instructions.
</p>
</dd>
<dt><var class="var">constants</var></dt>
<dd><p>For byte-compiled functions, this holds the vector of Lisp objects
referenced by the byte code.  These include symbols used as function
names and variable names.
For interpreted functions, this is <code class="code">nil</code> if the function is using the old
dynamically scoped dialect of Emacs Lisp, and otherwise it holds the
function&rsquo;s lexical environment.
</p>
</dd>
<dt><var class="var">stacksize</var></dt>
<dd><p>The maximum stack size this function needs.  This element is left unused
for interpreted functions.
</p>
</dd>
<dt><var class="var">docstring</var></dt>
<dd><p>The documentation string (if any); otherwise, <code class="code">nil</code>.  The value may
be a number or a list, in case the documentation string is stored in a
file.  Use the function <code class="code">documentation</code> to get the real
documentation string (see <a class="pxref" href="Accessing-Documentation.html">Access to Documentation Strings</a>).
</p>
</dd>
<dt><var class="var">interactive</var></dt>
<dd><p>The interactive spec (if any).  This can be a string or a Lisp
expression.  It is <code class="code">nil</code> for a function that isn&rsquo;t interactive.
</p></dd>
</dl>

<p>Here&rsquo;s an example of a byte-code function object, in printed
representation.  It is the definition of the command
<code class="code">backward-sexp</code>.
</p>
<div class="example">
<pre class="example-preformatted">#[256
  &quot;\211\204^G^@\300\262^A\301^A[!\207&quot;
  [1 forward-sexp]
  3
  1793299
  &quot;^p&quot;]
</pre></div>

<p>The primitive way to create a byte-code object is with
<code class="code">make-byte-code</code>:
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-make_002dbyte_002dcode"><span class="category-def">Function: </span><span><strong class="def-name">make-byte-code</strong> <var class="def-var-arguments">&amp;rest elements</var><a class="copiable-link" href="#index-make_002dbyte_002dcode"> &para;</a></span></dt>
<dd><p>This function constructs and returns a closure which represents the
byte-code function object with <var class="var">elements</var> as its elements.
</p></dd></dl>

<p>You should not try to come up with the elements for a byte-code
function yourself, because if they are inconsistent, Emacs may crash
when you call the function.  Always leave it to the byte compiler to
create these objects; it makes the elements consistent (we hope).
</p>
<p>The primitive way to create an interpreted function is with
<code class="code">make-interpreted-closure</code>:
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-make_002dinterpreted_002dclosure"><span class="category-def">Function: </span><span><strong class="def-name">make-interpreted-closure</strong> <var class="def-var-arguments">args body env &amp;optional docstring iform</var><a class="copiable-link" href="#index-make_002dinterpreted_002dclosure"> &para;</a></span></dt>
<dd><p>This function constructs and returns a closure representing the
interpreted function with arguments <var class="var">args</var> and whose body is made of
<var class="var">body</var> which must be a non-<code class="code">nil</code> list of Lisp forms.  <var class="var">env</var> is the
lexical environment in the same form as used with <code class="code">eval</code>
(see <a class="pxref" href="Eval.html">Eval</a>).  The documentation <var class="var">docstring</var> if non-<code class="code">nil</code> should be
a string, and the interactive form <var class="var">iform</var> if non-<code class="code">nil</code> should be of
the form <code class="code">(interactive&nbsp;<var class="var">arg-descriptor</var>)</code><!-- /@w --> (see <a class="pxref" href="Using-Interactive.html">Using <code class="code">interactive</code></a>).
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Disassembly.html">Disassembled Byte-Code</a>, Previous: <a href="Compiler-Errors.html">Compiler Errors</a>, Up: <a href="Byte-Compilation.html">Byte Compilation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
