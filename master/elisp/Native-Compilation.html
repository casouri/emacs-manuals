<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 31.0.50.

Copyright Â© 1990-1996, 1998-2026 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Native Compilation (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Native Compilation (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Native Compilation (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index.html" rel="up" title="Top">
<link href="Debugging.html" rel="next" title="Debugging">
<link href="Byte-Compilation.html" rel="prev" title="Byte Compilation">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="chapter-level-extent" id="Native-Compilation">
<div class="nav-panel">
<p>
Next: <a href="Debugging.html" accesskey="n" rel="next">Debugging Lisp Programs</a>, Previous: <a href="Byte-Compilation.html" accesskey="p" rel="prev">Byte Compilation</a>, Up: <a href="index.html" accesskey="u" rel="up">Emacs Lisp</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h2 class="chapter" id="Compilation-of-Lisp-to-Native-Code"><span>18 Compilation of Lisp to Native Code<a class="copiable-link" href="#Compilation-of-Lisp-to-Native-Code"> &para;</a></span></h2>
<a class="index-entry-id" id="index-native-compilation"></a>
<a class="index-entry-id" id="index-compilation-to-native-code-_0028Emacs-Lisp_0029"></a>

<a class="index-entry-id" id="index-native-code"></a>
<p>In addition to the byte-compilation, described in <a class="ref" href="Byte-Compilation.html">the previous chapter</a>, Emacs can also optionally compile
Lisp function definitions into a true compiled code, known as
<em class="dfn">native code</em>.  This feature uses the <samp class="file">libgccjit</samp> library,
which is part of the GCC distribution, and requires that Emacs be
built with support for using that library.  It also requires GCC and
Binutils (the assembler and linker) to be available on your system for
you to be able to native-compile Lisp code.
</p>
<a class="index-entry-id" id="index-native_002dcompile_002c-a-Lisp-feature"></a>
<p>To determine whether the current Emacs process can produce and load
natively compiled Lisp code, call
<code class="code">native-comp-available-p</code> (see <a class="pxref" href="Native_002dCompilation-Functions.html">Native-Compilation Functions</a>).
</p>
<p>Unlike byte-compiled code, native-compiled Lisp code is executed
directly by the machine&rsquo;s hardware, and therefore runs at full speed
that the host CPU can provide.  The resulting speedup generally
depends on what the Lisp code does, but is usually 2.5 to 5 times
faster than the corresponding byte-compiled code.
</p>
<p>Since native code is generally incompatible between different
systems, the native-compiled code is <em class="emph">not</em> transportable from
one machine to another, it can only be used on the same machine where
it was produced or on very similar ones (having the same CPU and
run-time libraries).  The transportability of native-compiled code
is the same as that of shared libraries (<samp class="file">.so</samp> or <samp class="file">.dll</samp>
files).
</p>
<p>Libraries of native-compiled code include crucial dependencies on
Emacs Lisp primitives (see <a class="pxref" href="What-Is-a-Function.html">What Is a Function?</a>) and their calling
conventions, and thus Emacs usually won&rsquo;t load native-compiled code
produced by earlier or later Emacs versions; native compilation of the
same Lisp code by a different Emacs version will usually produce a
natively compiled library under a unique file name that only that
version of Emacs will be able to load.  However, the use of unique
file names enables several versions of the same Lisp library
natively compiled by several different versions of Emacs to be placed
within the same directory.
</p>
<a class="index-entry-id" id="index-no_002dnative_002dcompile"></a>
<p>A non-<code class="code">nil</code> file-local variable binding of
<code class="code">no-byte-compile</code> (see <a class="pxref" href="Byte-Compilation.html">Byte Compilation</a>) also disables the
native compilation of that file.  In addition, a similar variable
<code class="code">no-native-compile</code> disables just the native compilation of the
file.  If both <code class="code">no-byte-compile</code> and <code class="code">no-native-compile</code> are
specified, the former takes precedence.
</p>
<a class="index-entry-id" id="index-native-compilation_002c-prevent-writing-_002a_002eeln-files"></a>
<p>Sometimes there could be a need to prevent the native compilation
from writing its results, the <samp class="file">*.eln</samp> files, into a subdirectory
of <code class="code">user-emacs-directory</code> (see <a class="pxref" href="Init-File.html">The Init File</a>).  You can do that
by either changing the value of <code class="code">native-comp-eln-load-path</code>
(see <a class="pxref" href="Native_002dCompilation-Variables.html">Native-Compilation Variables</a>) or by temporarily pointing the
<code class="env">HOME</code> environment variable to a non-existing directory.  Note
that the latter technique might still produce a small number of
<samp class="file">*.eln</samp> files if Emacs needs to generate <em class="dfn">trampolines</em>, which
are used if Lisp primitives are advised or redefined in your Lisp code
that is being natively compiled.  See <a class="xref" href="Native_002dCompilation-Variables.html">trampolines</a>.  Alternatively, you can specify that the <samp class="file">*.eln</samp>
files are written to a non-default directory using the
<code class="code">startup-redirect-eln-cache</code> function; see <a class="pxref" href="Native_002dCompilation-Functions.html">Native-Compilation Functions</a>.
</p>

<ul class="mini-toc">
<li><a href="Native_002dCompilation-Functions.html" accesskey="1">Native-Compilation Functions</a></li>
<li><a href="Native_002dCompilation-Variables.html" accesskey="2">Native-Compilation Variables</a></li>
</ul>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Debugging.html">Debugging Lisp Programs</a>, Previous: <a href="Byte-Compilation.html">Byte Compilation</a>, Up: <a href="index.html">Emacs Lisp</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
