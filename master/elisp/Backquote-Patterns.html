<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 31.0.50.

Copyright Â© 1990-1996, 1998-2026 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Backquote Patterns (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Backquote Patterns (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Backquote Patterns (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Pattern_002dMatching-Conditional.html" rel="up" title="Pattern-Matching Conditional">
<link href="Destructuring-with-pcase-Patterns.html" rel="next" title="Destructuring with pcase Patterns">
<link href="Extending-pcase.html" rel="prev" title="Extending pcase">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Backquote-Patterns">
<div class="nav-panel">
<p>
Next: <a href="Destructuring-with-pcase-Patterns.html" accesskey="n" rel="next">Destructuring with <code class="code">pcase</code> Patterns</a>, Previous: <a href="Extending-pcase.html" accesskey="p" rel="prev">Extending <code class="code">pcase</code></a>, Up: <a href="Pattern_002dMatching-Conditional.html" accesskey="u" rel="up">Pattern-Matching Conditional</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Backquote_002dStyle-Patterns"><span>11.4.3 Backquote-Style Patterns<a class="copiable-link" href="#Backquote_002dStyle-Patterns"> &para;</a></span></h4>
<a class="index-entry-id" id="index-backquote_002dstyle-patterns"></a>
<a class="index-entry-id" id="index-matching_002c-structural"></a>
<a class="index-entry-id" id="index-structural-matching"></a>

<p>This subsection describes <em class="dfn">backquote-style patterns</em>,
a set of builtin patterns that eases structural matching.
For background, see <a class="pxref" href="Pattern_002dMatching-Conditional.html">Pattern-Matching Conditional</a>.
</p>
<p>Backquote-style patterns are a powerful set of <code class="code">pcase</code> pattern
extensions (created using <code class="code">pcase-defmacro</code>) that make it easy to
match <var class="var">expval</var> against specifications of its <em class="emph">structure</em>.
</p>
<p>For example, to match <var class="var">expval</var> that must be a list of two
elements whose first element is a specific string and the second
element is any value, you can write a core pattern:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(and (pred listp)
     ls
</pre></div><div class="group"><pre class="example-preformatted">     (guard (= 2 (length ls)))
     (guard (string= &quot;first&quot; (car ls)))
     (let second-elem (cadr ls)))
</pre></div></div>

<p>or you can write the equivalent backquote-style pattern:
</p>
<div class="example">
<pre class="example-preformatted">`(&quot;first&quot; ,second-elem)
</pre></div>

<p>The backquote-style pattern is more concise,
resembles the structure of <var class="var">expval</var>,
and avoids binding <code class="code">ls</code>.
</p>
<p>A backquote-style pattern has the form <code class="code">`<var class="var">qpat</var></code> where
<var class="var">qpat</var> can have the following forms:
</p>
<dl class="table">
<dt><code class="code">(<var class="var">qpat1</var> . <var class="var">qpat2</var>)</code></dt>
<dd><p>Matches if <var class="var">expval</var> is a cons cell whose <code class="code">car</code>
matches <var class="var">qpat1</var> and whose <code class="code">cdr</code> matches <var class="var">qpat2</var>.
This readily generalizes to lists as in
<code class="code">(<var class="var">qpat1</var>&nbsp;<var class="var">qpat2</var>&nbsp;&hellip;)</code><!-- /@w -->.
</p>
</dd>
<dt><code class="code">[<var class="var">qpat1</var> <var class="var">qpat2</var> &hellip; <var class="var">qpatm</var>]</code></dt>
<dd><p>Matches if <var class="var">expval</var> is a vector of length <var class="var">m</var> whose
<code class="code">0</code>..<code class="code">(<var class="var">m</var>-1)</code>th elements match <var class="var">qpat1</var>,
<var class="var">qpat2</var> &hellip; <var class="var">qpatm</var>, respectively.
</p>
</dd>
<dt><code class="code"><var class="var">symbol</var></code></dt>
<dt><code class="code"><var class="var">keyword</var></code></dt>
<dt><code class="code"><var class="var">number</var></code></dt>
<dt><code class="code"><var class="var">string</var></code></dt>
<dd><p>Matches if the corresponding element of <var class="var">expval</var> is
<code class="code">equal</code> to the specified literal object.
</p>
</dd>
<dt><code class="code">,<var class="var">pattern</var></code></dt>
<dd><p>Matches if the corresponding element of <var class="var">expval</var>
matches <var class="var">pattern</var>.
Note that <var class="var">pattern</var> is any kind that <code class="code">pcase</code> supports.
(In the example above, <code class="code">second-elem</code> is a <var class="var">symbol</var>
core pattern; it therefore matches anything,
and let-binds <code class="code">second-elem</code>.)
</p></dd>
</dl>

<p>The <em class="dfn">corresponding element</em> is the portion of <var class="var">expval</var>
that is in the same structural position as the structural position
of <var class="var">qpat</var> in the backquote-style pattern.
(In the example above, the corresponding element of
<code class="code">second-elem</code> is the second element of <var class="var">expval</var>.)
</p>
<p>Here is an example of using <code class="code">pcase</code> to implement a simple
interpreter for a little expression language
(note that this requires lexical binding for the
lambda expression in the <code class="code">fn</code> clause to properly
capture <code class="code">body</code> and <code class="code">arg</code> (see <a class="pxref" href="Lexical-Binding.html">Lexical Binding</a>):
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(defun evaluate (form env)
  (pcase form
    (`(add ,x ,y)       (+ (evaluate x env)
                           (evaluate y env)))
</pre></div><div class="group"><pre class="example-preformatted">    (`(call ,fun ,arg)  (funcall (evaluate fun env)
                                 (evaluate arg env)))
    (`(fn ,arg ,body)   (lambda (val)
                          (evaluate body (cons (cons arg val)
                                               env))))
</pre></div><div class="group"><pre class="example-preformatted">    ((pred numberp)     form)
    ((pred symbolp)     (cdr (assq form env)))
    (_                  (error &quot;Syntax error: %S&quot; form))))
</pre></div></div>

<p>The first three clauses use backquote-style patterns.
<code class="code">`(add ,x ,y)</code> is a pattern that checks that <code class="code">form</code>
is a three-element list starting with the literal symbol <code class="code">add</code>,
then extracts the second and third elements and binds them
to symbols <code class="code">x</code> and <code class="code">y</code>, respectively.  This is known as
<em class="dfn">destructuring</em>, see <a class="ref" href="Destructuring-with-pcase-Patterns.html">Destructuring with <code class="code">pcase</code> Patterns</a>.
The clause body evaluates <code class="code">x</code> and <code class="code">y</code> and adds the results.
Similarly, the <code class="code">call</code> clause implements a function call,
and the <code class="code">fn</code> clause implements an anonymous function definition.
</p>
<p>The remaining clauses use core patterns.
<code class="code">(pred numberp)</code> matches if <code class="code">form</code> is a number.
On match, the body evaluates it.
<code class="code">(pred symbolp)</code> matches if <code class="code">form</code> is a symbol.
On match, the body looks up the symbol in <code class="code">env</code> and
returns its association.
Finally, <code class="code">_</code> is the catch-all pattern that
matches anything, so it&rsquo;s suitable for reporting syntax errors.
</p>
<p>Here are some sample programs in this small language, including their
evaluation results:
</p>
<div class="example">
<pre class="example-preformatted">(evaluate '(add 1 2) nil)                 &rArr; 3
(evaluate '(add x y) '((x . 1) (y . 2)))  &rArr; 3
(evaluate '(call (fn x (add 1 x)) 2) nil) &rArr; 3
(evaluate '(sub 1 2) nil)                 &rArr; error
</pre></div>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Destructuring-with-pcase-Patterns.html">Destructuring with <code class="code">pcase</code> Patterns</a>, Previous: <a href="Extending-pcase.html">Extending <code class="code">pcase</code></a>, Up: <a href="Pattern_002dMatching-Conditional.html">Pattern-Matching Conditional</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
