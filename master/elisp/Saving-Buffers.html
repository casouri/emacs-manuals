<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 31.0.50.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Saving Buffers (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Saving Buffers (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Saving Buffers (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Files.html" rel="up" title="Files">
<link href="Reading-from-Files.html" rel="next" title="Reading from Files">
<link href="Visiting-Files.html" rel="prev" title="Visiting Files">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Saving-Buffers">
<div class="nav-panel">
<p>
Next: <a href="Reading-from-Files.html" accesskey="n" rel="next">Reading from Files</a>, Previous: <a href="Visiting-Files.html" accesskey="p" rel="prev">Visiting Files</a>, Up: <a href="Files.html" accesskey="u" rel="up">Files</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Saving-Buffers-1"><span>26.2 Saving Buffers<a class="copiable-link" href="#Saving-Buffers-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-saving-buffers"></a>

<p>When you edit a file in Emacs, you are actually working on a buffer
that is visiting that file&mdash;that is, the contents of the file are
copied into the buffer and the copy is what you edit.  Changes to the
buffer do not change the file until you <em class="dfn">save</em> the buffer, which
means copying the contents of the buffer into the file.  Buffers which
are not visiting a file can still be &ldquo;saved&rdquo;, in a sense, using
functions in the buffer-local <code class="code">write-contents-functions</code> hook.
</p>
<dl class="first-deffn">
<dt class="deffn" id="index-save_002dbuffer"><span class="category-def">Command: </span><span><strong class="def-name">save-buffer</strong> <var class="def-var-arguments">&amp;optional backup-option</var><a class="copiable-link" href="#index-save_002dbuffer"> &para;</a></span></dt>
<dd><p>This function saves the contents of the current buffer in its visited
file if the buffer has been modified since it was last visited or saved.
Otherwise it does nothing.
</p>
<p><code class="code">save-buffer</code> is responsible for making backup files.  Normally,
<var class="var">backup-option</var> is <code class="code">nil</code>, and <code class="code">save-buffer</code> makes a backup
file only if this is the first save since visiting the file.  Other
values for <var class="var">backup-option</var> request the making of backup files in
other circumstances:
</p>
<ul class="itemize mark-bullet">
<li>With an argument of 4 or 64, reflecting 1 or 3 <kbd class="kbd">C-u</kbd>&rsquo;s, the
<code class="code">save-buffer</code> function marks this version of the file to be
backed up when the buffer is next saved.

</li><li>With an argument of 16 or 64, reflecting 2 or 3 <kbd class="kbd">C-u</kbd>&rsquo;s, the
<code class="code">save-buffer</code> function unconditionally backs up the previous
version of the file before saving it.

</li><li>With an argument of 0, unconditionally do <em class="emph">not</em> make any backup file.
</li></ul>
</dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-save_002dsome_002dbuffers"><span class="category-def">Command: </span><span><strong class="def-name">save-some-buffers</strong> <var class="def-var-arguments">&amp;optional save-silently-p pred</var><a class="copiable-link" href="#index-save_002dsome_002dbuffers"> &para;</a></span></dt>
<dd><a class="anchor" id="Definition-of-save_002dsome_002dbuffers"></a><p>This command saves some modified file-visiting buffers.  Normally it
asks the user about each buffer.  But if <var class="var">save-silently-p</var> is
non-<code class="code">nil</code>, it saves all the file-visiting buffers without
querying the user.
</p>
<a class="index-entry-id" id="index-save_002dsome_002dbuffers_002ddefault_002dpredicate"></a>
<p>The optional <var class="var">pred</var> argument provides a predicate that controls
which buffers to ask about (or to save silently if
<var class="var">save-silently-p</var> is non-<code class="code">nil</code>).  If <var class="var">pred</var> is
<code class="code">nil</code>, that means to use the value of
<code class="code">save-some-buffers-default-predicate</code> instead of <var class="var">pred</var>.  If
the result is <code class="code">nil</code>, it means ask only about file-visiting
buffers.  If it is <code class="code">t</code>, that means also offer to save certain
other non-file buffers&mdash;those that have a non-<code class="code">nil</code> buffer-local
value of <code class="code">buffer-offer-save</code> (see <a class="pxref" href="Killing-Buffers.html">Killing Buffers</a>).  A user
who says &lsquo;<samp class="samp">yes</samp>&rsquo; to saving a non-file buffer is asked to specify
the file name to use.  The <code class="code">save-buffers-kill-emacs</code> function
passes the value <code class="code">t</code> for <var class="var">pred</var>.
</p>
<p>If the predicate is neither <code class="code">t</code> nor <code class="code">nil</code>, then it should be
a function of no arguments.  It will be called in each buffer to decide
whether to offer to save that buffer.  If it returns a non-<code class="code">nil</code>
value in a certain buffer, that means do offer to save that buffer.
</p></dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-write_002dfile"><span class="category-def">Command: </span><span><strong class="def-name">write-file</strong> <var class="def-var-arguments">filename &amp;optional confirm</var><a class="copiable-link" href="#index-write_002dfile"> &para;</a></span></dt>
<dd><a class="anchor" id="Definition-of-write_002dfile"></a><p>This function writes the current buffer into file <var class="var">filename</var>, makes
the buffer visit that file, and marks it not modified.  Then it renames
the buffer based on <var class="var">filename</var>, appending a string like &lsquo;<samp class="samp">&lt;2&gt;</samp>&rsquo;
if necessary to make a unique buffer name.  It does most of this work by
calling <code class="code">set-visited-file-name</code> (see <a class="pxref" href="Buffer-File-Name.html">Buffer File Name</a>) and
<code class="code">save-buffer</code>.
</p>
<p>If <var class="var">confirm</var> is non-<code class="code">nil</code>, that means to ask for confirmation
before overwriting an existing file.  Interactively, confirmation is
required, unless the user supplies a prefix argument.
</p>
<p>If <var class="var">filename</var> is a directory name (see <a class="pxref" href="Directory-Names.html">Directory Names</a>),
<code class="code">write-file</code> uses the name of the visited file, in directory
<var class="var">filename</var>.  If the buffer is not visiting a file, it uses the
buffer name instead.
</p></dd></dl>

<p>Saving a buffer runs several hooks.  It also performs format
conversion (see <a class="pxref" href="Format-Conversion.html">File Format Conversion</a>).  Note that these hooks,
described below, are only run by <code class="code">save-buffer</code>, they are not run
by other primitives and functions that write buffer text to files, and
in particular auto-saving (see <a class="pxref" href="Auto_002dSaving.html">Auto-Saving</a>) doesn&rsquo;t run these
hooks.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-write_002dfile_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">write-file-functions</strong><a class="copiable-link" href="#index-write_002dfile_002dfunctions"> &para;</a></span></dt>
<dd><p>The value of this variable is a list of functions to be called before
writing out a buffer to its visited file.  If one of them returns
non-<code class="code">nil</code>, the file is considered already written and the rest of
the functions are not called, nor is the usual code for writing the file
executed.
</p>
<p>If a function in <code class="code">write-file-functions</code> returns non-<code class="code">nil</code>, it
is responsible for making a backup file (if that is appropriate).
To do so, execute the following code:
</p>
<div class="example">
<pre class="example-preformatted">(or buffer-backed-up (backup-buffer))
</pre></div>

<p>You might wish to save the file modes value returned by
<code class="code">backup-buffer</code> and use that (if non-<code class="code">nil</code>) to set the mode
bits of the file that you write.  This is what <code class="code">save-buffer</code>
normally does.  See <a class="xref" href="Making-Backups.html">Making Backup Files</a>.
</p>
<p>The hook functions in <code class="code">write-file-functions</code> are also responsible
for encoding the data (if desired): they must choose a suitable coding
system and end-of-line conversion (see <a class="pxref" href="Lisp-and-Coding-Systems.html">Coding Systems in Lisp</a>),
perform the encoding (see <a class="pxref" href="Explicit-Encoding.html">Explicit Encoding and Decoding</a>), and set
<code class="code">last-coding-system-used</code> to the coding system that was used
(see <a class="pxref" href="Encoding-and-I_002fO.html">Encoding and I/O</a>).
</p>
<p>If you set this hook locally in a buffer, it is assumed to be
associated with the file or the way the contents of the buffer were
obtained.  Thus the variable is marked as a permanent local, so that
changing the major mode does not alter a buffer-local value.  On the
other hand, calling <code class="code">set-visited-file-name</code> will reset it.
If this is not what you want, you might like to use
<code class="code">write-contents-functions</code> instead.
</p>
<p>Even though this is not a normal hook, you can use <code class="code">add-hook</code> and
<code class="code">remove-hook</code> to manipulate the list.  See <a class="xref" href="Hooks.html">Hooks</a>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-write_002dcontents_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">write-contents-functions</strong><a class="copiable-link" href="#index-write_002dcontents_002dfunctions"> &para;</a></span></dt>
<dd><p>This works just like <code class="code">write-file-functions</code>, but it is intended
for hooks that pertain to the buffer&rsquo;s contents, not to the particular
visited file or its location, and can be used to create arbitrary save
processes for buffers that aren&rsquo;t visiting files at all.  Such hooks
are usually set up by major modes, as buffer-local bindings for this
variable.  This variable automatically becomes buffer-local whenever
it is set; switching to a new major mode always resets this variable,
but calling <code class="code">set-visited-file-name</code> does not.
</p>
<p>If any of the functions in this hook returns non-<code class="code">nil</code>, the file
is considered already written and the rest are not called and neither
are the functions in <code class="code">write-file-functions</code>.
</p>
<p>When using this hook to save buffers that are not visiting files (for
instance, special-mode buffers), keep in mind that, if the function
fails to save correctly and returns a <code class="code">nil</code> value,
<code class="code">save-buffer</code> will go on to prompt the user for a file to save
the buffer in.  If this is undesirable, consider having the function
fail by raising an error.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-before_002dsave_002dhook"><span class="category-def">User Option: </span><span><strong class="def-name">before-save-hook</strong><a class="copiable-link" href="#index-before_002dsave_002dhook"> &para;</a></span></dt>
<dd><p>This normal hook runs before a buffer is saved in its visited file,
regardless of whether that is done normally or by one of the hooks
described above.  For instance, the <samp class="file">copyright.el</samp> program uses
this hook to make sure the file you are saving has the current year in
its copyright notice.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-after_002dsave_002dhook"><span class="category-def">User Option: </span><span><strong class="def-name">after-save-hook</strong><a class="copiable-link" href="#index-after_002dsave_002dhook"> &para;</a></span></dt>
<dd><p>This normal hook runs after a buffer has been saved in its visited file.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-file_002dprecious_002dflag"><span class="category-def">User Option: </span><span><strong class="def-name">file-precious-flag</strong><a class="copiable-link" href="#index-file_002dprecious_002dflag"> &para;</a></span></dt>
<dd><p>If this variable is non-<code class="code">nil</code>, then <code class="code">save-buffer</code> protects
against I/O errors while saving by writing the new file to a temporary
name instead of the name it is supposed to have, and then renaming it to
the intended name after it is clear there are no errors.  This procedure
prevents problems such as a lack of disk space from resulting in an
invalid file.
</p>
<p>As a side effect, backups are necessarily made by copying.  See <a class="xref" href="Rename-or-Copy.html">Backup by Renaming or by Copying?</a>.  Yet, at the same time, saving a precious file always breaks
all hard links between the file you save and other file names.
</p>
<p>Some modes give this variable a non-<code class="code">nil</code> buffer-local value
in particular buffers.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-require_002dfinal_002dnewline"><span class="category-def">User Option: </span><span><strong class="def-name">require-final-newline</strong><a class="copiable-link" href="#index-require_002dfinal_002dnewline"> &para;</a></span></dt>
<dd><p>This variable determines whether files may be written out that do
<em class="emph">not</em> end with a newline.  If the value of the variable is
<code class="code">t</code>, then <code class="code">save-buffer</code> silently adds a newline at the end
of the buffer whenever it does not already end in one.  If the value
is <code class="code">visit</code>, Emacs adds a missing newline just after it visits the
file.  If the value is <code class="code">visit-save</code>, Emacs adds a missing newline
both on visiting and on saving.  For any other non-<code class="code">nil</code> value,
<code class="code">save-buffer</code> asks the user whether to add a newline each time
the case arises.
</p>
<p>If the value of the variable is <code class="code">nil</code>, then <code class="code">save-buffer</code>
doesn&rsquo;t add newlines at all.  <code class="code">nil</code> is the default value, but a few
major modes set it to <code class="code">t</code> in particular buffers.
</p></dd></dl>

<p>See also the function <code class="code">set-visited-file-name</code> (see <a class="pxref" href="Buffer-File-Name.html">Buffer File Name</a>).
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Reading-from-Files.html">Reading from Files</a>, Previous: <a href="Visiting-Files.html">Visiting Files</a>, Up: <a href="Files.html">Files</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
