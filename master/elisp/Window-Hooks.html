<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 31.0.50.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Window Hooks (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Window Hooks (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Window Hooks (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Windows.html" rel="up" title="Windows">
<link href="Window-Parameters.html" rel="prev" title="Window Parameters">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Window-Hooks">
<div class="nav-panel">
<p>
Previous: <a href="Window-Parameters.html" accesskey="p" rel="prev">Window Parameters</a>, Up: <a href="Windows.html" accesskey="u" rel="up">Windows</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Hooks-for-Window-Scrolling-and-Changes"><span>29.30 Hooks for Window Scrolling and Changes<a class="copiable-link" href="#Hooks-for-Window-Scrolling-and-Changes"> &para;</a></span></h3>
<a class="index-entry-id" id="index-hooks-for-window-operations"></a>

<p>This section describes how Lisp programs can take action after a
window has been scrolled or other window modifications occurred.  We
first consider the case where a window shows a different part of its
buffer.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-window_002dscroll_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">window-scroll-functions</strong><a class="copiable-link" href="#index-window_002dscroll_002dfunctions"> &para;</a></span></dt>
<dd><p>This variable holds a list of functions that Emacs should call before
redisplaying a window with scrolling.  Displaying a different buffer
in a window and making a new window also call these functions.
</p>
<p>This variable is not a normal hook, because each function is called
with two arguments: the window, and its new display-start position.
At the time of the call, the display-start position of the argument
window is already set to its new value, and the buffer to be displayed
in the window is set as the current buffer.
</p>
<p>These functions must take care when using <code class="code">window-end</code>
(see <a class="pxref" href="Window-Start-and-End.html">The Window Start and End Positions</a>); if you need an up-to-date value, you
must use the <var class="var">update</var> argument to ensure you get it.
</p>
<p><strong class="strong">Warning:</strong> don&rsquo;t use this feature to alter the way the window
is scrolled.  It&rsquo;s not designed for that, and such use probably won&rsquo;t
work.
</p></dd></dl>

<p>In addition, you can use <code class="code">jit-lock-register</code> to register a Font
Lock fontification function, which will be called whenever parts of a
buffer are (re)fontified because a window was scrolled or its size
changed.  See <a class="xref" href="Other-Font-Lock-Variables.html">Other Font Lock Variables</a>.
</p>
<a class="index-entry-id" id="index-window-change-functions"></a>
<p>The remainder of this section covers six hooks that are called
during redisplay provided a significant, non-scrolling change of a
window has been detected.  For simplicity, these hooks and the
functions they call will be collectively referred to as <em class="dfn">window
change functions</em>.  As any hook, these hooks can be set either
globally or buffer-locally via the <var class="var">local</var> argument of
<code class="code">add-hook</code> (see <a class="pxref" href="Setting-Hooks.html">Setting Hooks</a>) when the hook is installed.
</p>
<a class="index-entry-id" id="index-window-buffer-change"></a>
<p>The first of these hooks is run after a <em class="dfn">window buffer change</em> is
detected, which means that a window was created, deleted or assigned
another buffer.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-window_002dbuffer_002dchange_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">window-buffer-change-functions</strong><a class="copiable-link" href="#index-window_002dbuffer_002dchange_002dfunctions"> &para;</a></span></dt>
<dd><p>This variable specifies functions called during redisplay when window
buffers have changed.  The value should be a list of functions that
take one argument.
</p>
<p>Functions specified buffer-locally are called for each window showing
the corresponding buffer if and only if that window has been added or
changed its buffer since the last redisplay.  Note that functions may be
run twice for such a window: Once for the buffer shown in the window at
the time of the last redisplay (provided that buffer is still live) and
once for the buffer currently shown in the window.  In either case the
window is passed as argument and the respective buffer is made
temporarily current.
</p>
<p>If you are using the buffer-local version of this hook, you may want to
discern the case where the buffer was removed from a window from the
case where the buffer is now shown in that window.  If <var class="var">window</var>
denotes the window argument passed to a function on this hook, then to
detect the case where the buffer was removed from <var class="var">window</var> use the
idiom
</p>
<div class="example">
<pre class="example-preformatted">(eq (window-old-buffer <var class="var">window</var>) (current-buffer))
</pre></div>

<p>while to detect whether the buffer is now shown in <var class="var">window</var> use
</p>
<div class="example">
<pre class="example-preformatted">(eq (window-buffer <var class="var">window</var>) (current-buffer))
</pre></div>

<p>instead.
</p>
<p>Functions specified by the default value are called for a frame if at
least one window on that frame has been added, deleted or assigned
another buffer since the last time window change functions were run.
In this case the frame is passed as argument.
</p></dd></dl>

<a class="index-entry-id" id="index-window-size-change"></a>
<p>The second of these hooks is run when a <em class="dfn">window size change</em> has
been detected which means that a window was created, assigned another
buffer, or changed its total size or that of its text area.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-window_002dsize_002dchange_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">window-size-change-functions</strong><a class="copiable-link" href="#index-window_002dsize_002dchange_002dfunctions"> &para;</a></span></dt>
<dd><p>This variable specifies functions called during redisplay when a
window size change occurred.  The value should be a list of functions
that take one argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if that window has been added or assigned another
buffer or changed its total or body size since the last time window
change functions were run.  In this case the window is passed as
argument and the respective buffer is temporarily made current.
</p>
<p>Functions specified by the default value are called for a frame if at
least one window on that frame has been added or assigned another
buffer or changed its total or body size since the last time window
change functions were run.  In this case the frame is passed as
argument.
</p></dd></dl>

<a class="index-entry-id" id="index-window-selection-change"></a>
<p>The third of these hooks is run when a <em class="dfn">window selection change</em>
has selected another window since the last redisplay.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-window_002dselection_002dchange_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">window-selection-change-functions</strong><a class="copiable-link" href="#index-window_002dselection_002dchange_002dfunctions"> &para;</a></span></dt>
<dd><p>This variable specifies functions called during redisplay when the
selected window or a frame&rsquo;s selected window has changed.  The value
should be a list of functions that take one argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if that window has been selected or deselected
(among all windows or among all windows on its frame) since the last
time window change functions were run.  In this case the window is
passed as argument and the respective buffer is temporarily made
current.
</p>
<p>Functions specified by the default value are called for a frame if
that frame has been selected or deselected or the frame&rsquo;s selected
window has changed since the last time window change functions were
run.  In this case the frame is passed as argument.
</p></dd></dl>

<a class="index-entry-id" id="index-window-state-change"></a>
<p>The fourth of these hooks is run when a <em class="dfn">window state change</em> has
been detected, which means that at least one of the three preceding
window changes has occurred.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-window_002dstate_002dchange_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">window-state-change-functions</strong><a class="copiable-link" href="#index-window_002dstate_002dchange_002dfunctions"> &para;</a></span></dt>
<dd><p>This variable specifies functions called during redisplay when a
window buffer or size change occurred or the selected window or a
frame&rsquo;s selected window has changed.  The value should be a list of
functions that take one argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if that window has been added or assigned another
buffer, changed its total or body size or has been selected or
deselected (among all windows or among all windows on its frame) since
the last time window change functions were run.  In this case the window
is passed as argument and the respective buffer is temporarily made
current.
</p>
<p>Functions specified by the default value are called for a frame if at
least one window on that frame has been added, deleted or assigned
another buffer, changed its total or body size or that frame has been
selected or deselected or the frame&rsquo;s selected window has changed
since the last time window change functions were run.  In this case
the frame is passed as argument.
</p>
<p>Functions specified by the default value are also run for a frame when
that frame&rsquo;s window state change flag (see below) has been set since
last redisplay.
</p></dd></dl>

<a class="index-entry-id" id="index-window-configuration-change"></a>
<p>The fifth of these hooks is run when a <em class="dfn">window configuration
change</em> has been detected which means that either the buffer or the
size of a window changed.  It differs from the four preceding hooks in
the way it is run.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-window_002dconfiguration_002dchange_002dhook"><span class="category-def">Variable: </span><span><strong class="def-name">window-configuration-change-hook</strong><a class="copiable-link" href="#index-window_002dconfiguration_002dchange_002dhook"> &para;</a></span></dt>
<dd><p>This variable specifies functions called during redisplay when either
the buffer or the size of a window has changed.  The value should be a
list of functions that take no argument.
</p>
<p>Functions specified buffer-locally are called for any window showing
the corresponding buffer if at least one window on that frame has been
added, deleted or assigned another buffer or changed its total or
body size since the last time window change functions were run.  Each
call is performed with the window showing the buffer temporarily
selected and its buffer current.
</p>
<p>Functions specified by the default value are called for each frame if
at least one window on that frame has been added, deleted or assigned
another buffer or changed its total or body size since the last time
window change functions were run.  Each call is performed with the
frame temporarily selected and the selected window&rsquo;s buffer current.
</p></dd></dl>

<p>Finally, Emacs runs a normal hook that generalizes the behavior of
<code class="code">window-state-change-functions</code>.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-window_002dstate_002dchange_002dhook"><span class="category-def">Variable: </span><span><strong class="def-name">window-state-change-hook</strong><a class="copiable-link" href="#index-window_002dstate_002dchange_002dhook"> &para;</a></span></dt>
<dd><p>The default value of this variable specifies functions called during
redisplay when a window state change has been detected or the window
state change flag has been set on at least one frame.  The value
should be a list of functions that take no argument.
</p>
<p>Applications should put a function on this hook only if they want to
react to changes that happened on (or have been signaled for) two or
more frames since last redisplay.  In every other case, putting the
function on <code class="code">window-state-change-functions</code> should be preferred.
</p></dd></dl>

<p>Window change functions are called during redisplay for each frame as
follows: First, any buffer-local window buffer change function, window
size change function, selected window change and window state change
functions are called in this order.  Next, the default values for
these functions are called in the same order.  Then any buffer-local
window configuration change functions are called followed by functions
specified by the default value of those functions.  Finally, functions
on <code class="code">window-state-change-hook</code> are run.
</p>
<p>Window change functions are run for a specific frame only if a
corresponding change was registered for that frame earlier.  Such
changes include the creation or deletion of a window or the assignment
of another buffer or size to a window.  Note that even when such a
change has been registered, this does not mean that any of the hooks
described above is run.  If, for example, a change was registered
within the scope of a window excursion (see <a class="pxref" href="Window-Configurations.html">Window Configurations</a>), this will trigger a call of window change functions
only if that excursion still persists at the time change functions are
run.  If it is exited earlier, hooks will be run only if registered by
a change outside the scope of that excursion.
</p>
<a class="index-entry-id" id="index-window-state-change-flag"></a>
<p>The <em class="dfn">window state change flag</em> of a frame, if set, will cause
the default values of <code class="code">window-state-change-functions</code> (for that
frame) and <code class="code">window-state-change-hook</code> to be run during next
redisplay regardless of whether a window state change actually
occurred for that frame or not.  After running any functions on these
hooks, the flag is reset for each frame.  Applications can set that
flag and inspect its value using the following functions.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-set_002dframe_002dwindow_002dstate_002dchange"><span class="category-def">Function: </span><span><strong class="def-name">set-frame-window-state-change</strong> <var class="def-var-arguments">&amp;optional frame arg</var><a class="copiable-link" href="#index-set_002dframe_002dwindow_002dstate_002dchange"> &para;</a></span></dt>
<dd><p>This function sets <var class="var">frame</var>&rsquo;s window state change flag if <var class="var">arg</var>
is non-<code class="code">nil</code> and resets it otherwise.  <var class="var">frame</var> must be a live
frame and defaults to the selected one.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-frame_002dwindow_002dstate_002dchange"><span class="category-def">Function: </span><span><strong class="def-name">frame-window-state-change</strong> <var class="def-var-arguments">&amp;optional frame</var><a class="copiable-link" href="#index-frame_002dwindow_002dstate_002dchange"> &para;</a></span></dt>
<dd><p>This functions returns <code class="code">t</code> if <var class="var">frame</var>&rsquo;s window state change
flag is set and <code class="code">nil</code> otherwise.  <var class="var">frame</var> must be a live
frame and defaults to the selected one.
</p></dd></dl>

<p>While window change functions are run, the functions described next
can be called to get more insight into what has changed for a specific
window or frame since the last redisplay.  All these functions take a
live window as single, optional argument, defaulting to the selected
window.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-window_002dold_002dbuffer"><span class="category-def">Function: </span><span><strong class="def-name">window-old-buffer</strong> <var class="def-var-arguments">&amp;optional window</var><a class="copiable-link" href="#index-window_002dold_002dbuffer"> &para;</a></span></dt>
<dd><p>This function returns the buffer shown in <var class="var">window</var> at the last time
window change functions were run for <var class="var">window</var>&rsquo;s frame.  If it
returns <code class="code">nil</code>, <var class="var">window</var> is either an internal window or has
been created after that.  If it returns <code class="code">t</code>, <var class="var">window</var> was not
shown at that time but has been restored from a previously saved window
configuration afterwards.  Otherwise, the return value is the buffer
shown by <var class="var">window</var> at that time.  As a special case, if <var class="var">window</var>
has been deleted, this function returns the last buffer <var class="var">window</var> had
shown at that time.  <var class="var">window</var> can be any window and defaults to the
selected one.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-window_002dold_002dpixel_002dwidth"><span class="category-def">Function: </span><span><strong class="def-name">window-old-pixel-width</strong> <var class="def-var-arguments">&amp;optional window</var><a class="copiable-link" href="#index-window_002dold_002dpixel_002dwidth"> &para;</a></span></dt>
<dd><p>This function returns the total pixel width of <var class="var">window</var> the
last time window change functions found <var class="var">window</var> live on its
frame.  It is zero if <var class="var">window</var> was created after that.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-window_002dold_002dpixel_002dheight"><span class="category-def">Function: </span><span><strong class="def-name">window-old-pixel-height</strong> <var class="def-var-arguments">&amp;optional window</var><a class="copiable-link" href="#index-window_002dold_002dpixel_002dheight"> &para;</a></span></dt>
<dd><p>This function returns the total pixel height of <var class="var">window</var> the last
time window change functions found <var class="var">window</var> live on its frame.
It is zero if <var class="var">window</var> was created after that.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-window_002dold_002dbody_002dpixel_002dwidth"><span class="category-def">Function: </span><span><strong class="def-name">window-old-body-pixel-width</strong> <var class="def-var-arguments">&amp;optional window</var><a class="copiable-link" href="#index-window_002dold_002dbody_002dpixel_002dwidth"> &para;</a></span></dt>
<dd><p>This function returns the pixel width of <var class="var">window</var>&rsquo;s text area the
last time window change functions found <var class="var">window</var> live on its
frame.  It is zero if <var class="var">window</var> was created after that.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-window_002dold_002dbody_002dpixel_002dheight"><span class="category-def">Function: </span><span><strong class="def-name">window-old-body-pixel-height</strong> <var class="def-var-arguments">&amp;optional window</var><a class="copiable-link" href="#index-window_002dold_002dbody_002dpixel_002dheight"> &para;</a></span></dt>
<dd><p>This function returns the pixel height of <var class="var">window</var>&rsquo;s text area the
last time window change functions found <var class="var">window</var> live on its
frame.  It is zero if <var class="var">window</var> was created after that.
</p></dd></dl>

<p>In order to find out which window or frame was selected the last time
window change functions were run, the following functions can be used:
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-frame_002dold_002dselected_002dwindow"><span class="category-def">Function: </span><span><strong class="def-name">frame-old-selected-window</strong> <var class="def-var-arguments">&amp;optional frame</var><a class="copiable-link" href="#index-frame_002dold_002dselected_002dwindow"> &para;</a></span></dt>
<dd><p>This function returns the selected window of <var class="var">frame</var> at the last
time window change functions were run.  If omitted or <code class="code">nil</code>
<var class="var">frame</var> defaults to the selected frame.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-old_002dselected_002dwindow"><span class="category-def">Function: </span><span><strong class="def-name">old-selected-window</strong><a class="copiable-link" href="#index-old_002dselected_002dwindow"> &para;</a></span></dt>
<dd><p>This function returns the selected window at the last time window
change functions were run.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-old_002dselected_002dframe"><span class="category-def">Function: </span><span><strong class="def-name">old-selected-frame</strong><a class="copiable-link" href="#index-old_002dselected_002dframe"> &para;</a></span></dt>
<dd><p>This function returns the selected frame at the last time window
change functions were run.
</p></dd></dl>

<p>Note that window change functions provide no information about which
windows have been deleted since the last time they were run.  If
necessary, applications should remember any window showing a specific
buffer in a local variable of that buffer and update it in a function
run by the default values of any of the hooks that are run when a
window buffer change was detected.
</p>
<p>The following caveats should be considered when adding a function
to window change functions:
</p>
<ul class="itemize mark-bullet">
<li>Some operations will not trigger a call of window change functions.
These include showing another buffer in a minibuffer window or any
change of a tooltip window.

</li><li>Window change functions should not create or delete windows or change
the buffer, size or selection status of any window because there is no
guarantee that the information about such a change will be propagated
to other window change functions.  If at all, any such change should
be executed only by the last function listed by the default value of
<code class="code">window-state-change-hook</code>.

</li><li>Macros like <code class="code">save-window-excursion</code>, <code class="code">with-selected-window</code>
or <code class="code">with-current-buffer</code> can be used when running window change
functions.

</li><li>Running window change functions does not save and restore match data.
Unless running <code class="code">window-configuration-change-hook</code> it does not
save or restore the selected window or frame or the current buffer
either.

</li><li>Any redisplay triggering the run of window change functions may be
aborted.  If the abort occurs before window change functions have run
to their completion, they will be run again with the previous values,
that is, as if redisplay had not been performed.  If aborted later,
they will be run with the new values, that is, as if redisplay had
been actually performed.
</li></ul>
</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Window-Parameters.html">Window Parameters</a>, Up: <a href="Windows.html">Windows</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
