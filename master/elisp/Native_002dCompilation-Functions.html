<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 29.0.50.

Copyright Â© 1990-1996, 1998-2021 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Native-Compilation Functions (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Native-Compilation Functions (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Native-Compilation Functions (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Native-Compilation.html" rel="up" title="Native Compilation">
<link href="Native_002dCompilation-Variables.html" rel="next" title="Native-Compilation Variables">
<link href="Native-Compilation.html" rel="prev" title="Native Compilation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<span id="Native_002dCompilation-Functions"></span><div class="header">
<p>
Next: <a href="Native_002dCompilation-Variables.html" accesskey="n" rel="next">Native-Compilation Variables</a>, Up: <a href="Native-Compilation.html" accesskey="u" rel="up">Native Compilation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Native_002dCompilation-Functions-1"></span><h3 class="section">18.1 Native-Compilation Functions</h3>
<span id="index-native_002dcompilation-functions"></span>

<p>Native-Compilation is implemented as a side effect of
byte-compilation (see <a href="Byte-Compilation.html">Byte Compilation</a>).  Thus, compiling Lisp
code natively always produces its byte code as well, and therefore all
the rules and caveats of preparing Lisp code for byte compilation
(see <a href="Compilation-Functions.html">Compilation Functions</a>) are valid for native-compilation as
well.
</p>
<p>You can natively-compile either a single function or macro
definition, or a whole file of Lisp code, with the
<code>native-compile</code> function.  Natively-compiling a file will
produce both the corresponding <samp>.elc</samp> file with byte code and the
<samp>.eln</samp> file with native code.
</p>
<span id="index-native_002dcomp_002dlimple_002dmode"></span>
<span id="index-native_002dcomp_002dverbose"></span>
<p>Native compilation might produce warning or error messages; these
are normally recorded in the buffer called
<samp>*Native-compile-Log*</samp>.  In interactive sessions, it uses the
special LIMPLE mode (<code>native-comp-limple-mode</code>), which sets up
<code>font-lock</code> as appropriate for this log, and is otherwise the
same as Fundamental mode.  Logging of messages resulting from
native-compilation can be controlled by the <code>native-comp-verbose</code>
variable (see <a href="Native_002dCompilation-Variables.html">Native-Compilation Variables</a>).
</p>
<p>When Emacs is run non-interactively, messages produced by
native-compilation are reported by calling <code>message</code>
(see <a href="Displaying-Messages.html">Displaying Messages</a>), and are usually displayed on the
standard error stream of the terminal from which Emacs was invoked.
</p>
<dl>
<dt id="index-native_002dcompile">Function: <strong>native-compile</strong> <em>function-or-file &amp;optional output</em></dt>
<dd><p>This function compiles <var>function-or-file</var> into native code.  The
argument <var>function-or-file</var> can be a function symbol, a Lisp form,
or a name (a string) of the file which contains the Emacs Lisp source
code to compile.  If the optional argument <var>output</var> is provided,
it must be a string specifying the name of the file to write the
compiled code into.  Otherwise, if <var>function-or-file</var> is a
function or a Lisp form, this function returns the compiled object,
and if <var>function-or-file</var> is a file name, the function returns the
full absolute name of the file it created for the compiled code.  The
output file is by default given the <samp>.eln</samp> extension.
</p>
<p>This function runs the final phase of the native compilation, which
invokes GCC via <samp>libgccjit</samp>, in a separate subprocess, which
invokes the same Emacs executable as the process that called this
function.
</p></dd></dl>

<dl>
<dt id="index-batch_002dnative_002dcompile">Function: <strong>batch-native-compile</strong> <em>&amp;optional for-tarball</em></dt>
<dd><p>This function runs native-compilation on files specified on the Emacs
command line in batch mode.  It must be used only in a batch execution
of Emacs, as it kills Emacs upon completion of the compilation.  If
one or more of the files fail to compile, the Emacs process will
attempt to compile all the other files, and will terminate with a
non-zero status code.  The optional argument <var>for-tarball</var>, if
non-<code>nil</code>, tells the function to place the resulting <samp>.eln</samp>
files in the last directory mentioned in
<code>native-comp-eln-load-path</code> (see <a href="Library-Search.html">Library Search</a>); this is
meant to be used as part of building an Emacs source tarball for the
first time, when the natively-compiled files, which are absent from
the source tarball, should be generated in the build tree instead of
the user&rsquo;s cache directory.
</p></dd></dl>

<p>Native compilation can be run entirely asynchronously, in a subprocess
of the main Emacs process.  This leaves the main Emacs process free to
use while the compilation runs in the background.  This is the method
used by Emacs to natively-compile any Lisp file or byte-compiled Lisp
file that is loaded into Emacs, when no natively-compiled file for it
is available.
</p>
<dl>
<dt id="index-native_002dcompile_002dasync">Function: <strong>native-compile-async</strong> <em>files &amp;optional recursively load selector</em></dt>
<dd><p>This function compiles the named <var>files</var> asynchronously.  The
argument <var>files</var> should be a single file name (a string) or a list
of one or more file and/or directory names.  If directories are
present in the list, the optional argument <var>recursively</var> should be
non-<code>nil</code> to cause the compilation to recurse into those
directories.  If <var>load</var> is non-<code>nil</code>, Emacs will load each
file that it succeeded to compile.  The optional argument
<var>selector</var> allows control of which of <var>files</var> will be
compiled; it can have one of the following values:
</p>
<dl compact="compact">
<dt><code>nil</code> or omitted</dt>
<dd><p>Select all the files and directories in <var>files</var>.
</p></dd>
<dt>a regular expression string</dt>
<dd><p>Select the files and directories whose names match the regexp.
</p></dd>
<dt>a function</dt>
<dd><p>A predicate function, which will be called with each file and
directory in <var>files</var>, and should return non-<code>nil</code> if the file
or the directory should be selected for compilation.
</p></dd>
</dl>

<p>On systems with multiple CPU execution units, when <var>files</var> names
more than one file, this function will normally start several
compilation subprocesses in parallel, under the control of
<code>native-comp-async-jobs-number</code> (see <a href="Native_002dCompilation-Variables.html">Native-Compilation Variables</a>).
</p></dd></dl>

<p>The following function allows Lisp programs to test whether
native-compilation is available at runtime.
</p>
<dl>
<dt id="index-native_002dcomp_002davailable_002dp">Function: <strong>native-comp-available-p</strong></dt>
<dd><p>This function returns non-<code>nil</code> if the running Emacs process has
the native-compilation support compiled into it.  On systems that load
<samp>libgccjit</samp> dynamically, it also makes sure that library is
available and can be loaded.  Lisp programs that need to know up front
whether native-compilation is available should use this predicate.
</p></dd></dl>

<hr>
<div class="header">
<p>
Next: <a href="Native_002dCompilation-Variables.html" accesskey="n" rel="next">Native-Compilation Variables</a>, Up: <a href="Native-Compilation.html" accesskey="u" rel="up">Native Compilation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
