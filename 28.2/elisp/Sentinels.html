<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 28.2.

Copyright Â© 1990-1996, 1998-2022 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Sentinels (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Sentinels (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Sentinels (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Processes.html" rel="up" title="Processes">
<link href="Query-Before-Exit.html" rel="next" title="Query Before Exit">
<link href="Output-from-Processes.html" rel="prev" title="Output from Processes">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Sentinels">
<div class="nav-panel">
<p>
Next: <a href="Query-Before-Exit.html" accesskey="n" rel="next">Querying Before Exit</a>, Previous: <a href="Output-from-Processes.html" accesskey="p" rel="prev">Receiving Output from Processes</a>, Up: <a href="Processes.html" accesskey="u" rel="up">Processes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Sentinels_003a-Detecting-Process-Status-Changes"><span>39.10 Sentinels: Detecting Process Status Changes<a class="copiable-link" href="#Sentinels_003a-Detecting-Process-Status-Changes"> &para;</a></span></h3>
<a class="index-entry-id" id="index-process-sentinel"></a>
<a class="index-entry-id" id="index-sentinel-_0028of-process_0029"></a>

<p>A <em class="dfn">process sentinel</em> is a function that is called whenever the
associated process changes status for any reason, including signals
(whether sent by Emacs or caused by the process&rsquo;s own actions) that
terminate, stop, or continue the process.  The process sentinel is
also called if the process exits.  The sentinel receives two
arguments: the process for which the event occurred, and a string
describing the type of event.
</p>
<a class="index-entry-id" id="index-default-sentinel-function-of-a-process"></a>
<p>If no sentinel function was specified for a process, it will use the
default sentinel function, which inserts a message in the process&rsquo;s
buffer with the process name and the string describing the event.
</p>
<p>The string describing the event looks like one of the following (but
this is not an exhaustive list of event strings):
</p>
<ul class="itemize mark-bullet">
<li><code class="code">&quot;finished\n&quot;</code>.

</li><li><code class="code">&quot;deleted\n&quot;</code>.

</li><li><code class="code">&quot;exited abnormally with code <var class="var">exitcode</var> (core dumped)\n&quot;</code>.
The &ldquo;core dumped&rdquo; part is optional, and only appears if the process
dumped core.

</li><li><code class="code">&quot;failed with code <var class="var">fail-code</var>\n&quot;</code>.

</li><li><code class="code">&quot;<var class="var">signal-description</var> (core dumped)\n&quot;</code>.  The
<var class="var">signal-description</var> is a system-dependent textual description of
a signal, e.g., <code class="code">&quot;killed&quot;</code> for <code class="code">SIGKILL</code>.  The &ldquo;core
dumped&rdquo; part is optional, and only appears if the process dumped
core.

</li><li><code class="code">&quot;open from <var class="var">host-name</var>\n&quot;</code>.

</li><li><code class="code">&quot;open\n&quot;</code>.

</li><li><code class="code">&quot;run\n&quot;</code>.

</li><li><code class="code">&quot;connection broken by remote peer\n&quot;</code>.
</li></ul>

<p>A sentinel runs only while Emacs is waiting (e.g., for terminal
input, or for time to elapse, or for process output).  This avoids the
timing errors that could result from running sentinels at random places in
the middle of other Lisp programs.  A program can wait, so that
sentinels will run, by calling <code class="code">sit-for</code> or <code class="code">sleep-for</code>
(see <a class="pxref" href="Waiting.html">Waiting for Elapsed Time or Input</a>), or <code class="code">accept-process-output</code> (see <a class="pxref" href="Accepting-Output.html">Accepting Output from Processes</a>).  Emacs also allows sentinels to run when the command loop is
reading input.  <code class="code">delete-process</code> calls the sentinel when it
terminates a running process.
</p>
<p>Emacs does not keep a queue of multiple reasons to call the sentinel
of one process; it records just the current status and the fact that
there has been a change.  Therefore two changes in status, coming in
quick succession, can call the sentinel just once.  However, process
termination will always run the sentinel exactly once.  This is
because the process status can&rsquo;t change again after termination.
</p>
<p>Emacs explicitly checks for output from the process before running
the process sentinel.  Once the sentinel runs due to process
termination, no further output can arrive from the process.
</p>
<p>A sentinel that writes the output into the buffer of the process
should check whether the buffer is still alive.  If it tries to insert
into a dead buffer, it will get an error.  If the buffer is dead,
<code class="code">(buffer-name (process-buffer <var class="var">process</var>))</code> returns <code class="code">nil</code>.
</p>
<p>Quitting is normally inhibited within a sentinel&mdash;otherwise, the
effect of typing <kbd class="kbd">C-g</kbd> at command level or to quit a user command
would be unpredictable.  If you want to permit quitting inside a
sentinel, bind <code class="code">inhibit-quit</code> to <code class="code">nil</code>.  In most cases, the
right way to do this is with the macro <code class="code">with-local-quit</code>.
See <a class="xref" href="Quitting.html">Quitting</a>.
</p>
<p>If an error happens during execution of a sentinel, it is caught
automatically, so that it doesn&rsquo;t stop the execution of whatever
programs was running when the sentinel was started.  However, if
<code class="code">debug-on-error</code> is non-<code class="code">nil</code>,  errors are not caught.
This makes it possible to use the Lisp debugger to debug the
sentinel.  See <a class="xref" href="Debugger.html">The Lisp Debugger</a>.
</p>
<p>While a sentinel is running, the process sentinel is temporarily
set to <code class="code">nil</code> so that the sentinel won&rsquo;t run recursively.
For this reason it is not possible for a sentinel to specify
a new sentinel.
</p>
<p>Note that Emacs automatically saves and restores the match data
while executing sentinels.  See <a class="xref" href="Match-Data.html">The Match Data</a>.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-set_002dprocess_002dsentinel"><span class="category-def">Function: </span><span><strong class="def-name">set-process-sentinel</strong> <var class="def-var-arguments">process sentinel</var><a class="copiable-link" href="#index-set_002dprocess_002dsentinel"> &para;</a></span></dt>
<dd><p>This function associates <var class="var">sentinel</var> with <var class="var">process</var>.  If
<var class="var">sentinel</var> is <code class="code">nil</code>, then the process will have the default
sentinel, which inserts a message in the process&rsquo;s buffer when the
process status changes.
</p>
<p>Changes in process sentinels take effect immediately&mdash;if the sentinel
is slated to be run but has not been called yet, and you specify a new
sentinel, the eventual call to the sentinel will use the new one.
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">(defun msg-me (process event)
   (princ
     (format &quot;Process: %s had the event '%s'&quot; process event)))
(set-process-sentinel (get-process &quot;shell&quot;) 'msg-me)
     &rArr; msg-me
</pre></div><div class="group"><pre class="example-preformatted">(kill-process (get-process &quot;shell&quot;))
     -| Process: #&lt;process shell&gt; had the event 'killed'
     &rArr; #&lt;process shell&gt;
</pre></div></div>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-process_002dsentinel"><span class="category-def">Function: </span><span><strong class="def-name">process-sentinel</strong> <var class="def-var-arguments">process</var><a class="copiable-link" href="#index-process_002dsentinel"> &para;</a></span></dt>
<dd><p>This function returns the sentinel of <var class="var">process</var>.
</p></dd></dl>

<p>In case a process status changes need to be passed to several sentinels, you
can use <code class="code">add-function</code> to combine an existing sentinel with a new one.
See <a class="xref" href="Advising-Functions.html">Advising Emacs Lisp Functions</a>.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-waiting_002dfor_002duser_002dinput_002dp"><span class="category-def">Function: </span><span><strong class="def-name">waiting-for-user-input-p</strong><a class="copiable-link" href="#index-waiting_002dfor_002duser_002dinput_002dp"> &para;</a></span></dt>
<dd><p>While a sentinel or filter function is running, this function returns
non-<code class="code">nil</code> if Emacs was waiting for keyboard input from the user at
the time the sentinel or filter function was called, or <code class="code">nil</code> if it
was not.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Query-Before-Exit.html">Querying Before Exit</a>, Previous: <a href="Output-from-Processes.html">Receiving Output from Processes</a>, Up: <a href="Processes.html">Processes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
