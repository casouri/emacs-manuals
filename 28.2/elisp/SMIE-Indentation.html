<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 28.2.

Copyright Â© 1990-1996, 1998-2022 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>SMIE Indentation (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="SMIE Indentation (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="SMIE Indentation (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="SMIE.html" rel="up" title="SMIE">
<link href="SMIE-Indentation-Helpers.html" rel="next" title="SMIE Indentation Helpers">
<link href="SMIE-Tricks.html" rel="prev" title="SMIE Tricks">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
span:hover a.copiable-link {visibility: visible}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsubsection-level-extent" id="SMIE-Indentation">
<div class="nav-panel">
<p>
Next: <a href="SMIE-Indentation-Helpers.html" accesskey="n" rel="next">Helper Functions for Indentation Rules</a>, Previous: <a href="SMIE-Tricks.html" accesskey="p" rel="prev">Living With a Weak Parser</a>, Up: <a href="SMIE.html" accesskey="u" rel="up">Simple Minded Indentation Engine</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsubsection" id="Specifying-Indentation-Rules"><span>24.7.1.6 Specifying Indentation Rules<a class="copiable-link" href="#Specifying-Indentation-Rules"> &para;</a></span></h4>
<a class="index-entry-id" id="index-indentation-rules_002c-SMIE"></a>

<p>Based on the provided grammar, SMIE will be able to provide automatic
indentation without any extra effort.  But in practice, this default
indentation style will probably not be good enough.  You will want to
tweak it in many different cases.
</p>
<p>SMIE indentation is based on the idea that indentation rules should be
as local as possible.  To this end, it relies on the idea of
<em class="emph">virtual</em> indentation, which is the indentation that a particular
program point would have if it were at the beginning of a line.
Of course, if that program point is indeed at the beginning of a line,
its virtual indentation is its current indentation.  But if not, then
SMIE uses the indentation algorithm to compute the virtual indentation
of that point.  Now in practice, the virtual indentation of a program
point does not have to be identical to the indentation it would have if
we inserted a newline before it.  To see how this works, the SMIE rule
for indentation after a <code class="code">{</code> in C does not care whether the
<code class="code">{</code> is standing on a line of its own or is at the end of the
preceding line.  Instead, these different cases are handled in the
indentation rule that decides how to indent before a <code class="code">{</code>.
</p>
<p>Another important concept is the notion of <em class="emph">parent</em>: The
<em class="emph">parent</em> of a token, is the head token of the nearest enclosing
syntactic construct.  For example, the parent of an <code class="code">else</code> is the
<code class="code">if</code> to which it belongs, and the parent of an <code class="code">if</code>, in turn,
is the lead token of the surrounding construct.  The command
<code class="code">backward-sexp</code> jumps from a token to its parent, but there are
some caveats: for <em class="emph">openers</em> (tokens which start a construct, like
<code class="code">if</code>), you need to start with point before the token, while for
others you need to start with point after the token.
<code class="code">backward-sexp</code> stops with point before the parent token if that is
the <em class="emph">opener</em> of the token of interest, and otherwise it stops with
point after the parent token.
</p>
<p>SMIE indentation rules are specified using a function that takes two
arguments <var class="var">method</var> and <var class="var">arg</var> where the meaning of <var class="var">arg</var> and the
expected return value depend on <var class="var">method</var>.
</p>
<p><var class="var">method</var> can be:
</p><ul class="itemize mark-bullet">
<li><code class="code">:after</code>, in which case <var class="var">arg</var> is a token and the function
should return the <var class="var">offset</var> to use for indentation after <var class="var">arg</var>.
</li><li><code class="code">:before</code>, in which case <var class="var">arg</var> is a token and the function
should return the <var class="var">offset</var> to use to indent <var class="var">arg</var> itself.
</li><li><code class="code">:elem</code>, in which case the function should return either the offset
to use to indent function arguments (if <var class="var">arg</var> is the symbol
<code class="code">arg</code>) or the basic indentation step (if <var class="var">arg</var> is the symbol
<code class="code">basic</code>).
</li><li><code class="code">:list-intro</code>, in which case <var class="var">arg</var> is a token and the function
should return non-<code class="code">nil</code> if the token is followed by a list of
expressions (not separated by any token) rather than an expression.
</li></ul>

<p>When <var class="var">arg</var> is a token, the function is called with point just before
that token.  A return value of <code class="code">nil</code> always means to fallback on the
default behavior, so the function should return <code class="code">nil</code> for arguments it
does not expect.
</p>
<p><var class="var">offset</var> can be:
</p><ul class="itemize mark-bullet">
<li><code class="code">nil</code>: use the default indentation rule.
</li><li><code class="code">(column . <var class="var">column</var>)</code>: indent to column <var class="var">column</var>.
</li><li><var class="var">number</var>: offset by <var class="var">number</var>, relative to a base token which is
the current token for <code class="code">:after</code> and its parent for <code class="code">:before</code>.
</li></ul>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="SMIE-Indentation-Helpers.html">Helper Functions for Indentation Rules</a>, Previous: <a href="SMIE-Tricks.html">Living With a Weak Parser</a>, Up: <a href="SMIE.html">Simple Minded Indentation Engine</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
