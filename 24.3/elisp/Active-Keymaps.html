<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Active Keymaps (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Active Keymaps (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Active Keymaps (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Keymaps.html#Keymaps" rel="up" title="Keymaps">
<link href="Searching-Keymaps.html#Searching-Keymaps" rel="next" title="Searching Keymaps">
<link href="Prefix-Keys.html#Prefix-Keys" rel="prev" title="Prefix Keys">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="Active-Keymaps"></a>
<div class="header">
<p>
Next: <a href="Searching-Keymaps.html#Searching-Keymaps" accesskey="n" rel="next">Searching Keymaps</a>, Previous: <a href="Prefix-Keys.html#Prefix-Keys" accesskey="p" rel="prev">Prefix Keys</a>, Up: <a href="Keymaps.html#Keymaps" accesskey="u" rel="up">Keymaps</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Active-Keymaps-1"></a>
<h3 class="section">22.7 Active Keymaps</h3>
<a name="index-active-keymap"></a>
<a name="index-global-keymap"></a>
<a name="index-local-keymap"></a>

<p>Emacs normally contains many keymaps; at any given time, just a few
of them are <em>active</em>, meaning that they participate in the
interpretation of user input.  All the active keymaps are used
together to determine what command to execute when a key is entered.
</p>
<p>Normally the active keymaps are the <code>keymap</code> property keymap,
the keymaps of any enabled minor modes, the current buffer&rsquo;s local
keymap, and the global keymap, in that order.  Emacs searches for each
input key sequence in all these keymaps.  See <a href="Searching-Keymaps.html#Searching-Keymaps">Searching Keymaps</a>,
for more details of this procedure.
</p>
<p>When the key sequence starts with a mouse event,
the active keymaps are determined based on the
position in that event.  If the event happened on a string embedded
with a <code>display</code>, <code>before-string</code>, or <code>after-string</code>
property (see <a href="Special-Properties.html#Special-Properties">Special Properties</a>), the non-<code>nil</code> map
properties of the string override those of the buffer (if the
underlying buffer text contains map properties in its text properties
or overlays, they are ignored).
</p>
<p>The <em>global keymap</em> holds the bindings of keys that are defined
regardless of the current buffer, such as <kbd>C-f</kbd>.  The variable
<code>global-map</code> holds this keymap, which is always active.
</p>
<p>Each buffer may have another keymap, its <em>local keymap</em>, which
may contain new or overriding definitions for keys.  The current
buffer&rsquo;s local keymap is always active except when
<code>overriding-local-map</code> overrides it.  The <code>local-map</code> text
or overlay property can specify an alternative local keymap for certain
parts of the buffer; see <a href="Special-Properties.html#Special-Properties">Special Properties</a>.
</p>
<p>Each minor mode can have a keymap; if it does, the keymap is active
when the minor mode is enabled.  Modes for emulation can specify
additional active keymaps through the variable
<code>emulation-mode-map-alists</code>.
</p>
<p>The highest precedence normal keymap comes from the <code>keymap</code>
text or overlay property.  If that is non-<code>nil</code>, it is the first
keymap to be processed, in normal circumstances.  Next comes
any keymap added by the function <code>set-temporary-overlay-map</code>.
See <a href="Controlling-Active-Maps.html#Controlling-Active-Maps">Controlling Active Maps</a>.
</p>
<p>However, there are also special ways for programs to substitute
other keymaps for some of those.  The variable
<code>overriding-local-map</code>, if non-<code>nil</code>, specifies a keymap
that replaces all the usual active keymaps except the global keymap.
Another way to do this is with <code>overriding-terminal-local-map</code>;
it operates on a per-terminal basis.  These variables are documented
below.
</p>
<a name="index-major-mode-keymap"></a>
<p>Since every buffer that uses the same major mode normally uses the
same local keymap, you can think of the keymap as local to the mode.  A
change to the local keymap of a buffer (using <code>local-set-key</code>, for
example) is seen also in the other buffers that share that keymap.
</p>
<p>The local keymaps that are used for Lisp mode and some other major
modes exist even if they have not yet been used.  These local keymaps are
the values of variables such as <code>lisp-mode-map</code>.  For most major
modes, which are less frequently used, the local keymap is constructed
only when the mode is used for the first time in a session.
</p>
<p>The minibuffer has local keymaps, too; they contain various completion
and exit commands.  See <a href="Intro-to-Minibuffers.html#Intro-to-Minibuffers">Intro to Minibuffers</a>.
</p>
<p>Emacs has other keymaps that are used in a different way&mdash;translating
events within <code>read-key-sequence</code>.  See <a href="Translation-Keymaps.html#Translation-Keymaps">Translation Keymaps</a>.
</p>
<p>See <a href="Standard-Keymaps.html#Standard-Keymaps">Standard Keymaps</a>, for a list of some standard keymaps.
</p>
<dl>
<dt><a name="index-current_002dactive_002dmaps"></a>Function: <strong>current-active-maps</strong> <em>&amp;optional olp position</em></dt>
<dd><p>This returns the list of active keymaps that would be used by the
command loop in the current circumstances to look up a key sequence.
Normally it ignores <code>overriding-local-map</code> and
<code>overriding-terminal-local-map</code>, but if <var>olp</var> is non-<code>nil</code>
then it pays attention to them.  <var>position</var> can optionally be either
an event position as returned by <code>event-start</code> or a buffer
position, and may change the keymaps as described for
<code>key-binding</code>.
</p></dd></dl>

<dl>
<dt><a name="index-key_002dbinding"></a>Function: <strong>key-binding</strong> <em>key &amp;optional accept-defaults no-remap position</em></dt>
<dd><p>This function returns the binding for <var>key</var> according to the
current active keymaps.  The result is <code>nil</code> if <var>key</var> is
undefined in the keymaps.
</p>
<p>The argument <var>accept-defaults</var> controls checking for default
bindings, as in <code>lookup-key</code> (see <a href="Functions-for-Key-Lookup.html#Functions-for-Key-Lookup">Functions for Key Lookup</a>).
</p>
<p>When commands are remapped (see <a href="Remapping-Commands.html#Remapping-Commands">Remapping Commands</a>),
<code>key-binding</code> normally processes command remappings so as to
return the remapped command that will actually be executed.  However,
if <var>no-remap</var> is non-<code>nil</code>, <code>key-binding</code> ignores
remappings and returns the binding directly specified for <var>key</var>.
</p>
<p>If <var>key</var> starts with a mouse event (perhaps following a prefix
event), the maps to be consulted are determined based on the event&rsquo;s
position.  Otherwise, they are determined based on the value of point.
However, you can override either of them by specifying <var>position</var>.
If <var>position</var> is non-<code>nil</code>, it should be either a buffer
position or an event position like the value of <code>event-start</code>.
Then the maps consulted are determined based on <var>position</var>.
</p>
<p>An error is signaled if <var>key</var> is not a string or a vector.
</p>
<div class="example">
<pre class="example">(key-binding &quot;\C-x\C-f&quot;)
    &rArr; find-file
</pre></div>
</dd></dl>

<hr>
<div class="header">
<p>
Next: <a href="Searching-Keymaps.html#Searching-Keymaps" accesskey="n" rel="next">Searching Keymaps</a>, Previous: <a href="Prefix-Keys.html#Prefix-Keys" accesskey="p" rel="prev">Prefix Keys</a>, Up: <a href="Keymaps.html#Keymaps" accesskey="u" rel="up">Keymaps</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
