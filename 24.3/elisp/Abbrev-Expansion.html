<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Abbrev Expansion (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Abbrev Expansion (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Abbrev Expansion (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Abbrevs.html" rel="up" title="Abbrevs">
<link href="Standard-Abbrev-Tables.html" rel="next" title="Standard Abbrev Tables">
<link href="Abbrev-Files.html" rel="prev" title="Abbrev Files">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>


</head>

<body lang="en">
<div class="section-level-extent" id="Abbrev-Expansion">
<div class="nav-panel">
<p>
Next: <a href="Standard-Abbrev-Tables.html" accesskey="n" rel="next">Standard Abbrev Tables</a>, Previous: <a href="Abbrev-Files.html" accesskey="p" rel="prev">Saving Abbrevs in Files</a>, Up: <a href="Abbrevs.html" accesskey="u" rel="up">Abbrevs and Abbrev Expansion</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Looking-Up-and-Expanding-Abbreviations"><span>36.4 Looking Up and Expanding Abbreviations<a class="copiable-link" href="#Looking-Up-and-Expanding-Abbreviations"> &para;</a></span></h3>

<p>Abbrevs are usually expanded by certain interactive commands,
including <code class="code">self-insert-command</code>.  This section describes the
subroutines used in writing such commands, as well as the variables they
use for communication.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-abbrev_002dsymbol"><span class="category-def">Function: </span><span><strong class="def-name">abbrev-symbol</strong> <var class="def-var-arguments">abbrev &amp;optional table</var><a class="copiable-link" href="#index-abbrev_002dsymbol"> &para;</a></span></dt>
<dd><p>This function returns the symbol representing the abbrev named
<var class="var">abbrev</var>.  It returns <code class="code">nil</code> if that abbrev is not
defined.  The optional second argument <var class="var">table</var> is the abbrev table
in which to look it up.  If <var class="var">table</var> is <code class="code">nil</code>, this function
tries first the current buffer&rsquo;s local abbrev table, and second the
global abbrev table.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-abbrev_002dexpansion"><span class="category-def">Function: </span><span><strong class="def-name">abbrev-expansion</strong> <var class="def-var-arguments">abbrev &amp;optional table</var><a class="copiable-link" href="#index-abbrev_002dexpansion"> &para;</a></span></dt>
<dd><p>This function returns the string that <var class="var">abbrev</var> would expand into (as
defined by the abbrev tables used for the current buffer).  It returns
<code class="code">nil</code> if <var class="var">abbrev</var> is not a valid abbrev.
The optional argument <var class="var">table</var> specifies the abbrev table to use,
as in <code class="code">abbrev-symbol</code>.
</p></dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-expand_002dabbrev"><span class="category-def">Command: </span><span><strong class="def-name">expand-abbrev</strong><a class="copiable-link" href="#index-expand_002dabbrev"> &para;</a></span></dt>
<dd><p>This command expands the abbrev before point, if any.  If point does not
follow an abbrev, this command does nothing.  The command returns the
abbrev symbol if it did expansion, <code class="code">nil</code> otherwise.
</p>
<p>If the abbrev symbol has a hook function that is a symbol whose
<code class="code">no-self-insert</code> property is non-<code class="code">nil</code>, and if the hook
function returns <code class="code">nil</code> as its value, then <code class="code">expand-abbrev</code>
returns <code class="code">nil</code> even though expansion did occur.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-abbrev_002dinsert"><span class="category-def">Function: </span><span><strong class="def-name">abbrev-insert</strong> <var class="def-var-arguments">abbrev &amp;optional name start end</var><a class="copiable-link" href="#index-abbrev_002dinsert"> &para;</a></span></dt>
<dd><p>This function inserts the abbrev expansion of <code class="code">abbrev</code>, replacing
the text between <code class="code">start</code> and <code class="code">end</code>.  If <code class="code">start</code> is
omitted, it defaults to point.  <code class="code">name</code>, if non-<code class="code">nil</code>, should
be the name by which this abbrev was found (a string); it is used to
figure out whether to adjust the capitalization of the expansion.  The
function returns <code class="code">abbrev</code> if the abbrev was successfully
inserted.
</p></dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-abbrev_002dprefix_002dmark"><span class="category-def">Command: </span><span><strong class="def-name">abbrev-prefix-mark</strong> <var class="def-var-arguments">&amp;optional arg</var><a class="copiable-link" href="#index-abbrev_002dprefix_002dmark"> &para;</a></span></dt>
<dd><p>This command marks the current location of point as the beginning of
an abbrev.  The next call to <code class="code">expand-abbrev</code> will use the text
from here to point (where it is then) as the abbrev to expand, rather
than using the previous word as usual.
</p>
<p>First, this command expands any abbrev before point, unless <var class="var">arg</var>
is non-<code class="code">nil</code>.  (Interactively, <var class="var">arg</var> is the prefix argument.)
Then it inserts a hyphen before point, to indicate the start of the
next abbrev to be expanded.  The actual expansion removes the hyphen.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-abbrev_002dall_002dcaps"><span class="category-def">User Option: </span><span><strong class="def-name">abbrev-all-caps</strong><a class="copiable-link" href="#index-abbrev_002dall_002dcaps"> &para;</a></span></dt>
<dd><p>When this is set non-<code class="code">nil</code>, an abbrev entered entirely in upper
case is expanded using all upper case.  Otherwise, an abbrev entered
entirely in upper case is expanded by capitalizing each word of the
expansion.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-abbrev_002dstart_002dlocation"><span class="category-def">Variable: </span><span><strong class="def-name">abbrev-start-location</strong><a class="copiable-link" href="#index-abbrev_002dstart_002dlocation"> &para;</a></span></dt>
<dd><p>The value of this variable is a buffer position (an integer or a marker)
for <code class="code">expand-abbrev</code> to use as the start of the next abbrev to be
expanded.  The value can also be <code class="code">nil</code>, which means to use the
word before point instead.  <code class="code">abbrev-start-location</code> is set to
<code class="code">nil</code> each time <code class="code">expand-abbrev</code> is called.  This variable is
also set by <code class="code">abbrev-prefix-mark</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-abbrev_002dstart_002dlocation_002dbuffer"><span class="category-def">Variable: </span><span><strong class="def-name">abbrev-start-location-buffer</strong><a class="copiable-link" href="#index-abbrev_002dstart_002dlocation_002dbuffer"> &para;</a></span></dt>
<dd><p>The value of this variable is the buffer for which
<code class="code">abbrev-start-location</code> has been set.  Trying to expand an abbrev
in any other buffer clears <code class="code">abbrev-start-location</code>.  This variable
is set by <code class="code">abbrev-prefix-mark</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002dabbrev"><span class="category-def">Variable: </span><span><strong class="def-name">last-abbrev</strong><a class="copiable-link" href="#index-last_002dabbrev"> &para;</a></span></dt>
<dd><p>This is the <code class="code">abbrev-symbol</code> of the most recent abbrev expanded.  This
information is left by <code class="code">expand-abbrev</code> for the sake of the
<code class="code">unexpand-abbrev</code> command (see <a data-manual="emacs" href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Expanding-Abbrevs.html#Expanding-Abbrevs">Expanding
Abbrevs</a> in <cite class="cite">The GNU Emacs Manual</cite>).
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002dabbrev_002dlocation"><span class="category-def">Variable: </span><span><strong class="def-name">last-abbrev-location</strong><a class="copiable-link" href="#index-last_002dabbrev_002dlocation"> &para;</a></span></dt>
<dd><p>This is the location of the most recent abbrev expanded.  This contains
information left by <code class="code">expand-abbrev</code> for the sake of the
<code class="code">unexpand-abbrev</code> command.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-last_002dabbrev_002dtext"><span class="category-def">Variable: </span><span><strong class="def-name">last-abbrev-text</strong><a class="copiable-link" href="#index-last_002dabbrev_002dtext"> &para;</a></span></dt>
<dd><p>This is the exact expansion text of the most recent abbrev expanded,
after case conversion (if any).  Its value is <code class="code">nil</code> if the abbrev
has already been unexpanded.  This contains information left by
<code class="code">expand-abbrev</code> for the sake of the <code class="code">unexpand-abbrev</code> command.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-abbrev_002dexpand_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">abbrev-expand-functions</strong><a class="copiable-link" href="#index-abbrev_002dexpand_002dfunctions"> &para;</a></span></dt>
<dd><p>This is a wrapper hook (see <a class="pxref" href="Running-Hooks.html">Running Hooks</a>) run around the
<code class="code">expand-abbrev</code> function.  Each function on this hook is called
with a single argument: a function that performs the normal abbrev
expansion.  The hook function can hence do anything it wants before
and after performing the expansion.  It can also choose not to call
its argument, thus overriding the default behavior; or it may even
call it several times.  The function should return the abbrev symbol
if expansion took place.
</p></dd></dl>

<p>The following sample code shows a simple use of
<code class="code">abbrev-expand-functions</code>.  It assumes that <code class="code">foo-mode</code> is a
mode for editing certain files in which lines that start with &lsquo;<samp class="samp">#</samp>&rsquo;
are comments.  You want to use Text mode abbrevs for those lines.  The
regular local abbrev table, <code class="code">foo-mode-abbrev-table</code> is
appropriate for all other lines.  See <a class="xref" href="Standard-Abbrev-Tables.html">Standard Abbrev Tables</a>, for the
definitions of <code class="code">local-abbrev-table</code> and <code class="code">text-mode-abbrev-table</code>.
</p>
<div class="example smallexample">
<pre class="example-preformatted">(defun foo-mode-abbrev-expand-function (expand)
  (if (not (save-excursion (forward-line 0) (eq (char-after) ?#)))
      ;; Performs normal expansion.
      (funcall expand)
    ;; We're inside a comment: use the text-mode abbrevs.
    (let ((local-abbrev-table text-mode-abbrev-table))
      (funcall expand))))

(add-hook 'foo-mode-hook
          #'(lambda ()
              (add-hook 'abbrev-expand-functions
                        'foo-mode-abbrev-expand-function
                        nil t)))
</pre></div>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Standard-Abbrev-Tables.html">Standard Abbrev Tables</a>, Previous: <a href="Abbrev-Files.html">Saving Abbrevs in Files</a>, Up: <a href="Abbrevs.html">Abbrevs and Abbrev Expansion</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
