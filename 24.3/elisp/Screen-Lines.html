<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Screen Lines (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Screen Lines (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Screen Lines (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Motion.html" rel="up" title="Motion">
<link href="List-Motion.html" rel="next" title="List Motion">
<link href="Text-Lines.html" rel="prev" title="Text Lines">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>


</head>

<body lang="en">
<div class="subsection-level-extent" id="Screen-Lines">
<div class="nav-panel">
<p>
Next: <a href="List-Motion.html" accesskey="n" rel="next">Moving over Balanced Expressions</a>, Previous: <a href="Text-Lines.html" accesskey="p" rel="prev">Motion by Text Lines</a>, Up: <a href="Motion.html" accesskey="u" rel="up">Motion</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Motion-by-Screen-Lines"><span>30.2.5 Motion by Screen Lines<a class="copiable-link" href="#Motion-by-Screen-Lines"> &para;</a></span></h4>

<p>The line functions in the previous section count text lines, delimited
only by newline characters.  By contrast, these functions count screen
lines, which are defined by the way the text appears on the screen.  A
text line is a single screen line if it is short enough to fit the width
of the selected window, but otherwise it may occupy several screen
lines.
</p>
<p>In some cases, text lines are truncated on the screen rather than
continued onto additional screen lines.  In these cases,
<code class="code">vertical-motion</code> moves point much like <code class="code">forward-line</code>.
See <a class="xref" href="Truncation.html">Truncation</a>.
</p>
<p>Because the width of a given string depends on the flags that control
the appearance of certain characters, <code class="code">vertical-motion</code> behaves
differently, for a given piece of text, depending on the buffer it is
in, and even on the selected window (because the width, the truncation
flag, and display table may vary between windows).  See <a class="xref" href="Usual-Display.html">Usual Display Conventions</a>.
</p>
<p>These functions scan text to determine where screen lines break, and
thus take time proportional to the distance scanned.  If you intend to
use them heavily, Emacs provides caches which may improve the
performance of your code.  See <a class="xref" href="Truncation.html">cache-long-line-scans</a>.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-vertical_002dmotion"><span class="category-def">Function: </span><span><strong class="def-name">vertical-motion</strong> <var class="def-var-arguments">count &amp;optional window</var><a class="copiable-link" href="#index-vertical_002dmotion"> &para;</a></span></dt>
<dd><p>This function moves point to the start of the screen line <var class="var">count</var>
screen lines down from the screen line containing point.  If <var class="var">count</var>
is negative, it moves up instead.
</p>
<p>The <var class="var">count</var> argument can be a cons cell, <code class="code">(<var class="var">cols</var>
. <var class="var">lines</var>)</code>, instead of an integer.  Then the function moves by
<var class="var">lines</var> screen lines, and puts point <var class="var">cols</var> columns from the
start of that screen line.
</p>
<p>The return value is the number of screen lines over which point was
moved.  The value may be less in absolute value than <var class="var">count</var> if
the beginning or end of the buffer was reached.
</p>
<p>The window <var class="var">window</var> is used for obtaining parameters such as the
width, the horizontal scrolling, and the display table.  But
<code class="code">vertical-motion</code> always operates on the current buffer, even if
<var class="var">window</var> currently displays some other buffer.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-count_002dscreen_002dlines"><span class="category-def">Function: </span><span><strong class="def-name">count-screen-lines</strong> <var class="def-var-arguments">&amp;optional beg end count-final-newline window</var><a class="copiable-link" href="#index-count_002dscreen_002dlines"> &para;</a></span></dt>
<dd><p>This function returns the number of screen lines in the text from
<var class="var">beg</var> to <var class="var">end</var>.  The number of screen lines may be different
from the number of actual lines, due to line continuation, the display
table, etc.  If <var class="var">beg</var> and <var class="var">end</var> are <code class="code">nil</code> or omitted,
they default to the beginning and end of the accessible portion of the
buffer.
</p>
<p>If the region ends with a newline, that is ignored unless the optional
third argument <var class="var">count-final-newline</var> is non-<code class="code">nil</code>.
</p>
<p>The optional fourth argument <var class="var">window</var> specifies the window for
obtaining parameters such as width, horizontal scrolling, and so on.
The default is to use the selected window&rsquo;s parameters.
</p>
<p>Like <code class="code">vertical-motion</code>, <code class="code">count-screen-lines</code> always uses the
current buffer, regardless of which buffer is displayed in
<var class="var">window</var>.  This makes possible to use <code class="code">count-screen-lines</code> in
any buffer, whether or not it is currently displayed in some window.
</p></dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-move_002dto_002dwindow_002dline"><span class="category-def">Command: </span><span><strong class="def-name">move-to-window-line</strong> <var class="def-var-arguments">count</var><a class="copiable-link" href="#index-move_002dto_002dwindow_002dline"> &para;</a></span></dt>
<dd><p>This function moves point with respect to the text currently displayed
in the selected window.  It moves point to the beginning of the screen
line <var class="var">count</var> screen lines from the top of the window.  If
<var class="var">count</var> is negative, that specifies a position
&minus;<var class="var">count</var><!-- /@w --> lines from the bottom (or the last line of the
buffer, if the buffer ends above the specified screen position).
</p>
<p>If <var class="var">count</var> is <code class="code">nil</code>, then point moves to the beginning of the
line in the middle of the window.  If the absolute value of <var class="var">count</var>
is greater than the size of the window, then point moves to the place
that would appear on that screen line if the window were tall enough.
This will probably cause the next redisplay to scroll to bring that
location onto the screen.
</p>
<p>In an interactive call, <var class="var">count</var> is the numeric prefix argument.
</p>
<p>The value returned is the window line number point has moved to, with
the top line in the window numbered 0.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-compute_002dmotion"><span class="category-def">Function: </span><span><strong class="def-name">compute-motion</strong> <var class="def-var-arguments">from frompos to topos width offsets window</var><a class="copiable-link" href="#index-compute_002dmotion"> &para;</a></span></dt>
<dd><p>This function scans the current buffer, calculating screen positions.
It scans the buffer forward from position <var class="var">from</var>, assuming that is
at screen coordinates <var class="var">frompos</var>, to position <var class="var">to</var> or coordinates
<var class="var">topos</var>, whichever comes first.  It returns the ending buffer
position and screen coordinates.
</p>
<p>The coordinate arguments <var class="var">frompos</var> and <var class="var">topos</var> are cons cells of
the form <code class="code">(<var class="var">hpos</var> . <var class="var">vpos</var>)</code>.
</p>
<p>The argument <var class="var">width</var> is the number of columns available to display
text; this affects handling of continuation lines.  <code class="code">nil</code> means
the actual number of usable text columns in the window, which is
equivalent to the value returned by <code class="code">(window-width window)</code>.
</p>
<p>The argument <var class="var">offsets</var> is either <code class="code">nil</code> or a cons cell of the
form <code class="code">(<var class="var">hscroll</var> . <var class="var">tab-offset</var>)</code>.  Here <var class="var">hscroll</var> is
the number of columns not being displayed at the left margin; most
callers get this by calling <code class="code">window-hscroll</code>.  Meanwhile,
<var class="var">tab-offset</var> is the offset between column numbers on the screen and
column numbers in the buffer.  This can be nonzero in a continuation
line, when the previous screen lines&rsquo; widths do not add up to a multiple
of <code class="code">tab-width</code>.  It is always zero in a non-continuation line.
</p>
<p>The window <var class="var">window</var> serves only to specify which display table to
use.  <code class="code">compute-motion</code> always operates on the current buffer,
regardless of what buffer is displayed in <var class="var">window</var>.
</p>
<p>The return value is a list of five elements:
</p>
<div class="example">
<pre class="example-preformatted">(<var class="var">pos</var> <var class="var">hpos</var> <var class="var">vpos</var> <var class="var">prevhpos</var> <var class="var">contin</var>)
</pre></div>

<p>Here <var class="var">pos</var> is the buffer position where the scan stopped, <var class="var">vpos</var>
is the vertical screen position, and <var class="var">hpos</var> is the horizontal screen
position.
</p>
<p>The result <var class="var">prevhpos</var> is the horizontal position one character back
from <var class="var">pos</var>.  The result <var class="var">contin</var> is <code class="code">t</code> if the last line
was continued after (or within) the previous character.
</p>
<p>For example, to find the buffer position of column <var class="var">col</var> of screen line
<var class="var">line</var> of a certain window, pass the window&rsquo;s display start location
as <var class="var">from</var> and the window&rsquo;s upper-left coordinates as <var class="var">frompos</var>.
Pass the buffer&rsquo;s <code class="code">(point-max)</code> as <var class="var">to</var>, to limit the scan to
the end of the accessible portion of the buffer, and pass <var class="var">line</var> and
<var class="var">col</var> as <var class="var">topos</var>.  Here&rsquo;s a function that does this:
</p>
<div class="example">
<pre class="example-preformatted">(defun coordinates-of-position (col line)
  (car (compute-motion (window-start)
                       '(0 . 0)
                       (point-max)
                       (cons col line)
                       (window-width)
                       (cons (window-hscroll) 0)
                       (selected-window))))
</pre></div>

<p>When you use <code class="code">compute-motion</code> for the minibuffer, you need to use
<code class="code">minibuffer-prompt-width</code> to get the horizontal position of the
beginning of the first screen line.  See <a class="xref" href="Minibuffer-Contents.html">Minibuffer Contents</a>.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="List-Motion.html">Moving over Balanced Expressions</a>, Previous: <a href="Text-Lines.html">Motion by Text Lines</a>, Up: <a href="Motion.html">Motion</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
