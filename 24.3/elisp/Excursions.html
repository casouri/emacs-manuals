<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Excursions (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Excursions (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Excursions (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Positions.html" rel="up" title="Positions">
<link href="Narrowing.html" rel="next" title="Narrowing">
<link href="Motion.html" rel="prev" title="Motion">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>


</head>

<body lang="en">
<div class="section-level-extent" id="Excursions">
<div class="nav-panel">
<p>
Next: <a href="Narrowing.html" accesskey="n" rel="next">Narrowing</a>, Previous: <a href="Motion.html" accesskey="p" rel="prev">Motion</a>, Up: <a href="Positions.html" accesskey="u" rel="up">Positions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Excursions-1"><span>30.3 Excursions<a class="copiable-link" href="#Excursions-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-excursion"></a>

<p>It is often useful to move point &ldquo;temporarily&rdquo; within a localized
portion of the program.  This is called an <em class="dfn">excursion</em>, and it is
done with the <code class="code">save-excursion</code> special form.  This construct
remembers the initial identity of the current buffer, and its values
of point and the mark, and restores them after the excursion
completes.  It is the standard way to move point within one part of a
program and avoid affecting the rest of the program, and is used
thousands of times in the Lisp sources of Emacs.
</p>
<p>If you only need to save and restore the identity of the current
buffer, use <code class="code">save-current-buffer</code> or <code class="code">with-current-buffer</code>
instead (see <a class="pxref" href="Current-Buffer.html">The Current Buffer</a>).  If you need to save or restore
window configurations, see the forms described in <a class="ref" href="Window-Configurations.html">Window Configurations</a> and in <a class="ref" href="Frame-Configurations.html">Frame Configurations</a>.
</p>
<dl class="first-deffn first-defspec-alias-first-deffn">
<dt class="deffn defspec-alias-deffn" id="index-save_002dexcursion"><span class="category-def">Special Form: </span><span><strong class="def-name">save-excursion</strong> <var class="def-var-arguments">body&hellip;</var><a class="copiable-link" href="#index-save_002dexcursion"> &para;</a></span></dt>
<dd><a class="index-entry-id" id="index-mark-excursion"></a>
<a class="index-entry-id" id="index-point-excursion"></a>
<p>This special form saves the identity of the current buffer and the
values of point and the mark in it, evaluates <var class="var">body</var>, and finally
restores the buffer and its saved values of point and the mark.  All
three saved values are restored even in case of an abnormal exit via
<code class="code">throw</code> or error (see <a class="pxref" href="Nonlocal-Exits.html">Nonlocal Exits</a>).
</p>
<p>The value returned by <code class="code">save-excursion</code> is the result of the last
form in <var class="var">body</var>, or <code class="code">nil</code> if no body forms were given.
</p></dd></dl>

<p>Because <code class="code">save-excursion</code> only saves point and mark for the
buffer that was current at the start of the excursion, any changes
made to point and/or mark in other buffers, during the excursion, will
remain in effect afterward.  This frequently leads to unintended
consequences, so the byte compiler warns if you call <code class="code">set-buffer</code>
during an excursion:
</p>
<div class="example">
<pre class="example-preformatted">Warning: Use `with-current-buffer' rather than
         save-excursion+set-buffer
</pre></div>

<p>To avoid such problems, you should call <code class="code">save-excursion</code> only
after setting the desired current buffer, as in the following example:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(defun append-string-to-buffer (string buffer)
  &quot;Append STRING to the end of BUFFER.&quot;
  (with-current-buffer buffer
    (save-excursion
      (goto-char (point-max))
      (insert string))))
</pre></div></div>

<a class="index-entry-id" id="index-window-excursions"></a>
<p>Likewise, <code class="code">save-excursion</code> does not restore window-buffer
correspondences altered by functions such as <code class="code">switch-to-buffer</code>.
</p>
<p><strong class="strong">Warning:</strong> Ordinary insertion of text adjacent to the saved
point value relocates the saved value, just as it relocates all
markers.  More precisely, the saved value is a marker with insertion
type <code class="code">nil</code>.  See <a class="xref" href="Marker-Insertion-Types.html">Marker Insertion Types</a>.  Therefore, when the
saved point value is restored, it normally comes before the inserted
text.
</p>
<p>Although <code class="code">save-excursion</code> saves the location of the mark, it does
not prevent functions which modify the buffer from setting
<code class="code">deactivate-mark</code>, and thus causing the deactivation of the mark
after the command finishes.  See <a class="xref" href="The-Mark.html">The Mark</a>.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Narrowing.html">Narrowing</a>, Previous: <a href="Motion.html">Motion</a>, Up: <a href="Positions.html">Positions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
