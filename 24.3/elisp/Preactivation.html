<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Preactivation (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Preactivation (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Preactivation (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Advising-Functions.html#Advising-Functions" rel="up" title="Advising Functions">
<link href="Argument-Access-in-Advice.html#Argument-Access-in-Advice" rel="next" title="Argument Access in Advice">
<link href="Enabling-Advice.html#Enabling-Advice" rel="prev" title="Enabling Advice">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="Preactivation"></a>
<div class="header">
<p>
Next: <a href="Argument-Access-in-Advice.html#Argument-Access-in-Advice" accesskey="n" rel="next">Argument Access in Advice</a>, Previous: <a href="Enabling-Advice.html#Enabling-Advice" accesskey="p" rel="prev">Enabling Advice</a>, Up: <a href="Advising-Functions.html#Advising-Functions" accesskey="u" rel="up">Advising Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Preactivation-1"></a>
<h3 class="section">17.7 Preactivation</h3>
<a name="index-preactivating-advice"></a>
<a name="index-advice_002c-preactivating"></a>

<p>Constructing a combined definition to execute advice is moderately
expensive.  When a library advises many functions, this can make loading
the library slow.  In that case, you can use <em>preactivation</em> to
construct suitable combined definitions in advance.
</p>
<p>To use preactivation, specify the <code>preactivate</code> flag when you
define the advice with <code>defadvice</code>.  This <code>defadvice</code> call
creates a combined definition which embodies this piece of advice
(whether enabled or not) plus any other currently enabled advice for the
same function, and the function&rsquo;s own definition.  If the
<code>defadvice</code> is compiled, that compiles the combined definition
also.
</p>
<p>When the function&rsquo;s advice is subsequently activated, if the enabled
advice for the function matches what was used to make this combined
definition, then the existing combined definition is used, thus avoiding
the need to construct one.  Thus, preactivation never causes wrong
results&mdash;but it may fail to do any good, if the enabled advice at the
time of activation doesn&rsquo;t match what was used for preactivation.
</p>
<p>Here are some symptoms that can indicate that a preactivation did not
work properly, because of a mismatch.
</p>
<ul>
<li> Activation of the advised
function takes longer than usual.
</li><li> The byte compiler gets
loaded while an advised function gets activated.
</li><li> <code>byte-compile</code> is included in the value of <code>features</code> even
though you did not ever explicitly use the byte compiler.
</li></ul>

<p>Compiled preactivated advice works properly even if the function itself
is not defined until later; however, the function needs to be defined
when you <em>compile</em> the preactivated advice.
</p>
<p>There is no elegant way to find out why preactivated advice is not being
used.  What you can do is to trace the function
<code>ad-cache-id-verification-code</code> (with the function
<code>trace-function-background</code>) before the advised function&rsquo;s advice
is activated.  After activation, check the value returned by
<code>ad-cache-id-verification-code</code> for that function: <code>verified</code>
means that the preactivated advice was used, while other values give
some information about why they were considered inappropriate.
</p>
<p><strong>Warning:</strong> There is one known case that can make preactivation
fail, in that a preconstructed combined definition is used even though
it fails to match the current state of advice.  This can happen when two
packages define different pieces of advice with the same name, in the
same class, for the same function.  But you should avoid that anyway.
</p>
<hr>
<div class="header">
<p>
Next: <a href="Argument-Access-in-Advice.html#Argument-Access-in-Advice" accesskey="n" rel="next">Argument Access in Advice</a>, Previous: <a href="Enabling-Advice.html#Enabling-Advice" accesskey="p" rel="prev">Enabling Advice</a>, Up: <a href="Advising-Functions.html#Advising-Functions" accesskey="u" rel="up">Advising Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
