<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Instrumenting Macro Calls (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Instrumenting Macro Calls (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Instrumenting Macro Calls (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Edebug-and-Macros.html" rel="up" title="Edebug and Macros">
<link href="Specification-List.html" rel="next" title="Specification List">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>


</head>

<body lang="en">
<div class="subsubsection-level-extent" id="Instrumenting-Macro-Calls">
<div class="nav-panel">
<p>
Next: <a href="Specification-List.html" accesskey="n" rel="next">Specification List</a>, Up: <a href="Edebug-and-Macros.html" accesskey="u" rel="up">Edebug and Macros</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsubsection" id="Instrumenting-Macro-Calls-1"><span>18.2.15.1 Instrumenting Macro Calls<a class="copiable-link" href="#Instrumenting-Macro-Calls-1"> &para;</a></span></h4>

<p>When Edebug instruments an expression that calls a Lisp macro, it needs
additional information about the macro to do the job properly.  This is
because there is no a-priori way to tell which subexpressions of the
macro call are forms to be evaluated.  (Evaluation may occur explicitly
in the macro body, or when the resulting expansion is evaluated, or any
time later.)
</p>
<p>Therefore, you must define an Edebug specification for each macro
that Edebug will encounter, to explain the format of calls to that
macro.  To do this, add a <code class="code">debug</code> declaration to the macro
definition.  Here is a simple example that shows the specification for
the <code class="code">for</code> example macro (see <a class="pxref" href="Argument-Evaluation.html">Evaluating Macro Arguments Repeatedly</a>).
</p>
<div class="example smallexample">
<pre class="example-preformatted">(defmacro for (var from init to final do &amp;rest body)
  &quot;Execute a simple \&quot;for\&quot; loop.
For example, (for i from 1 to 10 do (print i)).&quot;
  (declare (debug (symbolp &quot;from&quot; form &quot;to&quot; form &quot;do&quot; &amp;rest form)))
  ...)
</pre></div>

<p>The Edebug specification says which parts of a call to the macro are
forms to be evaluated.  For simple macros, the specification
often looks very similar to the formal argument list of the macro
definition, but specifications are much more general than macro
arguments.  See <a class="xref" href="Defining-Macros.html">Defining Macros</a>, for more explanation of
the <code class="code">declare</code> form.
</p>
<p>Take care to ensure that the specifications are known to Edebug when
you instrument code.  If you are instrumenting a function from a file
that uses <code class="code">eval-when-compile</code> to require another file containing
macro definitions, you may need to explicitly load that file.
</p>
<p>You can also define an edebug specification for a macro separately
from the macro definition with <code class="code">def-edebug-spec</code>.  Adding
<code class="code">debug</code> declarations is preferred, and more convenient, for macro
definitions in Lisp, but <code class="code">def-edebug-spec</code> makes it possible to
define Edebug specifications for special forms implemented in C.
</p>
<dl class="first-deffn">
<dt class="deffn" id="index-def_002dedebug_002dspec"><span class="category-def">Macro: </span><span><strong class="def-name">def-edebug-spec</strong> <var class="def-var-arguments">macro specification</var><a class="copiable-link" href="#index-def_002dedebug_002dspec"> &para;</a></span></dt>
<dd><p>Specify which expressions of a call to macro <var class="var">macro</var> are forms to be
evaluated.  <var class="var">specification</var> should be the edebug specification.
Neither argument is evaluated.
</p>
<p>The <var class="var">macro</var> argument can actually be any symbol, not just a macro
name.
</p></dd></dl>

<p>Here is a table of the possibilities for <var class="var">specification</var> and how each
directs processing of arguments.
</p>
<dl class="table">
<dt><code class="code">t</code></dt>
<dd><p>All arguments are instrumented for evaluation.
</p>
</dd>
<dt><code class="code">0</code></dt>
<dd><p>None of the arguments is instrumented.
</p>
</dd>
<dt>a symbol</dt>
<dd><p>The symbol must have an Edebug specification, which is used instead.
This indirection is repeated until another kind of specification is
found.  This allows you to inherit the specification from another macro.
</p>
</dd>
<dt>a list</dt>
<dd><p>The elements of the list describe the types of the arguments of a
calling form.  The possible elements of a specification list are
described in the following sections.
</p></dd>
</dl>

<p>If a macro has no Edebug specification, neither through a <code class="code">debug</code>
declaration nor through a <code class="code">def-edebug-spec</code> call, the variable
<code class="code">edebug-eval-macro-args</code> comes into play.
</p>
<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-edebug_002deval_002dmacro_002dargs"><span class="category-def">User Option: </span><span><strong class="def-name">edebug-eval-macro-args</strong><a class="copiable-link" href="#index-edebug_002deval_002dmacro_002dargs"> &para;</a></span></dt>
<dd><p>This controls the way Edebug treats macro arguments with no explicit
Edebug specification.  If it is <code class="code">nil</code> (the default), none of the
arguments is instrumented for evaluation.  Otherwise, all arguments
are instrumented.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Specification-List.html">Specification List</a>, Up: <a href="Edebug-and-Macros.html">Edebug and Macros</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
