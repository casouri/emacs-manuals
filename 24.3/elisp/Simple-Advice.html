<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Simple Advice (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Simple Advice (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Simple Advice (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Advising-Functions.html" rel="up" title="Advising Functions">
<link href="Defining-Advice.html" rel="next" title="Defining Advice">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="en">
<div class="section-level-extent" id="Simple-Advice">
<div class="nav-panel">
<p>
Next: <a href="Defining-Advice.html" accesskey="n" rel="next">Defining Advice</a>, Up: <a href="Advising-Functions.html" accesskey="u" rel="up">Advising Emacs Lisp Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="A-Simple-Advice-Example"><span>17.1 A Simple Advice Example<a class="copiable-link" href="#A-Simple-Advice-Example"> &para;</a></span></h3>

<p>The command <code class="code">next-line</code> moves point down vertically one or more
lines; it is the standard binding of <kbd class="kbd">C-n</kbd>.  When used on the last
line of the buffer, this command inserts a newline to create a line to
move to if <code class="code">next-line-add-newlines</code> is non-<code class="code">nil</code> (its default
is <code class="code">nil</code>.)
</p>
<p>Suppose you wanted to add a similar feature to <code class="code">previous-line</code>,
which would insert a new line at the beginning of the buffer for the
command to move to (when <code class="code">next-line-add-newlines</code> is
non-<code class="code">nil</code>).  How could you do this?
</p>
<p>You could do it by redefining the whole function, but that is not
modular.  The advice feature provides a cleaner alternative: you can
effectively add your code to the existing function definition, without
actually changing or even seeing that definition.  Here is how to do
this:
</p>
<div class="example">
<pre class="example-preformatted">(defadvice previous-line (before next-line-at-end
                                 (&amp;optional arg try-vscroll))
  &quot;Insert an empty line when moving up from the top line.&quot;
  (if (and next-line-add-newlines (= arg 1)
           (save-excursion (beginning-of-line) (bobp)))
      (progn
        (beginning-of-line)
        (newline))))
</pre></div>

<p>This expression defines a <em class="dfn">piece of advice</em> for the function
<code class="code">previous-line</code>.  This piece of advice is named
<code class="code">next-line-at-end</code>, and the symbol <code class="code">before</code> says that it is
<em class="dfn">before-advice</em> which should run before the regular definition of
<code class="code">previous-line</code>.  <code class="code">(&amp;optional arg try-vscroll)</code> specifies
how the advice code can refer to the function&rsquo;s arguments.
</p>
<p>When this piece of advice runs, it creates an additional line, in the
situation where that is appropriate, but does not move point to that
line.  This is the correct way to write the advice, because the normal
definition will run afterward and will move back to the newly inserted
line.
</p>
<p>Defining the advice doesn&rsquo;t immediately change the function
<code class="code">previous-line</code>.  That happens when you <em class="dfn">activate</em> the advice,
like this:
</p>
<div class="example">
<pre class="example-preformatted">(ad-activate 'previous-line)
</pre></div>

<p>This is what actually begins to use the advice that has been defined so
far for the function <code class="code">previous-line</code>.  Henceforth, whenever that
function is run, whether invoked by the user with <kbd class="kbd">C-p</kbd> or
<kbd class="kbd">M-x</kbd>, or called from Lisp, it runs the advice first, and its
regular definition second.
</p>
<p>This example illustrates before-advice, which is one <em class="dfn">class</em> of
advice: it runs before the function&rsquo;s base definition.  There are two
other advice classes: <em class="dfn">after-advice</em>, which runs after the base
definition, and <em class="dfn">around-advice</em>, which lets you specify an
expression to wrap around the invocation of the base definition.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Defining-Advice.html">Defining Advice</a>, Up: <a href="Advising-Functions.html">Advising Emacs Lisp Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
