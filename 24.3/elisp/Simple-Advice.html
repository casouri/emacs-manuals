<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 24.3.

Copyright © 1990-1996, 1998-2013 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Simple Advice (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Simple Advice (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Simple Advice (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Advising-Functions.html#Advising-Functions" rel="up" title="Advising Functions">
<link href="Defining-Advice.html#Defining-Advice" rel="next" title="Defining Advice">
<link href="Advising-Functions.html#Advising-Functions" rel="prev" title="Advising Functions">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="Simple-Advice"></a>
<div class="header">
<p>
Next: <a href="Defining-Advice.html#Defining-Advice" accesskey="n" rel="next">Defining Advice</a>, Up: <a href="Advising-Functions.html#Advising-Functions" accesskey="u" rel="up">Advising Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="A-Simple-Advice-Example"></a>
<h3 class="section">17.1 A Simple Advice Example</h3>

<p>The command <code>next-line</code> moves point down vertically one or more
lines; it is the standard binding of <kbd>C-n</kbd>.  When used on the last
line of the buffer, this command inserts a newline to create a line to
move to if <code>next-line-add-newlines</code> is non-<code>nil</code> (its default
is <code>nil</code>.)
</p>
<p>Suppose you wanted to add a similar feature to <code>previous-line</code>,
which would insert a new line at the beginning of the buffer for the
command to move to (when <code>next-line-add-newlines</code> is
non-<code>nil</code>).  How could you do this?
</p>
<p>You could do it by redefining the whole function, but that is not
modular.  The advice feature provides a cleaner alternative: you can
effectively add your code to the existing function definition, without
actually changing or even seeing that definition.  Here is how to do
this:
</p>
<div class="example">
<pre class="example">(defadvice previous-line (before next-line-at-end
                                 (&amp;optional arg try-vscroll))
  &quot;Insert an empty line when moving up from the top line.&quot;
  (if (and next-line-add-newlines (= arg 1)
           (save-excursion (beginning-of-line) (bobp)))
      (progn
        (beginning-of-line)
        (newline))))
</pre></div>

<p>This expression defines a <em>piece of advice</em> for the function
<code>previous-line</code>.  This piece of advice is named
<code>next-line-at-end</code>, and the symbol <code>before</code> says that it is
<em>before-advice</em> which should run before the regular definition of
<code>previous-line</code>.  <code>(&amp;optional arg try-vscroll)</code> specifies
how the advice code can refer to the function&rsquo;s arguments.
</p>
<p>When this piece of advice runs, it creates an additional line, in the
situation where that is appropriate, but does not move point to that
line.  This is the correct way to write the advice, because the normal
definition will run afterward and will move back to the newly inserted
line.
</p>
<p>Defining the advice doesn&rsquo;t immediately change the function
<code>previous-line</code>.  That happens when you <em>activate</em> the advice,
like this:
</p>
<div class="example">
<pre class="example">(ad-activate 'previous-line)
</pre></div>

<p>This is what actually begins to use the advice that has been defined so
far for the function <code>previous-line</code>.  Henceforth, whenever that
function is run, whether invoked by the user with <kbd>C-p</kbd> or
<kbd>M-x</kbd>, or called from Lisp, it runs the advice first, and its
regular definition second.
</p>
<p>This example illustrates before-advice, which is one <em>class</em> of
advice: it runs before the function&rsquo;s base definition.  There are two
other advice classes: <em>after-advice</em>, which runs after the base
definition, and <em>around-advice</em>, which lets you specify an
expression to wrap around the invocation of the base definition.
</p>
<hr>
<div class="header">
<p>
Next: <a href="Defining-Advice.html#Defining-Advice" accesskey="n" rel="next">Defining Advice</a>, Up: <a href="Advising-Functions.html#Advising-Functions" accesskey="u" rel="up">Advising Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
