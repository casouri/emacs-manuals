<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 30.1.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Database (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Database (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Database (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Text.html" rel="up" title="Text">
<link href="Parsing-HTML_002fXML.html" rel="next" title="Parsing HTML/XML">
<link href="GnuTLS-Cryptography.html" rel="prev" title="GnuTLS Cryptography">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Database">
<div class="nav-panel">
<p>
Next: <a href="Parsing-HTML_002fXML.html" accesskey="n" rel="next">Parsing HTML and XML</a>, Previous: <a href="GnuTLS-Cryptography.html" accesskey="p" rel="prev">GnuTLS Cryptography</a>, Up: <a href="Text.html" accesskey="u" rel="up">Text</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Database-1"><span>33.29 Database<a class="copiable-link" href="#Database-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-database-access_002c-SQLite"></a>

<p>Emacs can be compiled with built-in support for accessing SQLite
databases.  This section describes the facilities available for
accessing SQLite databases from Lisp programs.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002davailable_002dp"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-available-p</strong><a class="copiable-link" href="#index-sqlite_002davailable_002dp"> &para;</a></span></dt>
<dd><p>The function returns non-<code class="code">nil</code> if built-in SQLite support is
available in this Emacs session.
</p></dd></dl>

<p>When SQLite support is available, the following functions can be used.
</p>
<a class="index-entry-id" id="index-database-object"></a>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dopen"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-open</strong> <var class="def-var-arguments">&amp;optional file</var><a class="copiable-link" href="#index-sqlite_002dopen"> &para;</a></span></dt>
<dd><p>This function opens <var class="var">file</var> as an SQLite database file.  If
<var class="var">file</var> doesn&rsquo;t exist, a new database will be created and stored in
that file.  If <var class="var">file</var> is omitted or <code class="code">nil</code>, a new in-memory
database is created instead.
</p>
<p>The return value is a <em class="dfn">database object</em> that can be used as the
argument to most of the subsequent functions described below.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlitep"><span class="category-def">Function: </span><span><strong class="def-name">sqlitep</strong> <var class="def-var-arguments">object</var><a class="copiable-link" href="#index-sqlitep"> &para;</a></span></dt>
<dd><p>This predicate returns non-<code class="code">nil</code> if <var class="var">object</var> is an SQLite
database object.  The database object returned by the
<code class="code">sqlite-open</code> function satisfies this predicate.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dclose"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-close</strong> <var class="def-var-arguments">db</var><a class="copiable-link" href="#index-sqlite_002dclose"> &para;</a></span></dt>
<dd><p>Close the database <var class="var">db</var>.  It&rsquo;s usually not necessary to call this
function explicitly&mdash;the database will automatically be closed if
Emacs shuts down or the database object is garbage collected.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dexecute"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-execute</strong> <var class="def-var-arguments">db statement &amp;optional values</var><a class="copiable-link" href="#index-sqlite_002dexecute"> &para;</a></span></dt>
<dd><p>Execute the <abbr class="acronym">SQL</abbr> <var class="var">statement</var>.  For instance:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(sqlite-execute db &quot;insert into foo values ('bar', 2)&quot;)
</pre></div>

<p>If the optional <var class="var">values</var> parameter is present, it should be either
a list or a vector of values to bind while executing the statement.
For instance:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(sqlite-execute db &quot;insert into foo values (?, ?)&quot; '(&quot;bar&quot; 2))
</pre></div>

<p>This has exactly the same effect as the previous example, but is more
efficient and safer (because it doesn&rsquo;t involve any string parsing or
interpolation).
</p>
<p><code class="code">sqlite-execute</code> usually returns the number of affected rows.
For instance, an &lsquo;<samp class="samp">insert</samp>&rsquo; statement will typically return
&lsquo;<samp class="samp">1</samp>&rsquo;, whereas an &lsquo;<samp class="samp">update</samp>&rsquo; statement may return zero or a
higher number.  However, when using <abbr class="acronym">SQL</abbr> statements like
&lsquo;<samp class="samp">insert&nbsp;into&nbsp;&hellip;&nbsp;returning&nbsp;&hellip;</samp>&rsquo;<!-- /@w --> and the like, the values
specified by &lsquo;<samp class="samp">returning&nbsp;&hellip;</samp>&rsquo;<!-- /@w --> will be returned instead.
</p>
<p>Strings in SQLite are, by default, stored as <code class="code">utf-8</code>, and
selecting a text column will decode the string using that charset.
Selecting a blob column will return the raw data without any decoding
(i.e., it will return a unibyte string containing the bytes as stored
in the database).  Inserting binary data into blob columns, however,
requires some care, as <code class="code">sqlite-execute</code> will, by default,
interpret all strings as <code class="code">utf-8</code>.
</p>
<p>So if you have, for instance, <abbr class="acronym">GIF</abbr> data in a unibyte string
called <var class="var">gif</var>, you have to mark it specially to let
<code class="code">sqlite-execute</code> know this:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(put-text-property 0 1 'coding-system 'binary gif)
(sqlite-execute db &quot;insert into foo values (?, ?)&quot; (list gif 2))
</pre></div>

</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dexecute_002dbatch"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-execute-batch</strong> <var class="def-var-arguments">db statements</var><a class="copiable-link" href="#index-sqlite_002dexecute_002dbatch"> &para;</a></span></dt>
<dd><p>Execute the <abbr class="acronym">SQL</abbr> <var class="var">statements</var>.  <var class="var">statements</var> is a
string containing 0 or more <abbr class="acronym">SQL</abbr> statements.  This command
might be useful when a Lisp program needs to execute multiple Data
Definition Language (<abbr class="acronym">DDL</abbr>) statements in one go.
</p>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dselect"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-select</strong> <var class="def-var-arguments">db query &amp;optional values return-type</var><a class="copiable-link" href="#index-sqlite_002dselect"> &para;</a></span></dt>
<dd><p>Select some data from <var class="var">db</var> and return them.  For instance:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(sqlite-select db &quot;select * from foo where key = 2&quot;)
  &rArr; ((&quot;bar&quot; 2))
</pre></div>

<p>As with the <code class="code">sqlite-execute</code>, you can optionally pass in a list
or a vector of values that will be bound before executing the select:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(sqlite-select db &quot;select * from foo where key = ?&quot; [2])
  &rArr; ((&quot;bar&quot; 2))
</pre></div>

<p>This is usually more efficient and safer than the method used by the
previous example.
</p>
<p>By default, this function returns a list of matching rows, where each
row is a list of column values.  If <var class="var">return-type</var> is <code class="code">full</code>,
the names of the columns (as a list of strings) will be returned as
the first element in the return value.
</p>
<a class="index-entry-id" id="index-statement-object"></a>
<p>If <var class="var">return-type</var> is <code class="code">set</code>, this function will return a
<em class="dfn">statement object</em> instead.  This object can be examined by using
the <code class="code">sqlite-next</code>, <code class="code">sqlite-columns</code> and <code class="code">sqlite-more-p</code>
functions.  If the result set is small, it&rsquo;s often more convenient to
just return the data directly, but if the result set is large (or if
you won&rsquo;t be using all the data from the set), using the <code class="code">set</code>
method will allocate a lot less memory, and is therefore more
memory-efficient.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dnext"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-next</strong> <var class="def-var-arguments">statement</var><a class="copiable-link" href="#index-sqlite_002dnext"> &para;</a></span></dt>
<dd><p>This function returns the next row in the result set <var class="var">statement</var>,
typically an object returned by <code class="code">sqlite-select</code>.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(sqlite-next stmt)
    &rArr; (&quot;bar&quot; 2)
</pre></div>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dcolumns"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-columns</strong> <var class="def-var-arguments">statement</var><a class="copiable-link" href="#index-sqlite_002dcolumns"> &para;</a></span></dt>
<dd><p>This function returns the column names of the result set
<var class="var">statement</var>, typically an object returned by <code class="code">sqlite-select</code>.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(sqlite-columns stmt)
    &rArr; (&quot;name&quot; &quot;issue&quot;)
</pre></div>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dmore_002dp"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-more-p</strong> <var class="def-var-arguments">statement</var><a class="copiable-link" href="#index-sqlite_002dmore_002dp"> &para;</a></span></dt>
<dd><p>This predicate says whether there is more data to be fetched from the
result set <var class="var">statement</var>, typically an object returned by
<code class="code">sqlite-select</code>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dfinalize"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-finalize</strong> <var class="def-var-arguments">statement</var><a class="copiable-link" href="#index-sqlite_002dfinalize"> &para;</a></span></dt>
<dd><p>If <var class="var">statement</var> is not going to be used any more, calling this
function will free the resources used by <var class="var">statement</var>.  This is
usually not necessary&mdash;when the <var class="var">statement</var> object is
garbage-collected, Emacs will automatically free its resources.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dtransaction"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-transaction</strong> <var class="def-var-arguments">db</var><a class="copiable-link" href="#index-sqlite_002dtransaction"> &para;</a></span></dt>
<dd><p>Start a transaction in <var class="var">db</var>.  When in a transaction, other readers
of the database won&rsquo;t access the results until the transaction has
been committed by <code class="code">sqlite-commit</code>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dcommit"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-commit</strong> <var class="def-var-arguments">db</var><a class="copiable-link" href="#index-sqlite_002dcommit"> &para;</a></span></dt>
<dd><p>End a transaction in <var class="var">db</var> and write the data out to its file.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002drollback"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-rollback</strong> <var class="def-var-arguments">db</var><a class="copiable-link" href="#index-sqlite_002drollback"> &para;</a></span></dt>
<dd><p>End a transaction in <var class="var">db</var> and discard any changes that have been
made by the transaction.
</p></dd></dl>

<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-with_002dsqlite_002dtransaction"><span class="category-def">Macro: </span><span><strong class="def-name">with-sqlite-transaction</strong> <var class="def-var-arguments">db body&hellip;</var><a class="copiable-link" href="#index-with_002dsqlite_002dtransaction"> &para;</a></span></dt>
<dd><p>Like <code class="code">progn</code> (see <a class="pxref" href="Sequencing.html">Sequencing</a>), but executes <var class="var">body</var> with a
transaction held, and commits the transaction at the end if <var class="var">body</var>
completes normally.  If <var class="var">body</var> signals an error, or committing the
transaction fails, the changes in <var class="var">db</var> performed by <var class="var">body</var> are
rolled back.  The macro returns the value of <var class="var">body</var> if it
completes normally and commit succeeds.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dpragma"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-pragma</strong> <var class="def-var-arguments">db pragma</var><a class="copiable-link" href="#index-sqlite_002dpragma"> &para;</a></span></dt>
<dd><p>Execute <var class="var">pragma</var> in <var class="var">db</var>.  A <em class="dfn">pragma</em> is usually a command
that affects the database overall, instead of any particular table.
For instance, to make SQLite automatically garbage collect data that&rsquo;s
no longer needed, you can say:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(sqlite-pragma db &quot;auto_vacuum = FULL&quot;)
</pre></div>

<p>This function returns non-<code class="code">nil</code> on success and <code class="code">nil</code> if the
pragma failed.  Many pragmas can only be issued when the database is
brand new and empty.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dload_002dextension"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-load-extension</strong> <var class="def-var-arguments">db module</var><a class="copiable-link" href="#index-sqlite_002dload_002dextension"> &para;</a></span></dt>
<dd><p>Load the named extension <var class="var">module</var> into the database <var class="var">db</var>.
Extensions are usually shared-library files; on GNU and Unix systems,
they have the <samp class="file">.so</samp> file-name extension.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-sqlite_002dversion"><span class="category-def">Function: </span><span><strong class="def-name">sqlite-version</strong><a class="copiable-link" href="#index-sqlite_002dversion"> &para;</a></span></dt>
<dd><p>Return a string denoting the version of the SQLite library in use.
</p></dd></dl>

<a class="index-entry-id" id="index-sqlite_002dmode_002dopen_002dfile"></a>
<p>If you wish to list the contents of an SQLite file, you can use the
<code class="code">sqlite-mode-open-file</code> command.  This will pop to a buffer using
<code class="code">sqlite-mode</code>, which allows you to examine (and alter) the
contents of an SQLite database.
</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Parsing-HTML_002fXML.html">Parsing HTML and XML</a>, Previous: <a href="GnuTLS-Cryptography.html">GnuTLS Cryptography</a>, Up: <a href="Text.html">Text</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
