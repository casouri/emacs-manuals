<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 26.3.

Copyright Â© 1990-1996, 1998-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Autoload (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Autoload (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Autoload (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Loading.html" rel="up" title="Loading">
<link href="Repeated-Loading.html" rel="next" title="Repeated Loading">
<link href="Loading-Non_002dASCII.html" rel="prev" title="Loading Non-ASCII">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Autoload">
<div class="nav-panel">
<p>
Next: <a href="Repeated-Loading.html" accesskey="n" rel="next">Repeated Loading</a>, Previous: <a href="Loading-Non_002dASCII.html" accesskey="p" rel="prev">Loading Non-<abbr class="acronym">ASCII</abbr> Characters</a>, Up: <a href="Loading.html" accesskey="u" rel="up">Loading</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Autoload-1"><span>16.5 Autoload<a class="copiable-link" href="#Autoload-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-autoload"></a>

<p>The <em class="dfn">autoload</em> facility lets you register the existence of a
function or macro, but put off loading the file that defines it.  The
first call to the function automatically loads the proper library, in
order to install the real definition and other associated code, then
runs the real definition as if it had been loaded all along.
Autoloading can also be triggered by looking up the documentation of
the function or macro (see <a class="pxref" href="Documentation-Basics.html">Documentation Basics</a>), and completion
of variable and function names (see <a class="pxref" href="Autoload-by-Prefix.html">Autoload by Prefix</a> below).
</p>

<p>There are two ways to set up an autoloaded function: by calling
<code class="code">autoload</code>, and by writing a &ldquo;magic&rdquo; comment in the
source before the real definition.  <code class="code">autoload</code> is the low-level
primitive for autoloading; any Lisp program can call <code class="code">autoload</code> at
any time.  Magic comments are the most convenient way to make a function
autoload, for packages installed along with Emacs.  These comments do
nothing on their own, but they serve as a guide for the command
<code class="code">update-file-autoloads</code>, which constructs calls to <code class="code">autoload</code>
and arranges to execute them when Emacs is built.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-autoload-1"><span class="category-def">Function: </span><span><strong class="def-name">autoload</strong> <var class="def-var-arguments">function filename &amp;optional docstring interactive type</var><a class="copiable-link" href="#index-autoload-1"> &para;</a></span></dt>
<dd><p>This function defines the function (or macro) named <var class="var">function</var> so as
to load automatically from <var class="var">filename</var>.  The string <var class="var">filename</var>
specifies the file to load to get the real definition of <var class="var">function</var>.
</p>
<p>If <var class="var">filename</var> does not contain either a directory name, or the
suffix <code class="code">.el</code> or <code class="code">.elc</code>, this function insists on adding one
of these suffixes, and it will not load from a file whose name is just
<var class="var">filename</var> with no added suffix.  (The variable
<code class="code">load-suffixes</code> specifies the exact required suffixes.)
</p>
<p>The argument <var class="var">docstring</var> is the documentation string for the
function.  Specifying the documentation string in the call to
<code class="code">autoload</code> makes it possible to look at the documentation without
loading the function&rsquo;s real definition.  Normally, this should be
identical to the documentation string in the function definition
itself.  If it isn&rsquo;t, the function definition&rsquo;s documentation string
takes effect when it is loaded.
</p>
<p>If <var class="var">interactive</var> is non-<code class="code">nil</code>, that says <var class="var">function</var> can be
called interactively.  This lets completion in <kbd class="kbd">M-x</kbd> work without
loading <var class="var">function</var>&rsquo;s real definition.  The complete interactive
specification is not given here; it&rsquo;s not needed unless the user
actually calls <var class="var">function</var>, and when that happens, it&rsquo;s time to load
the real definition.
</p>
<p>You can autoload macros and keymaps as well as ordinary functions.
Specify <var class="var">type</var> as <code class="code">macro</code> if <var class="var">function</var> is really a macro.
Specify <var class="var">type</var> as <code class="code">keymap</code> if <var class="var">function</var> is really a
keymap.  Various parts of Emacs need to know this information without
loading the real definition.
</p>
<p>An autoloaded keymap loads automatically during key lookup when a prefix
key&rsquo;s binding is the symbol <var class="var">function</var>.  Autoloading does not occur
for other kinds of access to the keymap.  In particular, it does not
happen when a Lisp program gets the keymap from the value of a variable
and calls <code class="code">define-key</code>; not even if the variable name is the same
symbol <var class="var">function</var>.
</p>
<a class="index-entry-id" id="index-function-cell-in-autoload"></a>
<p>If <var class="var">function</var> already has a non-void function definition that is not
an autoload object, this function does nothing and returns <code class="code">nil</code>.
Otherwise, it constructs an autoload object (see <a class="pxref" href="Autoload-Type.html">Autoload Type</a>),
and stores it as the function definition for <var class="var">function</var>.  The
autoload object has this form:
</p>
<div class="example">
<pre class="example-preformatted">(autoload <var class="var">filename</var> <var class="var">docstring</var> <var class="var">interactive</var> <var class="var">type</var>)
</pre></div>

<p>For example,
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(symbol-function 'run-prolog)
     &rArr; (autoload &quot;prolog&quot; 169681 t nil)
</pre></div></div>

<p>In this case, <code class="code">&quot;prolog&quot;</code> is the name of the file to load, 169681
refers to the documentation string in the
<samp class="file">emacs/etc/DOC</samp> file (see <a class="pxref" href="Documentation-Basics.html">Documentation Basics</a>),
<code class="code">t</code> means the function is interactive, and <code class="code">nil</code> that it is
not a macro or a keymap.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-autoloadp"><span class="category-def">Function: </span><span><strong class="def-name">autoloadp</strong> <var class="def-var-arguments">object</var><a class="copiable-link" href="#index-autoloadp"> &para;</a></span></dt>
<dd><p>This function returns non-<code class="code">nil</code> if <var class="var">object</var> is an autoload
object.  For example, to check if <code class="code">run-prolog</code> is defined as an
autoloaded function, evaluate
</p>
<div class="example smallexample">
<pre class="example-preformatted">(autoloadp (symbol-function 'run-prolog))
</pre></div>
</dd></dl>

<a class="index-entry-id" id="index-autoload-errors"></a>
<p>The autoloaded file usually contains other definitions and may require
or provide one or more features.  If the file is not completely loaded
(due to an error in the evaluation of its contents), any function
definitions or <code class="code">provide</code> calls that occurred during the load are
undone.  This is to ensure that the next attempt to call any function
autoloading from this file will try again to load the file.  If not for
this, then some of the functions in the file might be defined by the
aborted load, but fail to work properly for the lack of certain
subroutines not loaded successfully because they come later in the file.
</p>
<p>If the autoloaded file fails to define the desired Lisp function or
macro, then an error is signaled with data <code class="code">&quot;Autoloading failed to
define function <var class="var">function-name</var>&quot;</code>.
</p>
<a class="index-entry-id" id="index-update_002dfile_002dautoloads"></a>
<a class="index-entry-id" id="index-update_002ddirectory_002dautoloads"></a>
<a class="index-entry-id" id="index-magic-autoload-comment"></a>
<a class="index-entry-id" id="index-autoload-cookie"></a>
<a class="anchor" id="autoload-cookie"></a><p>A magic autoload comment (often called an <em class="dfn">autoload cookie</em>)
consists of &lsquo;<samp class="samp">;;;###autoload</samp>&rsquo;, on a line by itself,
just before the real definition of the function in its
autoloadable source file.  The command <kbd class="kbd">M-x update-file-autoloads</kbd>
writes a corresponding <code class="code">autoload</code> call into <samp class="file">loaddefs.el</samp>.
(The string that serves as the autoload cookie and the name of the
file generated by <code class="code">update-file-autoloads</code> can be changed from the
above defaults, see below.)
Building Emacs loads <samp class="file">loaddefs.el</samp> and thus calls <code class="code">autoload</code>.
<kbd class="kbd">M-x update-directory-autoloads</kbd> is even more powerful; it updates
autoloads for all files in the current directory.
</p>
<p>The same magic comment can copy any kind of form into
<samp class="file">loaddefs.el</samp>.  The form following the magic comment is copied
verbatim, <em class="emph">except</em> if it is one of the forms which the autoload
facility handles specially (e.g., by conversion into an
<code class="code">autoload</code> call).  The forms which are not copied verbatim are
the following:
</p>
<dl class="table">
<dt>Definitions for function or function-like objects:</dt>
<dd><p><code class="code">defun</code> and <code class="code">defmacro</code>; also <code class="code">cl-defun</code> and
<code class="code">cl-defmacro</code> (see <a data-manual="cl" href="https://www.gnu.org/software/emacs/manual/html_node/cl/Argument-Lists.html#Argument-Lists">Argument Lists</a> in <cite class="cite">Common Lisp Extensions</cite>),
and <code class="code">define-overloadable-function</code> (see the commentary in
<samp class="file">mode-local.el</samp>).
</p>
</dd>
<dt>Definitions for major or minor modes:</dt>
<dd><p><code class="code">define-minor-mode</code>, <code class="code">define-globalized-minor-mode</code>,
<code class="code">define-generic-mode</code>, <code class="code">define-derived-mode</code>,
<code class="code">easy-mmode-define-minor-mode</code>,
<code class="code">easy-mmode-define-global-mode</code>, <code class="code">define-compilation-mode</code>,
and <code class="code">define-global-minor-mode</code>.
</p>
</dd>
<dt>Other definition types:</dt>
<dd><p><code class="code">defcustom</code>, <code class="code">defgroup</code>, <code class="code">defclass</code>
(see <a data-manual="eieio" href="https://www.gnu.org/software/emacs/manual/html_node/eieio/index.html#Top">EIEIO</a> in <cite class="cite">EIEIO</cite>), and <code class="code">define-skeleton</code>
(see <a data-manual="autotype" href="https://www.gnu.org/software/emacs/manual/html_node/autotype/index.html#Top">Autotyping</a> in <cite class="cite">Autotyping</cite>).
</p></dd>
</dl>

<p>You can also use a magic comment to execute a form at build time
<em class="emph">without</em> executing it when the file itself is loaded.  To do this,
write the form <em class="emph">on the same line</em> as the magic comment.  Since it
is in a comment, it does nothing when you load the source file; but
<kbd class="kbd">M-x update-file-autoloads</kbd> copies it to <samp class="file">loaddefs.el</samp>, where
it is executed while building Emacs.
</p>
<p>The following example shows how <code class="code">doctor</code> is prepared for
autoloading with a magic comment:
</p>
<div class="example">
<pre class="example-preformatted">;;;###autoload
(defun doctor ()
  &quot;Switch to *doctor* buffer and start giving psychotherapy.&quot;
  (interactive)
  (switch-to-buffer &quot;*doctor*&quot;)
  (doctor-mode))
</pre></div>

<p>Here&rsquo;s what that produces in <samp class="file">loaddefs.el</samp>:
</p>
<div class="example">
<pre class="example-preformatted">(autoload (quote doctor) &quot;doctor&quot; &quot;\
Switch to *doctor* buffer and start giving psychotherapy.

\(fn)&quot; t nil)
</pre></div>

<a class="index-entry-id" id="index-fn-in-function_0027s-documentation-string"></a>
<p>The backslash and newline immediately following the double-quote are a
convention used only in the preloaded uncompiled Lisp files such as
<samp class="file">loaddefs.el</samp>; they tell <code class="code">make-docfile</code> to put the
documentation string in the <samp class="file">etc/DOC</samp> file.  See <a class="xref" href="Building-Emacs.html">Building Emacs</a>.
See also the commentary in <samp class="file">lib-src/make-docfile.c</samp>.  &lsquo;<samp class="samp">(fn)</samp>&rsquo;
in the usage part of the documentation string is replaced with the
function&rsquo;s name when the various help functions (see <a class="pxref" href="Help-Functions.html">Help Functions</a>) display it.
</p>
<p>If you write a function definition with an unusual macro that is not
one of the known and recognized function definition methods, use of an
ordinary magic autoload comment would copy the whole definition into
<code class="code">loaddefs.el</code>.  That is not desirable.  You can put the desired
<code class="code">autoload</code> call into <code class="code">loaddefs.el</code> instead by writing this:
</p>
<div class="example">
<pre class="example-preformatted">;;;###autoload (autoload 'foo &quot;myfile&quot;)
(mydefunmacro foo
  ...)
</pre></div>

<p>You can use a non-default string as the autoload cookie and have the
corresponding autoload calls written into a file whose name is
different from the default <samp class="file">loaddefs.el</samp>.  Emacs provides two
variables to control this:
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-generate_002dautoload_002dcookie"><span class="category-def">Variable: </span><span><strong class="def-name">generate-autoload-cookie</strong><a class="copiable-link" href="#index-generate_002dautoload_002dcookie"> &para;</a></span></dt>
<dd><p>The value of this variable should be a string whose syntax is a Lisp
comment.  <kbd class="kbd">M-x update-file-autoloads</kbd> copies the Lisp form that
follows the cookie into the autoload file it generates.  The default
value of this variable is <code class="code">&quot;;;;###autoload&quot;</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-generated_002dautoload_002dfile"><span class="category-def">Variable: </span><span><strong class="def-name">generated-autoload-file</strong><a class="copiable-link" href="#index-generated_002dautoload_002dfile"> &para;</a></span></dt>
<dd><p>The value of this variable names an Emacs Lisp file where the autoload
calls should go.  The default value is <samp class="file">loaddefs.el</samp>, but you can
override that, e.g., in the local variables section of a
<samp class="file">.el</samp> file (see <a class="pxref" href="File-Local-Variables.html">File Local Variables</a>).  The autoload file is
assumed to contain a trailer starting with a formfeed character.
</p></dd></dl>

<p>The following function may be used to explicitly load the library
specified by an autoload object:
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-autoload_002ddo_002dload"><span class="category-def">Function: </span><span><strong class="def-name">autoload-do-load</strong> <var class="def-var-arguments">autoload &amp;optional name macro-only</var><a class="copiable-link" href="#index-autoload_002ddo_002dload"> &para;</a></span></dt>
<dd><p>This function performs the loading specified by <var class="var">autoload</var>, which
should be an autoload object.  The optional argument <var class="var">name</var>, if
non-<code class="code">nil</code>, should be a symbol whose function value is
<var class="var">autoload</var>; in that case, the return value of this function is the
symbol&rsquo;s new function value.  If the value of the optional argument
<var class="var">macro-only</var> is <code class="code">macro</code>, this function avoids loading a
function, only a macro.
</p></dd></dl>

<ul class="mini-toc">
<li><a href="Autoload-by-Prefix.html" accesskey="1">Autoload by Prefix</a></li>
<li><a href="When-to-Autoload.html" accesskey="2">When to Use Autoload</a></li>
</ul>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Repeated-Loading.html">Repeated Loading</a>, Previous: <a href="Loading-Non_002dASCII.html">Loading Non-<abbr class="acronym">ASCII</abbr> Characters</a>, Up: <a href="Loading.html">Loading</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
