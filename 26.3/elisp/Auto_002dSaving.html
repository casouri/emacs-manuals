<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 26.3.

Copyright Â© 1990-1996, 1998-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Auto-Saving (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Auto-Saving (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Auto-Saving (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Backups-and-Auto_002dSaving.html" rel="up" title="Backups and Auto-Saving">
<link href="Reverting.html" rel="next" title="Reverting">
<link href="Backup-Files.html" rel="prev" title="Backup Files">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Auto_002dSaving">
<div class="nav-panel">
<p>
Next: <a href="Reverting.html" accesskey="n" rel="next">Reverting</a>, Previous: <a href="Backup-Files.html" accesskey="p" rel="prev">Backup Files</a>, Up: <a href="Backups-and-Auto_002dSaving.html" accesskey="u" rel="up">Backups and Auto-Saving</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Auto_002dSaving-1"><span>26.2 Auto-Saving<a class="copiable-link" href="#Auto_002dSaving-1"> &para;</a></span></h3>

<p>Emacs periodically saves all files that you are visiting; this is
called <em class="dfn">auto-saving</em>.  Auto-saving prevents you from losing more
than a limited amount of work if the system crashes.  By default,
auto-saves happen every 300 keystrokes, or after around 30 seconds of
idle time.  See <a data-manual="emacs" href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Auto-Save.html#Auto-Save">Auto-Saving: Protection Against
Disasters</a> in <cite class="cite">The GNU Emacs Manual</cite>, for information on auto-save
for users.  Here we describe the functions used to implement auto-saving
and the variables that control them.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-buffer_002dauto_002dsave_002dfile_002dname"><span class="category-def">Variable: </span><span><strong class="def-name">buffer-auto-save-file-name</strong><a class="copiable-link" href="#index-buffer_002dauto_002dsave_002dfile_002dname"> &para;</a></span></dt>
<dd><p>This buffer-local variable is the name of the file used for
auto-saving the current buffer.  It is <code class="code">nil</code> if the buffer
should not be auto-saved.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">buffer-auto-save-file-name
     &rArr; &quot;/xcssun/users/rms/lewis/#backups.texi#&quot;
</pre></div></div>
</dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-auto_002dsave_002dmode"><span class="category-def">Command: </span><span><strong class="def-name">auto-save-mode</strong> <var class="def-var-arguments">arg</var><a class="copiable-link" href="#index-auto_002dsave_002dmode"> &para;</a></span></dt>
<dd><p>This is the mode command for Auto Save mode, a buffer-local minor
mode.  When Auto Save mode is enabled, auto-saving is enabled in the
buffer.  The calling convention is the same as for other minor mode
commands (see <a class="pxref" href="Minor-Mode-Conventions.html">Conventions for Writing Minor Modes</a>).
</p>
<p>Unlike most minor modes, there is no <code class="code">auto-save-mode</code> variable.
Auto Save mode is enabled if <code class="code">buffer-auto-save-file-name</code> is
non-<code class="code">nil</code> and <code class="code">buffer-saved-size</code> (see below) is non-zero.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-auto_002dsave_002dfile_002dname_002dp"><span class="category-def">Function: </span><span><strong class="def-name">auto-save-file-name-p</strong> <var class="def-var-arguments">filename</var><a class="copiable-link" href="#index-auto_002dsave_002dfile_002dname_002dp"> &para;</a></span></dt>
<dd><p>This function returns a non-<code class="code">nil</code> value if <var class="var">filename</var> is a
string that could be the name of an auto-save file.  It assumes
the usual naming convention for auto-save files: a name that
begins and ends with hash marks (&lsquo;<samp class="samp">#</samp>&rsquo;) is a possible auto-save file
name.  The argument <var class="var">filename</var> should not contain a directory part.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(make-auto-save-file-name)
     &rArr; &quot;/xcssun/users/rms/lewis/#backups.texi#&quot;
</pre></div><div class="group"><pre class="example-preformatted">(auto-save-file-name-p &quot;#backups.texi#&quot;)
     &rArr; 0
</pre></div><div class="group"><pre class="example-preformatted">(auto-save-file-name-p &quot;backups.texi&quot;)
     &rArr; nil
</pre></div></div>

<p>The standard definition of this function is as follows:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(defun auto-save-file-name-p (filename)
  &quot;Return non-nil if FILENAME can be yielded by...&quot;
  (string-match &quot;^#.*#$&quot; filename))
</pre></div></div>

<p>This function exists so that you can customize it if you wish to
change the naming convention for auto-save files.  If you redefine it,
be sure to redefine the function <code class="code">make-auto-save-file-name</code>
correspondingly.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-make_002dauto_002dsave_002dfile_002dname"><span class="category-def">Function: </span><span><strong class="def-name">make-auto-save-file-name</strong><a class="copiable-link" href="#index-make_002dauto_002dsave_002dfile_002dname"> &para;</a></span></dt>
<dd><p>This function returns the file name to use for auto-saving the current
buffer.  This is just the file name with hash marks (&lsquo;<samp class="samp">#</samp>&rsquo;) prepended
and appended to it.  This function does not look at the variable
<code class="code">auto-save-visited-file-name</code> (described below); callers of this
function should check that variable first.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(make-auto-save-file-name)
     &rArr; &quot;/xcssun/users/rms/lewis/#backups.texi#&quot;
</pre></div></div>

<p>Here is a simplified version of the standard definition of this
function:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(defun make-auto-save-file-name ()
  &quot;Return file name to use for auto-saves \
of current buffer..&quot;
  (if buffer-file-name
</pre></div><div class="group"><pre class="example-preformatted">      (concat
       (file-name-directory buffer-file-name)
       &quot;#&quot;
       (file-name-nondirectory buffer-file-name)
       &quot;#&quot;)
    (expand-file-name
     (concat &quot;#%&quot; (buffer-name) &quot;#&quot;))))
</pre></div></div>

<p>This exists as a separate function so that you can redefine it to
customize the naming convention for auto-save files.  Be sure to
change <code class="code">auto-save-file-name-p</code> in a corresponding way.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-auto_002dsave_002dvisited_002dfile_002dname"><span class="category-def">User Option: </span><span><strong class="def-name">auto-save-visited-file-name</strong><a class="copiable-link" href="#index-auto_002dsave_002dvisited_002dfile_002dname"> &para;</a></span></dt>
<dd><p>If this variable is non-<code class="code">nil</code>, Emacs auto-saves buffers in
the files they are visiting.  That is, the auto-save is done in the same
file that you are editing.  Normally, this variable is <code class="code">nil</code>, so
auto-save files have distinct names that are created by
<code class="code">make-auto-save-file-name</code>.
</p>
<p>When you change the value of this variable, the new value does not take
effect in an existing buffer until the next time auto-save mode is
reenabled in it.  If auto-save mode is already enabled, auto-saves
continue to go in the same file name until <code class="code">auto-save-mode</code> is
called again.
</p>
<p>Note that setting this variable to a non-<code class="code">nil</code> value does not
change the fact that auto-saving is different from saving the buffer;
e.g., the hooks described in <a class="ref" href="Saving-Buffers.html">Saving Buffers</a> are <em class="emph">not</em> run
when a buffer is auto-saved.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-recent_002dauto_002dsave_002dp"><span class="category-def">Function: </span><span><strong class="def-name">recent-auto-save-p</strong><a class="copiable-link" href="#index-recent_002dauto_002dsave_002dp"> &para;</a></span></dt>
<dd><p>This function returns <code class="code">t</code> if the current buffer has been
auto-saved since the last time it was read in or saved.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-set_002dbuffer_002dauto_002dsaved"><span class="category-def">Function: </span><span><strong class="def-name">set-buffer-auto-saved</strong><a class="copiable-link" href="#index-set_002dbuffer_002dauto_002dsaved"> &para;</a></span></dt>
<dd><p>This function marks the current buffer as auto-saved.  The buffer will
not be auto-saved again until the buffer text is changed again.  The
function returns <code class="code">nil</code>.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-auto_002dsave_002dinterval"><span class="category-def">User Option: </span><span><strong class="def-name">auto-save-interval</strong><a class="copiable-link" href="#index-auto_002dsave_002dinterval"> &para;</a></span></dt>
<dd><p>The value of this variable specifies how often to do auto-saving, in
terms of number of input events.  Each time this many additional input
events are read, Emacs does auto-saving for all buffers in which that is
enabled.  Setting this to zero disables autosaving based on the
number of characters typed.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-auto_002dsave_002dtimeout"><span class="category-def">User Option: </span><span><strong class="def-name">auto-save-timeout</strong><a class="copiable-link" href="#index-auto_002dsave_002dtimeout"> &para;</a></span></dt>
<dd><p>The value of this variable is the number of seconds of idle time that
should cause auto-saving.  Each time the user pauses for this long,
Emacs does auto-saving for all buffers in which that is enabled.  (If
the current buffer is large, the specified timeout is multiplied by a
factor that increases as the size increases; for a million-byte
buffer, the factor is almost 4.)
</p>
<p>If the value is zero or <code class="code">nil</code>, then auto-saving is not done as a
result of idleness, only after a certain number of input events as
specified by <code class="code">auto-save-interval</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-auto_002dsave_002dhook"><span class="category-def">Variable: </span><span><strong class="def-name">auto-save-hook</strong><a class="copiable-link" href="#index-auto_002dsave_002dhook"> &para;</a></span></dt>
<dd><p>This normal hook is run whenever an auto-save is about to happen.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-auto_002dsave_002ddefault"><span class="category-def">User Option: </span><span><strong class="def-name">auto-save-default</strong><a class="copiable-link" href="#index-auto_002dsave_002ddefault"> &para;</a></span></dt>
<dd><p>If this variable is non-<code class="code">nil</code>, buffers that are visiting files
have auto-saving enabled by default.  Otherwise, they do not.
</p></dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-do_002dauto_002dsave"><span class="category-def">Command: </span><span><strong class="def-name">do-auto-save</strong> <var class="def-var-arguments">&amp;optional no-message current-only</var><a class="copiable-link" href="#index-do_002dauto_002dsave"> &para;</a></span></dt>
<dd><p>This function auto-saves all buffers that need to be auto-saved.  It
saves all buffers for which auto-saving is enabled and that have been
changed since the previous auto-save.
</p>
<p>If any buffers are auto-saved, <code class="code">do-auto-save</code> normally displays a
message saying &lsquo;<samp class="samp">Auto-saving...</samp>&rsquo; in the echo area while
auto-saving is going on.  However, if <var class="var">no-message</var> is
non-<code class="code">nil</code>, the message is inhibited.
</p>
<p>If <var class="var">current-only</var> is non-<code class="code">nil</code>, only the current buffer
is auto-saved.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-delete_002dauto_002dsave_002dfile_002dif_002dnecessary"><span class="category-def">Function: </span><span><strong class="def-name">delete-auto-save-file-if-necessary</strong> <var class="def-var-arguments">&amp;optional force</var><a class="copiable-link" href="#index-delete_002dauto_002dsave_002dfile_002dif_002dnecessary"> &para;</a></span></dt>
<dd><p>This function deletes the current buffer&rsquo;s auto-save file if
<code class="code">delete-auto-save-files</code> is non-<code class="code">nil</code>.  It is called every
time a buffer is saved.
</p>
<p>Unless <var class="var">force</var> is non-<code class="code">nil</code>, this function only deletes the
file if it was written by the current Emacs session since the last
true save.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-delete_002dauto_002dsave_002dfiles"><span class="category-def">User Option: </span><span><strong class="def-name">delete-auto-save-files</strong><a class="copiable-link" href="#index-delete_002dauto_002dsave_002dfiles"> &para;</a></span></dt>
<dd><p>This variable is used by the function
<code class="code">delete-auto-save-file-if-necessary</code>.  If it is non-<code class="code">nil</code>,
Emacs deletes auto-save files when a true save is done (in the visited
file).  This saves disk space and unclutters your directory.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-rename_002dauto_002dsave_002dfile"><span class="category-def">Function: </span><span><strong class="def-name">rename-auto-save-file</strong><a class="copiable-link" href="#index-rename_002dauto_002dsave_002dfile"> &para;</a></span></dt>
<dd><p>This function adjusts the current buffer&rsquo;s auto-save file name if the
visited file name has changed.  It also renames an existing auto-save
file, if it was made in the current Emacs session.  If the visited
file name has not changed, this function does nothing.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-buffer_002dsaved_002dsize"><span class="category-def">Variable: </span><span><strong class="def-name">buffer-saved-size</strong><a class="copiable-link" href="#index-buffer_002dsaved_002dsize"> &para;</a></span></dt>
<dd><p>The value of this buffer-local variable is the length of the current
buffer, when it was last read in, saved, or auto-saved.  This is
used to detect a substantial decrease in size, and turn off auto-saving
in response.
</p>
<p>If it is &minus;1, that means auto-saving is temporarily shut off in
this buffer due to a substantial decrease in size.  Explicitly saving
the buffer stores a positive value in this variable, thus reenabling
auto-saving.  Turning auto-save mode off or on also updates this
variable, so that the substantial decrease in size is forgotten.
</p>
<p>If it is &minus;2, that means this buffer should disregard changes in
buffer size; in particular, it should not shut off auto-saving
temporarily due to changes in buffer size.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-auto_002dsave_002dlist_002dfile_002dname"><span class="category-def">Variable: </span><span><strong class="def-name">auto-save-list-file-name</strong><a class="copiable-link" href="#index-auto_002dsave_002dlist_002dfile_002dname"> &para;</a></span></dt>
<dd><p>This variable (if non-<code class="code">nil</code>) specifies a file for recording the
names of all the auto-save files.  Each time Emacs does auto-saving, it
writes two lines into this file for each buffer that has auto-saving
enabled.  The first line gives the name of the visited file (it&rsquo;s empty
if the buffer has none), and the second gives the name of the auto-save
file.
</p>
<p>When Emacs exits normally, it deletes this file; if Emacs crashes, you
can look in the file to find all the auto-save files that might contain
work that was otherwise lost.  The <code class="code">recover-session</code> command uses
this file to find them.
</p>
<p>The default name for this file specifies your home directory and starts
with &lsquo;<samp class="samp">.saves-</samp>&rsquo;.  It also contains the Emacs process <abbr class="acronym">ID</abbr> and the
host name.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-auto_002dsave_002dlist_002dfile_002dprefix"><span class="category-def">User Option: </span><span><strong class="def-name">auto-save-list-file-prefix</strong><a class="copiable-link" href="#index-auto_002dsave_002dlist_002dfile_002dprefix"> &para;</a></span></dt>
<dd><p>After Emacs reads your init file, it initializes
<code class="code">auto-save-list-file-name</code> (if you have not already set it
non-<code class="code">nil</code>) based on this prefix, adding the host name and process
ID.  If you set this to <code class="code">nil</code> in your init file, then Emacs does
not initialize <code class="code">auto-save-list-file-name</code>.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Reverting.html">Reverting</a>, Previous: <a href="Backup-Files.html">Backup Files</a>, Up: <a href="Backups-and-Auto_002dSaving.html">Backups and Auto-Saving</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
