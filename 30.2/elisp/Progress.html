<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 30.2.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Progress (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Progress (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Progress (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="The-Echo-Area.html" rel="up" title="The Echo Area">
<link href="Logging-Messages.html" rel="next" title="Logging Messages">
<link href="Displaying-Messages.html" rel="prev" title="Displaying Messages">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Progress">
<div class="nav-panel">
<p>
Next: <a href="Logging-Messages.html" accesskey="n" rel="next">Logging Messages in <samp class="file">*Messages*</samp></a>, Previous: <a href="Displaying-Messages.html" accesskey="p" rel="prev">Displaying Messages in the Echo Area</a>, Up: <a href="The-Echo-Area.html" accesskey="u" rel="up">The Echo Area</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Reporting-Operation-Progress"><span>42.4.2 Reporting Operation Progress<a class="copiable-link" href="#Reporting-Operation-Progress"> &para;</a></span></h4>
<a class="index-entry-id" id="index-progress-reporting"></a>

<p>When an operation can take a while to finish, you should inform the
user about the progress it makes.  This way the user can estimate
remaining time and clearly see that Emacs is busy working, not hung.
A convenient way to do this is to use a <em class="dfn">progress reporter</em>.
</p>
<p>Here is a working example that does nothing useful:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(let ((progress-reporter
       (make-progress-reporter &quot;Collecting mana for Emacs...&quot;
                               0  500)))
  (dotimes (k 500)
    (sit-for 0.01)
    (progress-reporter-update progress-reporter k))
  (progress-reporter-done progress-reporter))
</pre></div>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-make_002dprogress_002dreporter"><span class="category-def">Function: </span><span><strong class="def-name">make-progress-reporter</strong> <var class="def-var-arguments">message &amp;optional min-value max-value current-value min-change min-time</var><a class="copiable-link" href="#index-make_002dprogress_002dreporter"> &para;</a></span></dt>
<dd><p>This function creates and returns a progress reporter object, which
you will use as an argument for the other functions listed below.  The
idea is to precompute as much data as possible to make progress
reporting very fast.
</p>
<p>When this progress reporter is subsequently used, it will display
<var class="var">message</var> in the echo area, followed by progress percentage.
<var class="var">message</var> is treated as a simple string.  If you need it to depend
on a filename, for instance, use <code class="code">format-message</code> before calling this
function.
</p>
<p>The arguments <var class="var">min-value</var> and <var class="var">max-value</var> should be numbers
standing for the starting and final states of the operation.  For
instance, an operation that scans a buffer should set these to the
results of <code class="code">point-min</code> and <code class="code">point-max</code> correspondingly.
<var class="var">max-value</var> should be greater than <var class="var">min-value</var>.
</p>
<p>Alternatively, you can set <var class="var">min-value</var> and <var class="var">max-value</var> to
<code class="code">nil</code>.  In that case, the progress reporter does not report
process percentages; it instead displays a &ldquo;spinner&rdquo; that rotates a
notch each time you update the progress reporter.
</p>
<p>If <var class="var">min-value</var> and <var class="var">max-value</var> are numbers, you can give the
argument <var class="var">current-value</var> a numerical value specifying the initial
progress; if omitted, this defaults to <var class="var">min-value</var>.
</p>
<p>The remaining arguments control the rate of echo area updates.  The
progress reporter will wait for at least <var class="var">min-change</var> more
percents of the operation to be completed before printing next
message; the default is one percent.  <var class="var">min-time</var> specifies the
minimum time in seconds to pass between successive prints; the default
is 0.2 seconds.  (On some operating systems, the progress reporter may
handle fractions of seconds with varying precision).
</p>
<p>This function calls <code class="code">progress-reporter-update</code>, so the first
message is printed immediately.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-progress_002dreporter_002dupdate"><span class="category-def">Function: </span><span><strong class="def-name">progress-reporter-update</strong> <var class="def-var-arguments">reporter &amp;optional value suffix</var><a class="copiable-link" href="#index-progress_002dreporter_002dupdate"> &para;</a></span></dt>
<dd><p>This function does the main work of reporting progress of your
operation.  It displays the message of <var class="var">reporter</var>, followed by
progress percentage determined by <var class="var">value</var>.  If percentage is zero,
or close enough according to the <var class="var">min-change</var> and <var class="var">min-time</var>
arguments, then it is omitted from the output.
</p>
<p><var class="var">reporter</var> must be the result of a call to
<code class="code">make-progress-reporter</code>.  <var class="var">value</var> specifies the current
state of your operation and must be between <var class="var">min-value</var> and
<var class="var">max-value</var> (inclusive) as passed to
<code class="code">make-progress-reporter</code>.  For instance, if you scan a buffer,
then <var class="var">value</var> should be the result of a call to <code class="code">point</code>.
</p>
<p>Optional argument <var class="var">suffix</var> is a string to be displayed after
<var class="var">reporter</var>&rsquo;s main message and progress text.  If <var class="var">reporter</var> is
a non-numerical reporter, then <var class="var">value</var> should be <code class="code">nil</code>, or a
string to use instead of <var class="var">suffix</var>.
</p>
<p>This function respects <var class="var">min-change</var> and <var class="var">min-time</var> as passed
to <code class="code">make-progress-reporter</code> and so does not output new messages
on every invocation.  It is thus very fast and normally you should not
try to reduce the number of calls to it: resulting overhead will most
likely negate your effort.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-progress_002dreporter_002dforce_002dupdate"><span class="category-def">Function: </span><span><strong class="def-name">progress-reporter-force-update</strong> <var class="def-var-arguments">reporter &amp;optional value new-message suffix</var><a class="copiable-link" href="#index-progress_002dreporter_002dforce_002dupdate"> &para;</a></span></dt>
<dd><p>This function is similar to <code class="code">progress-reporter-update</code> except
that it prints a message in the echo area unconditionally.
</p>
<p><var class="var">reporter</var>, <var class="var">value</var>, and <var class="var">suffix</var> have the same meaning as for
<code class="code">progress-reporter-update</code>.  Optional <var class="var">new-message</var> allows
you to change the message of the <var class="var">reporter</var>.  Since this function
always updates the echo area, such a change will be immediately
presented to the user.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-progress_002dreporter_002ddone"><span class="category-def">Function: </span><span><strong class="def-name">progress-reporter-done</strong> <var class="def-var-arguments">reporter</var><a class="copiable-link" href="#index-progress_002dreporter_002ddone"> &para;</a></span></dt>
<dd><p>This function should be called when the operation is finished.  It
prints the message of <var class="var">reporter</var> followed by word &lsquo;<samp class="samp">done</samp>&rsquo; in the
echo area.
</p>
<p>You should always call this function and not hope for
<code class="code">progress-reporter-update</code> to print &lsquo;<samp class="samp">100%</samp>&rsquo;.  Firstly, it may
never print it, there are many good reasons for this not to happen.
Secondly, &lsquo;<samp class="samp">done</samp>&rsquo; is more explicit.
</p></dd></dl>

<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-dotimes_002dwith_002dprogress_002dreporter"><span class="category-def">Macro: </span><span><strong class="def-name">dotimes-with-progress-reporter</strong> <var class="def-var-arguments">(var count [result]) reporter-or-message body&hellip;</var><a class="copiable-link" href="#index-dotimes_002dwith_002dprogress_002dreporter"> &para;</a></span></dt>
<dd><p>This is a convenience macro that works the same way as <code class="code">dotimes</code>
does, but also reports loop progress using the functions described
above.  It allows you to save some typing.  The argument
<var class="var">reporter-or-message</var> can be either a string or a progress
reporter object.
</p>
<p>You can rewrite the example in the beginning of this subsection using
this macro as follows:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(dotimes-with-progress-reporter
    (k 500)
    &quot;Collecting some mana for Emacs...&quot;
  (sit-for 0.01))
</pre></div></div>

<p>Using a reporter object as the <var class="var">reporter-or-message</var> argument is
useful if you want to specify the optional arguments in
<var class="var">make-progress-reporter</var>.  For instance, you can write the
previous example as follows:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(dotimes-with-progress-reporter
    (k 500)
    (make-progress-reporter &quot;Collecting some mana for Emacs...&quot; 0 500 0 1 1.5)
  (sit-for 0.01))
</pre></div></div>
</dd></dl>

<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-dolist_002dwith_002dprogress_002dreporter"><span class="category-def">Macro: </span><span><strong class="def-name">dolist-with-progress-reporter</strong> <var class="def-var-arguments">(var list [result]) reporter-or-message body&hellip;</var><a class="copiable-link" href="#index-dolist_002dwith_002dprogress_002dreporter"> &para;</a></span></dt>
<dd><p>This is another convenience macro that works the same way as <code class="code">dolist</code>
does, but also reports loop progress using the functions described
above.  As in <code class="code">dotimes-with-progress-reporter</code>,
<code class="code">reporter-or-message</code> can be a progress reporter or a string.
You can rewrite the previous example with this macro as follows:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(dolist-with-progress-reporter
    (k (number-sequence 0 500))
    &quot;Collecting some mana for Emacs...&quot;
  (sit-for 0.01))
</pre></div></div>
</dd></dl>

<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-with_002ddelayed_002dmessage"><span class="category-def">Macro: </span><span><strong class="def-name">with-delayed-message</strong> <var class="def-var-arguments">(timeout message) body&hellip;</var><a class="copiable-link" href="#index-with_002ddelayed_002dmessage"> &para;</a></span></dt>
<dd><p>Sometimes it&rsquo;s unclear whether an operation will take a long time to
execute or not, or it can be inconvenient to implement a progress
reporter.  This macro can be used in those situations.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(with-delayed-message (2 (format &quot;Gathering data for %s&quot; entry))
  (setq data (gather-data entry)))
</pre></div>

<p>In this example, if the body takes more than two seconds to execute,
the message will be displayed.  If it takes a shorter time than that,
the message won&rsquo;t be displayed.  In either case, the body is evaluated
as normally, and the return value of the final element in the body is
the return value of the macro.
</p>
<p>The <var class="var">message</var> element is evaluated before <var class="var">body</var>, and is
always evaluated, whether the message is displayed or not.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Logging-Messages.html">Logging Messages in <samp class="file">*Messages*</samp></a>, Previous: <a href="Displaying-Messages.html">Displaying Messages in the Echo Area</a>, Up: <a href="The-Echo-Area.html">The Echo Area</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
