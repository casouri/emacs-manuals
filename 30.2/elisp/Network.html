<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 30.2.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Network (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Network (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Network (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Processes.html" rel="up" title="Processes">
<link href="Network-Servers.html" rel="next" title="Network Servers">
<link href="Transaction-Queues.html" rel="prev" title="Transaction Queues">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Network">
<div class="nav-panel">
<p>
Next: <a href="Network-Servers.html" accesskey="n" rel="next">Network Servers</a>, Previous: <a href="Transaction-Queues.html" accesskey="p" rel="prev">Transaction Queues</a>, Up: <a href="Processes.html" accesskey="u" rel="up">Processes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Network-Connections"><span>41.14 Network Connections<a class="copiable-link" href="#Network-Connections"> &para;</a></span></h3>
<a class="index-entry-id" id="index-network-connection"></a>
<a class="index-entry-id" id="index-TCP"></a>
<a class="index-entry-id" id="index-UDP"></a>

<p>Emacs Lisp programs can open stream (TCP) and datagram (UDP) network
connections (see <a class="pxref" href="Datagrams.html">Datagrams</a>) to other processes on the same machine
or other machines.
A network connection is handled by Lisp much like a subprocess, and is
represented by a process object.  However, the process you are
communicating with is not a child of the Emacs process, has no
process <abbr class="acronym">ID</abbr>, and you can&rsquo;t kill it or send it signals.  All you
can do is send and receive data.  <code class="code">delete-process</code> closes the
connection, but does not kill the program at the other end; that
program must decide what to do about closure of the connection.
</p>
<p>Lisp programs can listen for connections by creating network
servers.  A network server is also represented by a kind of process
object, but unlike a network connection, the network server never
transfers data itself.  When it receives a connection request, it
creates a new network connection to represent the connection just
made.  (The network connection inherits certain information, including
the process plist, from the server.)  The network server then goes
back to listening for more connection requests.
</p>
<p>Network connections and servers are created by calling
<code class="code">make-network-process</code> with an argument list consisting of
keyword/argument pairs, for example <code class="code">:server t</code> to create a
server process, or <code class="code">:type 'datagram</code> to create a datagram
connection.  See <a class="xref" href="Low_002dLevel-Network.html">Low-Level Network Access</a>, for details.  You can also use
the <code class="code">open-network-stream</code> function described below.
</p>
<p>To distinguish the different types of processes, the
<code class="code">process-type</code> function returns the symbol <code class="code">network</code> for a
network connection or server, <code class="code">serial</code> for a serial port
connection, <code class="code">pipe</code> for a pipe connection, or <code class="code">real</code> for a
real subprocess.
</p>
<p>The <code class="code">process-status</code> function returns <code class="code">open</code>,
<code class="code">closed</code>, <code class="code">connect</code>, <code class="code">stop</code>, or <code class="code">failed</code> for
network connections.  For a network server, the status is always
<code class="code">listen</code>.  Except for <code class="code">stop</code>, none of those values is
possible for a real subprocess.  See <a class="xref" href="Process-Information.html">Process Information</a>.
</p>
<p>You can stop and resume operation of a network process by calling
<code class="code">stop-process</code> and <code class="code">continue-process</code>.  For a server
process, being stopped means not accepting new connections.  (Up to 5
connection requests will be queued for when you resume the server; you
can increase this limit, unless it is imposed by the operating
system&mdash;see the <code class="code">:server</code> keyword of <code class="code">make-network-process</code>,
<a class="ref" href="Network-Processes.html"><code class="code">make-network-process</code></a>.)  For a network stream connection, being
stopped means not processing input (any arriving input waits until you
resume the connection).  For a datagram connection, some number of
packets may be queued but input may be lost.  You can use the function
<code class="code">process-command</code> to determine whether a network connection or
server is stopped; a non-<code class="code">nil</code> value means yes.
</p>
<a class="index-entry-id" id="index-network-connection_002c-encrypted"></a>
<a class="index-entry-id" id="index-encrypted-network-connections"></a>
<a class="index-entry-id" id="index-TLS-network-connections"></a>
<a class="index-entry-id" id="index-STARTTLS-network-connections"></a>
<p>Emacs can create encrypted network connections, using the built-in
support for the GnuTLS Transport Layer Security Library; see
<a class="uref" href="https://www.gnu.org/software/gnutls/">the GnuTLS project page</a>.
If your Emacs was compiled with GnuTLS support, the function
<code class="code">gnutls-available-p</code> is defined and returns non-<code class="code">nil</code>.  For
more details, see <a data-manual="emacs-gnutls" href="https://www.gnu.org/software/emacs/manual/html_node/emacs-gnutls/index.html#Top">Overview</a> in <cite class="cite">The Emacs-GnuTLS manual</cite>.
The <code class="code">open-network-stream</code> function can transparently handle the
details of creating encrypted connections for you, using whatever
support is available.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-open_002dnetwork_002dstream"><span class="category-def">Function: </span><span><strong class="def-name">open-network-stream</strong> <var class="def-var-arguments">name buffer host service &amp;rest parameters</var><a class="copiable-link" href="#index-open_002dnetwork_002dstream"> &para;</a></span></dt>
<dd><p>This function opens a TCP connection, with optional encryption, and
returns a process object that represents the connection.
</p>
<p>The <var class="var">name</var> argument specifies the name for the process object.  It
is modified as necessary to make it unique.
</p>
<p>The <var class="var">buffer</var> argument is the buffer to associate with the
connection.  Output from the connection is inserted in the buffer,
unless you specify your own filter function to handle the output.  If
<var class="var">buffer</var> is <code class="code">nil</code>, it means that the connection is not
associated with any buffer.
</p>
<p>The arguments <var class="var">host</var> and <var class="var">service</var> specify where to connect to;
<var class="var">host</var> is the host name (a string), and <var class="var">service</var> is the name of
a defined network service (a string) or a port number (an integer like
<code class="code">80</code> or an integer string like <code class="code">&quot;80&quot;</code>).
</p>
<p>The remaining arguments <var class="var">parameters</var> are keyword/argument pairs
that are mainly relevant to encrypted connections:
</p>
<dl class="table">
<dt><code class="code">:nowait <var class="var">boolean</var></code></dt>
<dd><p>If non-<code class="code">nil</code>, try to make an asynchronous connection.
</p>
</dd>
<dt><code class="code">:noquery <var class="var">query-flag</var></code></dt>
<dd><p>Initialize the process query flag to <var class="var">query-flag</var>.
See <a class="xref" href="Query-Before-Exit.html">Querying Before Exit</a>.
</p>
</dd>
<dt><code class="code">:coding <var class="var">coding</var></code></dt>
<dd><p>Use this to set the coding systems used by the network process, in
preference to binding <code class="code">coding-system-for-read</code> or
<code class="code">coding-system-for-write</code>.  See <a class="xref" href="Network-Processes.html"><code class="code">make-network-process</code></a>, for
details.
</p>
</dd>
<dt><code class="code">:type <var class="var">type</var></code></dt>
<dd><p>The type of connection.  Options are:
</p>
<dl class="table">
<dt><code class="code">plain</code></dt>
<dd><p>An ordinary, unencrypted connection.
</p></dd>
<dt><code class="code">tls</code></dt>
<dt><code class="code">ssl</code></dt>
<dd><p>A <abbr class="acronym">TLS</abbr> (Transport Layer Security) connection.
</p></dd>
<dt><code class="code">nil</code></dt>
<dt><code class="code">network</code></dt>
<dd><p>Start with a plain connection, and if parameters &lsquo;<samp class="samp">:success</samp>&rsquo;
and &lsquo;<samp class="samp">:capability-command</samp>&rsquo; are supplied, try to upgrade to an encrypted
connection via <abbr class="acronym">STARTTLS</abbr>.  If that fails, retain the
unencrypted connection.
</p></dd>
<dt><code class="code">starttls</code></dt>
<dd><p>As for <code class="code">nil</code>, but if <abbr class="acronym">STARTTLS</abbr> fails, drop the connection.
</p></dd>
<dt><code class="code">shell</code></dt>
<dd><p>A shell connection.
</p></dd>
</dl>

</dd>
<dt><code class="code">:always-query-capabilities <var class="var">boolean</var></code></dt>
<dd><p>If non-<code class="code">nil</code>, always ask for the server&rsquo;s capabilities, even when
doing a &lsquo;<samp class="samp">plain</samp>&rsquo; connection.
</p>
</dd>
<dt><code class="code">:capability-command <var class="var">capability-command</var></code></dt>
<dd><p>Command to query the host capabilities.  This can either be a string
(which will then be sent verbatim to the server) or a function
(called with a single parameter: the &ldquo;greeting&rdquo; from the server when
connecting) that should return a string.
</p>
</dd>
<dt><code class="code">:end-of-command <var class="var">regexp</var></code></dt>
<dt><code class="code">:end-of-capability <var class="var">regexp</var></code></dt>
<dd><p>Regular expression matching the end of a command, or the end of the
command <var class="var">capability-command</var>.  The latter defaults to the former.
</p>
</dd>
<dt><code class="code">:starttls-function <var class="var">function</var></code></dt>
<dd><p>Function of one argument (the response to <var class="var">capability-command</var>),
which returns either <code class="code">nil</code> or the command to activate
<abbr class="acronym">STARTTLS</abbr>, if supported.
</p>
</dd>
<dt><code class="code">:success <var class="var">regexp</var></code></dt>
<dd><p>Regular expression matching a successful <abbr class="acronym">STARTTLS</abbr> negotiation.
</p>
</dd>
<dt><code class="code">:use-starttls-if-possible <var class="var">boolean</var></code></dt>
<dd><p>If non-<code class="code">nil</code>, do opportunistic <abbr class="acronym">STARTTLS</abbr> upgrades even if Emacs
doesn&rsquo;t have built-in <abbr class="acronym">TLS</abbr> support.
</p>
</dd>
<dt><code class="code">:warn-unless-encrypted <var class="var">boolean</var></code></dt>
<dd><p>If non-<code class="code">nil</code>, warn the user if the final connection type is not
encrypted.  This is useful for protocols like <abbr class="acronym">IMAP</abbr> and the
like, where most users would expect the network traffic to be encrypted.
This may be due to <abbr class="acronym">STARTTLS</abbr> upgrade failure, specifying
<code class="code">:return-list</code> non-<code class="code">nil</code> allows you to capture any error
encountered.
</p>
</dd>
<dt><a id="index-network_002dstream_002duse_002dclient_002dcertificates"></a><span><code class="code">:client-certificate <var class="var">list-or-t</var></code><a class="copiable-link" href="#index-network_002dstream_002duse_002dclient_002dcertificates"> &para;</a></span></dt>
<dd><p>Either a list of the form <code class="code">(<var class="var">key-file</var> <var class="var">cert-file</var>)</code>,
naming the certificate key file and certificate file itself, or
<code class="code">t</code>, meaning to query <code class="code">auth-source</code> for this information
(see <a data-manual="auth" href="https://www.gnu.org/software/emacs/manual/html_node/auth/Help-for-users.html#Help-for-users">auth-source</a> in <cite class="cite">Emacs auth-source
Library</cite>).  Only used for <abbr class="acronym">TLS</abbr> or <abbr class="acronym">STARTTLS</abbr>.  To
enable automatic queries of <code class="code">auth-source</code> when
<code class="code">:client-certificate</code> is not specified customize
<code class="code">network-stream-use-client-certificates</code> to <code class="code">t</code>.
</p>
</dd>
<dt><code class="code">:return-list <var class="var">cons-or-nil</var></code></dt>
<dd><p>The return value of this function.  If omitted or <code class="code">nil</code>, return a
process object.  Otherwise, a cons of the form
<code class="code">(<var class="var">process-object</var>&nbsp;.&nbsp;<var class="var">plist</var>)</code><!-- /@w -->, where <var class="var">plist</var> can
include the following keywords:
</p>
<dl class="table">
<dt><code class="code">:greeting <var class="var">string-or-nil</var></code></dt>
<dd><p>If non-<code class="code">nil</code>, the greeting string returned by the host.
</p></dd>
<dt><code class="code">:capabilities <var class="var">string-or-nil</var></code></dt>
<dd><p>If non-<code class="code">nil</code>, the host&rsquo;s capability string.
</p></dd>
<dt><code class="code">:type <var class="var">symbol</var></code></dt>
<dd><p>The connection type: &lsquo;<samp class="samp">plain</samp>&rsquo; or &lsquo;<samp class="samp">tls</samp>&rsquo;.
</p></dd>
<dt><code class="code">:error <var class="var">symbol</var></code></dt>
<dd><p>A string describing any error encountered when performing
<abbr class="acronym">STARTTLS</abbr> upgrade.
</p></dd>
</dl>

</dd>
<dt><code class="code">:shell-command <var class="var">string-or-nil</var></code></dt>
<dd><p>If the connection <code class="code">type</code> is <code class="code">shell</code>, this parameter will be
interpreted as a format-spec string (see <a class="pxref" href="Custom-Format-Strings.html">Custom Format Strings</a>)
that will be executed to make the connection.  The specs available are
&lsquo;<samp class="samp">%s</samp>&rsquo; for the host name and &lsquo;<samp class="samp">%p</samp>&rsquo; for the port number.  For
instance, if you want to first ssh to &lsquo;<samp class="samp">gateway</samp>&rsquo; before making a
plain connection, then this parameter&rsquo;s value could be something like
&lsquo;<samp class="samp">ssh gateway nc %s %p</samp>&rsquo;.
</p>
</dd>
</dl>

</dd></dl>


</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Network-Servers.html">Network Servers</a>, Previous: <a href="Transaction-Queues.html">Transaction Queues</a>, Up: <a href="Processes.html">Processes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
