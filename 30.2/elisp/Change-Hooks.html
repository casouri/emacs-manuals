<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 30.2.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Change Hooks (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Change Hooks (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Change Hooks (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Text.html" rel="up" title="Text">
<link href="Atomic-Changes.html" rel="prev" title="Atomic Changes">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Change-Hooks">
<div class="nav-panel">
<p>
Previous: <a href="Atomic-Changes.html" accesskey="p" rel="prev">Atomic Change Groups</a>, Up: <a href="Text.html" accesskey="u" rel="up">Text</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Change-Hooks-1"><span>33.34 Change Hooks<a class="copiable-link" href="#Change-Hooks-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-change-hooks"></a>
<a class="index-entry-id" id="index-hooks-for-text-changes"></a>

<p>These hook variables let you arrange to take notice of changes in
buffers (or in a particular buffer, if you make them buffer-local).
See also <a class="ref" href="Special-Properties.html">Properties with Special Meanings</a>, for how to detect changes to
specific parts of the text.
</p>
<p>The functions you use in these hooks should save and restore the match
data if they do anything that uses regular expressions; otherwise, they
will interfere in bizarre ways with the editing operations that call
them.  In addition, the functions in these hooks should avoid changing
buffer text, faces, properties, overlays, and other aspects of the
buffer-specific state except those that the hook functions themselves
create and manage, because other parts of Emacs might become confused by
such changes behind their back.
</p>
<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-before_002dchange_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">before-change-functions</strong><a class="copiable-link" href="#index-before_002dchange_002dfunctions"> &para;</a></span></dt>
<dd><p>This variable holds a list of functions to call when Emacs is about to
modify a buffer.  Each function gets two arguments, the beginning and
end of the region that is about to change, represented as integers.
The buffer that is about to change is always the current buffer when
the function is called.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-after_002dchange_002dfunctions"><span class="category-def">Variable: </span><span><strong class="def-name">after-change-functions</strong><a class="copiable-link" href="#index-after_002dchange_002dfunctions"> &para;</a></span></dt>
<dd><p>This variable holds a list of functions to call after Emacs modifies a
buffer.  Each function receives three arguments: the beginning and end
of the region just changed, and the length of the text that existed
before the change.  All three arguments are integers.  The buffer that
has been changed is always the current buffer when the function is
called.
</p>
<p>The length of the old text is the difference between the buffer
positions before and after that text as it was before the change.  As
for the changed text, its length is simply the difference between the
first two arguments.
</p></dd></dl>

<p>Output of messages into the <samp class="file">*Messages*</samp> buffer does not call
these functions, and neither do certain internal buffer changes, such
as changes in buffers created by Emacs internally for certain jobs,
that should not be visible to Lisp programs.
</p>
<p>The vast majority of buffer changing primitives will call
<code class="code">before-change-functions</code> and <code class="code">after-change-functions</code> in
balanced pairs, once for each change, where the arguments to these
hooks exactly delimit the change being made.  Yet, hook functions
should not rely on this always being the case, because some complex
primitives call <code class="code">before-change-functions</code> once before making
changes, and then call <code class="code">after-change-functions</code> zero or more
times, depending on how many individual changes the primitive is
making.  When that happens, the arguments to
<code class="code">before-change-functions</code> will enclose a region in which the
individual changes are made, but won&rsquo;t necessarily be the minimal such
region, and the arguments to each successive call of
<code class="code">after-change-functions</code> will then delimit the part of text being
changed exactly.  In general, we advise using either the before- or
the after-change hook, but not both.
</p>
<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-combine_002dafter_002dchange_002dcalls"><span class="category-def">Macro: </span><span><strong class="def-name">combine-after-change-calls</strong> <var class="def-var-arguments">body&hellip;</var><a class="copiable-link" href="#index-combine_002dafter_002dchange_002dcalls"> &para;</a></span></dt>
<dd><p>The macro executes <var class="var">body</var> normally, but arranges to call the
after-change functions just once for a series of several changes&mdash;if
that seems safe.
</p>
<p>If a program makes several text changes in the same area of the buffer,
using the macro <code class="code">combine-after-change-calls</code> around that part of
the program can make it run considerably faster when after-change hooks
are in use.  When the after-change hooks are ultimately called, the
arguments specify a portion of the buffer including all of the changes
made within the <code class="code">combine-after-change-calls</code> body.
</p>
<p><strong class="strong">Warning:</strong> You must not alter the values of
<code class="code">after-change-functions</code> within
the body of a <code class="code">combine-after-change-calls</code> form.
</p>
<p><strong class="strong">Warning:</strong> If the changes you combine occur in widely scattered
parts of the buffer, this will still work, but it is not advisable,
because it may lead to inefficient behavior for some change hook
functions.
</p></dd></dl>

<dl class="first-deffn first-defmac-alias-first-deffn">
<dt class="deffn defmac-alias-deffn" id="index-combine_002dchange_002dcalls"><span class="category-def">Macro: </span><span><strong class="def-name">combine-change-calls</strong> <var class="def-var-arguments">beg end body&hellip;</var><a class="copiable-link" href="#index-combine_002dchange_002dcalls"> &para;</a></span></dt>
<dd><p>This executes <var class="var">body</var> normally, except any buffer changes it makes
do not trigger the calls to <code class="code">before-change-functions</code> and
<code class="code">after-change-functions</code>.  Instead there is a single call of each
of these hooks for the region enclosed by <var class="var">beg</var> and <var class="var">end</var>, the
parameters supplied to <code class="code">after-change-functions</code> reflecting the
changes made to the size of the region by <var class="var">body</var>.
</p>
<p>The result of this macro is the result returned by <var class="var">body</var>.
</p>
<p>This macro is useful when a function makes a possibly large number of
repetitive changes to the buffer, and the change hooks would otherwise
take a long time to run, were they to be run for each individual
buffer modification.  Emacs itself uses this macro, for example, in
the commands <code class="code">comment-region</code> and <code class="code">uncomment-region</code>.
</p>
<p><strong class="strong">Warning:</strong> You must not alter the values of
<code class="code">before-change-functions</code> or <code class="code">after-change-function</code> within
<var class="var">body</var>.
</p>
<p><strong class="strong">Warning:</strong> You must not make any buffer changes outside of the
region specified by <var class="var">beg</var> and <var class="var">end</var>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-first_002dchange_002dhook"><span class="category-def">Variable: </span><span><strong class="def-name">first-change-hook</strong><a class="copiable-link" href="#index-first_002dchange_002dhook"> &para;</a></span></dt>
<dd><p>This variable is a normal hook that is run whenever a buffer is changed
that was previously in the unmodified state.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-inhibit_002dmodification_002dhooks"><span class="category-def">Variable: </span><span><strong class="def-name">inhibit-modification-hooks</strong><a class="copiable-link" href="#index-inhibit_002dmodification_002dhooks"> &para;</a></span></dt>
<dd><p>If this variable is non-<code class="code">nil</code>, all of the change hooks are
disabled; none of them run.  This affects all the hook variables
described above in this section, as well as the hooks attached to
certain special text properties (see <a class="pxref" href="Special-Properties.html">Properties with Special Meanings</a>) and overlay
properties (see <a class="pxref" href="Overlay-Properties.html">Overlay Properties</a>).
</p>
<p>Also, this variable is bound to non-<code class="code">nil</code> while running those
same hook variables, so that by default modifying the buffer from
a modification hook does not cause other modification hooks to be run.
If you do want modification hooks to be run in a particular piece of
code that is itself run from a modification hook, then rebind locally
<code class="code">inhibit-modification-hooks</code> to <code class="code">nil</code>.  However, doing this
may cause recursive calls to the modification hooks, so be sure to
prepare for that (for example, by binding some variable which tells
your hook to do nothing).
</p>
<p>We recommend that you only bind this variable for modifications that
do not result in lasting changes to buffer text contents (for example
face changes or temporary modifications).  If you need to delay change
hooks during a series of changes (typically for performance reasons),
use <code class="code">combine-change-calls</code> or <code class="code">combine-after-change-calls</code>
instead.
</p></dd></dl>


<ul class="mini-toc">
<li><a href="Tracking-changes.html" accesskey="1">Keeping track of buffer modifications</a></li>
</ul>
</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Atomic-Changes.html">Atomic Change Groups</a>, Up: <a href="Text.html">Text</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
