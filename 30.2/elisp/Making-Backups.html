<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 30.2.

Copyright Â© 1990-1996, 1998-2025 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Making Backups (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Making Backups (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Making Backups (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Backup-Files.html" rel="up" title="Backup Files">
<link href="Rename-or-Copy.html" rel="next" title="Rename or Copy">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Making-Backups">
<div class="nav-panel">
<p>
Next: <a href="Rename-or-Copy.html" accesskey="n" rel="next">Backup by Renaming or by Copying?</a>, Up: <a href="Backup-Files.html" accesskey="u" rel="up">Backup Files</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Making-Backup-Files"><span>27.1.1 Making Backup Files<a class="copiable-link" href="#Making-Backup-Files"> &para;</a></span></h4>
<a class="index-entry-id" id="index-making-backup-files"></a>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-backup_002dbuffer"><span class="category-def">Function: </span><span><strong class="def-name">backup-buffer</strong><a class="copiable-link" href="#index-backup_002dbuffer"> &para;</a></span></dt>
<dd><p>This function makes a backup of the file visited by the current
buffer, if appropriate.  It is called by <code class="code">save-buffer</code> before
saving the buffer the first time.
</p>
<p>If a backup was made by renaming, the return value is a cons cell of
the form (<var class="var">modes</var> <var class="var">extra-alist</var> <var class="var">backupname</var>), where
<var class="var">modes</var> are the mode bits of the original file, as returned by
<code class="code">file-modes</code> (see <a class="pxref" href="Testing-Accessibility.html">Testing Accessibility</a>), <var class="var">extra-alist</var>
is an alist describing the original file&rsquo;s extended attributes, as
returned by <code class="code">file-extended-attributes</code> (see <a class="pxref" href="Extended-Attributes.html">Extended File Attributes</a>), and <var class="var">backupname</var> is the name of the backup.
</p>
<p>In all other cases (i.e., if a backup was made by copying or if no
backup was made), this function returns <code class="code">nil</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-buffer_002dbacked_002dup"><span class="category-def">Variable: </span><span><strong class="def-name">buffer-backed-up</strong><a class="copiable-link" href="#index-buffer_002dbacked_002dup"> &para;</a></span></dt>
<dd><p>This buffer-local variable says whether this buffer&rsquo;s file has
been backed up on account of this buffer.  If it is non-<code class="code">nil</code>,
the backup file has been written.  Otherwise, the file should be backed
up when it is next saved (if backups are enabled).  This is a
permanent local; <code class="code">kill-all-local-variables</code> does not alter&nbsp;it.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-make_002dbackup_002dfiles"><span class="category-def">User Option: </span><span><strong class="def-name">make-backup-files</strong><a class="copiable-link" href="#index-make_002dbackup_002dfiles"> &para;</a></span></dt>
<dd><p>This variable determines whether or not to make backup files.  If it
is non-<code class="code">nil</code>, then Emacs creates a backup of each file when it is
saved for the first time&mdash;provided that <code class="code">backup-inhibited</code>
is <code class="code">nil</code> (see below).
</p>
<p>The following example shows how to change the <code class="code">make-backup-files</code>
variable only in the Rmail buffers and not elsewhere.  Setting it
<code class="code">nil</code> stops Emacs from making backups of these files, which may
save disk space.  (You would put this code in your init file.)
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">(add-hook 'rmail-mode-hook
          (lambda () (setq-local make-backup-files nil)))
</pre></div></div>
</dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-backup_002denable_002dpredicate"><span class="category-def">Variable: </span><span><strong class="def-name">backup-enable-predicate</strong><a class="copiable-link" href="#index-backup_002denable_002dpredicate"> &para;</a></span></dt>
<dd><p>This variable&rsquo;s value is a function to be called on certain occasions to
decide whether a file should have backup files.  The function receives
one argument, an absolute file name to consider.  If the function returns
<code class="code">nil</code>, backups are disabled for that file.  Otherwise, the other
variables in this section say whether and how to make backups.
</p>
<a class="index-entry-id" id="index-normal_002dbackup_002denable_002dpredicate"></a>
<p>The default value is <code class="code">normal-backup-enable-predicate</code>, which checks
for files in <code class="code">temporary-file-directory</code> and
<code class="code">small-temporary-file-directory</code>.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-backup_002dinhibited"><span class="category-def">Variable: </span><span><strong class="def-name">backup-inhibited</strong><a class="copiable-link" href="#index-backup_002dinhibited"> &para;</a></span></dt>
<dd><p>If this variable is non-<code class="code">nil</code>, backups are inhibited.  It records
the result of testing <code class="code">backup-enable-predicate</code> on the visited file
name.  It can also coherently be used by other mechanisms that inhibit
backups based on which file is visited.  For example, VC sets this
variable non-<code class="code">nil</code> to prevent making backups for files managed
with a version control system.
</p>
<p>This is a permanent local, so that changing the major mode does not lose
its value.  Major modes should not set this variable&mdash;they should set
<code class="code">make-backup-files</code> instead.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-backup_002ddirectory_002dalist"><span class="category-def">User Option: </span><span><strong class="def-name">backup-directory-alist</strong><a class="copiable-link" href="#index-backup_002ddirectory_002dalist"> &para;</a></span></dt>
<dd><p>This variable&rsquo;s value is an alist of filename patterns and backup
directories.  Each element looks like
</p><div class="example smallexample">
<pre class="example-preformatted">(<var class="var">regexp</var> . <var class="var">directory</var>)
</pre></div>

<p>Backups of files with names matching <var class="var">regexp</var> will be made in
<var class="var">directory</var>.  <var class="var">directory</var> may be relative or absolute.  If it is
absolute, so that all matching files are backed up into the same
directory, the file names in this directory will be the full name of the
file backed up with all directory separators changed to &lsquo;<samp class="samp">!</samp>&rsquo; to
prevent clashes.  This will not work correctly if your filesystem
truncates the resulting name.
</p>
<p>For the common case of all backups going into one directory, the alist
should contain a single element pairing &lsquo;<samp class="samp">&quot;.&quot;</samp>&rsquo; with the appropriate
directory.
</p>
<p>If this variable is <code class="code">nil</code> (the default), or it fails to match a
filename, the backup is made in the original file&rsquo;s directory.
</p>
<p>On MS-DOS filesystems without long names this variable is always
ignored.
</p></dd></dl>

<dl class="first-defvr first-defopt-alias-first-defvr">
<dt class="defvr defopt-alias-defvr" id="index-make_002dbackup_002dfile_002dname_002dfunction"><span class="category-def">User Option: </span><span><strong class="def-name">make-backup-file-name-function</strong><a class="copiable-link" href="#index-make_002dbackup_002dfile_002dname_002dfunction"> &para;</a></span></dt>
<dd><p>This variable&rsquo;s value is a function to use for making backup file names.
The function <code class="code">make-backup-file-name</code> calls it.
See <a class="xref" href="Backup-Names.html">Naming Backup Files</a>.
</p>
<p>This could be buffer-local to do something special for specific
files.  If you change it, you may need to change
<code class="code">backup-file-name-p</code> and <code class="code">file-name-sans-versions</code> too.
</p></dd></dl>


</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Rename-or-Copy.html">Backup by Renaming or by Copying?</a>, Up: <a href="Backup-Files.html">Backup Files</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
