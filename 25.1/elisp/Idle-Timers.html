<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 25.1.

Copyright Â© 1990-1996, 1998-2016 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Idle Timers (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Idle Timers (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Idle Timers (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="System-Interface.html" rel="up" title="System Interface">
<link href="Terminal-Input.html" rel="next" title="Terminal Input">
<link href="Timers.html" rel="prev" title="Timers">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span.r {font-family: initial; font-weight: normal; font-style: normal}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="section-level-extent" id="Idle-Timers">
<div class="nav-panel">
<p>
Next: <a href="Terminal-Input.html" accesskey="n" rel="next">Terminal Input</a>, Previous: <a href="Timers.html" accesskey="p" rel="prev">Timers for Delayed Execution</a>, Up: <a href="System-Interface.html" accesskey="u" rel="up">Operating System Interface</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Idle-Timers-1"><span>38.12 Idle Timers<a class="copiable-link" href="#Idle-Timers-1"> &para;</a></span></h3>
<a class="index-entry-id" id="index-idle-timers"></a>

<p>Here is how to set up a timer that runs when Emacs is idle for a
certain length of time.  Aside from how to set them up, idle timers
work just like ordinary timers.
</p>
<dl class="first-deffn">
<dt class="deffn" id="index-run_002dwith_002didle_002dtimer"><span class="category-def">Command: </span><span><strong class="def-name">run-with-idle-timer</strong> <var class="def-var-arguments">secs repeat function &amp;rest args</var><a class="copiable-link" href="#index-run_002dwith_002didle_002dtimer"> &para;</a></span></dt>
<dd><p>Set up a timer which runs the next time Emacs is idle for <var class="var">secs</var>
seconds.  The value of <var class="var">secs</var> may be a number or a value of the type
returned by <code class="code">current-idle-time</code>.
</p>
<p>If <var class="var">repeat</var> is <code class="code">nil</code>, the timer runs just once, the first time
Emacs remains idle for a long enough time.  More often <var class="var">repeat</var> is
non-<code class="code">nil</code>, which means to run the timer <em class="emph">each time</em> Emacs
remains idle for <var class="var">secs</var> seconds.
</p>
<p>The function <code class="code">run-with-idle-timer</code> returns a timer value which you
can use in calling <code class="code">cancel-timer</code> (see <a class="pxref" href="Timers.html">Timers for Delayed Execution</a>).
</p></dd></dl>

<a class="index-entry-id" id="index-idleness"></a>
<p>Emacs becomes <em class="dfn">idle</em> when it starts waiting for user input, and
it remains idle until the user provides some input.  If a timer is set
for five seconds of idleness, it runs approximately five seconds after
Emacs first becomes idle.  Even if <var class="var">repeat</var> is non-<code class="code">nil</code>,
this timer will not run again as long as Emacs remains idle, because
the duration of idleness will continue to increase and will not go
down to five seconds again.
</p>
<p>Emacs can do various things while idle: garbage collect, autosave or
handle data from a subprocess.  But these interludes during idleness do
not interfere with idle timers, because they do not reset the clock of
idleness to zero.  An idle timer set for 600 seconds will run when ten
minutes have elapsed since the last user command was finished, even if
subprocess output has been accepted thousands of times within those ten
minutes, and even if there have been garbage collections and autosaves.
</p>
<p>When the user supplies input, Emacs becomes non-idle while executing the
input.  Then it becomes idle again, and all the idle timers that are
set up to repeat will subsequently run another time, one by one.
</p>
<p>Do not write an idle timer function containing a loop which does a
certain amount of processing each time around, and exits when
<code class="code">(input-pending-p)</code> is non-<code class="code">nil</code>.  This approach seems very
natural but has two problems:
</p>
<ul class="itemize mark-bullet">
<li>It blocks out all process output (since Emacs accepts process output
only while waiting).

</li><li>It blocks out any idle timers that ought to run during that time.
</li></ul>

<p>Similarly, do not write an idle timer function that sets up another
idle timer (including the same idle timer) with <var class="var">secs</var> argument
less than or equal to the current idleness time.  Such a timer will
run almost immediately, and continue running again and again, instead
of waiting for the next time Emacs becomes idle.  The correct approach
is to reschedule with an appropriate increment of the current value of
the idleness time, as described below.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-current_002didle_002dtime"><span class="category-def">Function: </span><span><strong class="def-name">current-idle-time</strong><a class="copiable-link" href="#index-current_002didle_002dtime"> &para;</a></span></dt>
<dd><p>If Emacs is idle, this function returns the length of time Emacs has
been idle, as a list of four integers: <code class="code">(<var class="var">sec-high</var>
<var class="var">sec-low</var> <var class="var">microsec</var> <var class="var">picosec</var>)</code>, using the same format as
<code class="code">current-time</code> (see <a class="pxref" href="Time-of-Day.html">Time of Day</a>).
</p>
<p>When Emacs is not idle, <code class="code">current-idle-time</code> returns <code class="code">nil</code>.
This is a convenient way to test whether Emacs is idle.
</p></dd></dl>

<p>The main use of <code class="code">current-idle-time</code> is when an idle timer
function wants to &ldquo;take a break&rdquo; for a while.  It can set up another
idle timer to call the same function again, after a few seconds more
idleness.  Here&rsquo;s an example:
</p>
<div class="example">
<pre class="example-preformatted">(defvar my-resume-timer nil
  &quot;Timer for `my-timer-function' to reschedule itself, or nil.&quot;)

(defun my-timer-function ()
  ;; <span class="r">If the user types a command while <code class="code">my-resume-timer</code></span>
  ;; <span class="r">is active, the next time this function is called from</span>
  ;; <span class="r">its main idle timer, deactivate <code class="code">my-resume-timer</code>.</span>
  (when my-resume-timer
    (cancel-timer my-resume-timer))
  ...<var class="var">do the work for a while</var>...
  (when <var class="var">taking-a-break</var>
    (setq my-resume-timer
          (run-with-idle-timer
            ;; Compute an idle time <var class="var">break-length</var>
            ;; more than the current value.
            (time-add (current-idle-time) <var class="var">break-length</var>)
            nil
            'my-timer-function))))
</pre></div>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Terminal-Input.html">Terminal Input</a>, Previous: <a href="Timers.html">Timers for Delayed Execution</a>, Up: <a href="System-Interface.html">Operating System Interface</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
