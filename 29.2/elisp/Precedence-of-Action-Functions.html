<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 29.2.

Copyright Â© 1990-1996, 1998-2024 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Precedence of Action Functions (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Precedence of Action Functions (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Precedence of Action Functions (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Displaying-Buffers.html" rel="up" title="Displaying Buffers">
<link href="The-Zen-of-Buffer-Display.html" rel="next" title="The Zen of Buffer Display">
<link href="Choosing-Window-Options.html" rel="prev" title="Choosing Window Options">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Precedence-of-Action-Functions">
<div class="nav-panel">
<p>
Next: <a href="The-Zen-of-Buffer-Display.html" accesskey="n" rel="next">The Zen of Buffer Display</a>, Previous: <a href="Choosing-Window-Options.html" accesskey="p" rel="prev">Additional Options for Displaying Buffers</a>, Up: <a href="Displaying-Buffers.html" accesskey="u" rel="up">Displaying a Buffer in a Suitable Window</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Precedence-of-Action-Functions-1"><span>29.13.5 Precedence of Action Functions<a class="copiable-link" href="#Precedence-of-Action-Functions-1"> &para;</a></span></h4>
<a class="index-entry-id" id="index-precedence-of-buffer-display-action-functions"></a>
<a class="index-entry-id" id="index-execution-order-of-buffer-display-action-functions"></a>
<a class="index-entry-id" id="index-buffer-display-action-functions_002c-precedence"></a>

<p>From the past subsections we already know that <code class="code">display-buffer</code>
must be supplied with a number of display actions (see <a class="pxref" href="Choosing-Window.html">Choosing a Window for Displaying a Buffer</a>) in order to display a buffer.  In a completely uncustomized
Emacs, these actions are specified by
<code class="code">display-buffer-fallback-action</code> in the following order of
precedence: Reuse a window, pop up a new window on the same frame, use
a window previously showing the buffer, use some window and pop up a
new frame.  (Note that the remaining actions named by
<code class="code">display-buffer-fallback-action</code> are void in an uncustomized
Emacs).
</p>
<p>Consider the following form:
</p>
<div class="example">
<pre class="example-preformatted">(display-buffer (get-buffer-create &quot;*foo*&quot;))
</pre></div>

<p>Evaluating this form in the buffer <samp class="file">*scratch*</samp> of an uncustomized
Emacs session will usually fail to reuse a window that shows
<samp class="file">*foo*</samp> already, but succeed in popping up a new window.
Evaluating the same form again will now not cause any visible
changes&mdash;<code class="code">display-buffer</code> reused the window already showing
<samp class="file">*foo*</samp> because that action was applicable and had the highest
precedence among all applicable actions.
</p>
<p>Popping up a new window will fail if there is not enough space on
the selected frame.  In an uncustomized Emacs it typically fails when
there are already two windows on a frame.  For example, if you now
type <kbd class="kbd">C-x&nbsp;1</kbd><!-- /@w --> followed by <kbd class="kbd">C-x&nbsp;2</kbd><!-- /@w --> and evaluate the form
once more, <samp class="file">*foo*</samp> should show up in the lower
window&mdash;<code class="code">display-buffer</code> just used &ldquo;some&rdquo; window.  If, before
typing <kbd class="kbd">C-x&nbsp;2</kbd><!-- /@w --> you had typed <kbd class="kbd">C-x&nbsp;o</kbd><!-- /@w -->, <samp class="file">*foo*</samp>
would have been shown in the upper window because &ldquo;some&rdquo; window
stands for the &ldquo;least recently used&rdquo; window and the selected window
has been least recently used if and only if it is alone on its frame.
</p>
<p>Let&rsquo;s assume you did not type <kbd class="kbd">C-x&nbsp;o</kbd><!-- /@w --> and <samp class="file">*foo*</samp> is
shown in the lower window.  Type <kbd class="kbd">C-x&nbsp;o</kbd><!-- /@w --> to get there followed
by <kbd class="kbd">C-x&nbsp;left</kbd><!-- /@w --> and evaluate the form again.  This should
display <samp class="file">*foo*</samp> in the same, lower window because that window had
already shown <samp class="file">*foo*</samp> previously and was therefore chosen instead
of some other window.
</p>
<p>So far we have only observed the default behavior in an uncustomized
Emacs session.  To see how this behavior can be customized, let&rsquo;s
consider the option <code class="code">display-buffer-base-action</code>.  It provides a
very coarse customization which conceptually affects the display of
<em class="emph">any</em> buffer.  It can be used to supplement the actions supplied
by <code class="code">display-buffer-fallback-action</code> by reordering them or by
adding actions that are not present there but fit more closely the
user&rsquo;s editing practice.   However, it can also be used to change the
default behavior in a more profound way.
</p>
<p>Let&rsquo;s consider a user who, as a rule, prefers to display buffers on
another frame.  Such a user might provide the following customization:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(setopt
 display-buffer-base-action
 '((display-buffer-reuse-window display-buffer-pop-up-frame)
   (reusable-frames . 0)))
</pre></div></div>

<p>This setting will cause <code class="code">display-buffer</code> to first try to find a
window showing the buffer on a visible or iconified frame and, if no
such frame exists, pop up a new frame.  You can observe this behavior
on a graphical system by typing <kbd class="kbd">C-x&nbsp;1</kbd><!-- /@w --> in the window showing
<samp class="file">*scratch*</samp> and evaluating our canonical <code class="code">display-buffer</code>
form.  This will usually create (and give focus to) a new frame whose
root window shows <samp class="file">*foo*</samp>.  Iconify that frame and evaluate the
canonical form again: <code class="code">display-buffer</code> will reuse the window on
the new frame (usually raising the frame and giving it focus too).
</p>
<p>Only if creating a new frame fails, <code class="code">display-buffer</code> will
apply the actions supplied by <code class="code">display-buffer-fallback-action</code>
which means to again try reusing a window, popping up a new window and
so on.  A trivial way to make frame creation fail is supplied by the
following form:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(let ((pop-up-frame-function 'ignore))
  (display-buffer (get-buffer-create &quot;*foo*&quot;)))
</pre></div></div>

<p>We will forget about that form immediately after observing that it
fails to create a new frame and uses a fallback action instead.
</p>
<p>Note that <code class="code">display-buffer-reuse-window</code> appears redundant in
the customization of <code class="code">display-buffer-base-action</code> because it is
already part of <code class="code">display-buffer-fallback-action</code> and should be
tried there anyway.  However, that would fail because due to the
precedence of <code class="code">display-buffer-base-action</code> over
<code class="code">display-buffer-fallback-action</code>, at that time
<code class="code">display-buffer-pop-up-frame</code> would have already won the race.
In fact, this:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(setopt
 display-buffer-base-action
 '(display-buffer-pop-up-frame (reusable-frames . 0)))
</pre></div></div>

<p>would cause <code class="code">display-buffer</code> to <em class="emph">always</em> pop up a new frame
which is probably not what our user wants.
</p>
<p>So far, we have only shown how <em class="emph">users</em> can customize the
default behavior of <code class="code">display-buffer</code>.  Let us now see how
<em class="emph">applications</em> can change the course of <code class="code">display-buffer</code>.
The canonical way to do that is to use the <var class="var">action</var> argument of
<code class="code">display-buffer</code> or a function that calls it, like, for example,
<code class="code">pop-to-buffer</code> (see <a class="pxref" href="Switching-Buffers.html">Switching to a Buffer in a Window</a>).
</p>
<p>Suppose an application wants to display <samp class="file">*foo*</samp> preferably
below the selected window (to immediately attract the attention of the
user to the new window) or, if that fails, in a window at the bottom
of the frame.  It could do that with a call like this:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(display-buffer
 (get-buffer-create &quot;*foo*&quot;)
 '((display-buffer-below-selected display-buffer-at-bottom)))
</pre></div></div>

<p>In order to see how this new, modified form works, delete any frame
showing <samp class="file">*foo*</samp>, type <kbd class="kbd">C-x&nbsp;1</kbd><!-- /@w --> followed by <kbd class="kbd">C-x&nbsp;2</kbd><!-- /@w --> in the
window showing <samp class="file">*scratch*</samp>, and subsequently evaluate that form.
<code class="code">display-buffer</code> should split the upper window, and show
<samp class="file">*foo*</samp> in the new window.  Alternatively, if after <kbd class="kbd">C-x&nbsp;2</kbd><!-- /@w -->
you had typed <kbd class="kbd">C-x&nbsp;o</kbd><!-- /@w -->, <code class="code">display-buffer</code> would have split the
window at the bottom instead.
</p>
<p>Suppose now that, before evaluating the new form, you have made the
selected window as small as possible, for example, by evaluating the
form <code class="code">(fit-window-to-buffer)</code> in that window.  In that case,
<code class="code">display-buffer</code> would have failed to split the selected window
and would have split the frame&rsquo;s root window instead, effectively
displaying <samp class="file">*foo*</samp> at the bottom of the frame.
</p>
<p>In either case, evaluating the new form a second time should reuse
the window already showing <samp class="file">*foo*</samp> since both functions supplied
by the <var class="var">action</var> argument try to reuse such a window first.
</p>
<p>By setting the <var class="var">action</var> argument, an application effectively
overrules any customization of <code class="code">display-buffer-base-action</code>.  Our
user can now either accept the choice of the application, or redouble
by customizing the option <code class="code">display-buffer-alist</code> as follows:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(setopt
 display-buffer-alist
 '((&quot;\\*foo\\*&quot;
    (display-buffer-reuse-window display-buffer-pop-up-frame))))
</pre></div></div>

<p>Trying this with the new, modified form above in a configuration that
does not show <samp class="file">*foo*</samp> anywhere, will display <samp class="file">*foo*</samp> on a
separate frame, completely ignoring the <var class="var">action</var> argument of
<code class="code">display-buffer</code>.
</p>
<p>Note that we didn&rsquo;t care to specify a <code class="code">reusable-frames</code> action
alist entry in our specification of <code class="code">display-buffer-alist</code>.
<code class="code">display-buffer</code> always takes the first one it finds&mdash;in our
case the one specified by <code class="code">display-buffer-base-action</code>.  If we
wanted to use a different specification, for example, to exclude
iconified frames showing <samp class="file">*foo*</samp> from the list of reusable ones,
we would have to specify that separately, however:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(setopt
 display-buffer-alist
 '((&quot;\\*foo\\*&quot;
    (display-buffer-reuse-window display-buffer-pop-up-frame)
    (reusable-frames . visible))))
</pre></div></div>

<p>If you try this, you will notice that repeated attempts to display
<samp class="file">*foo*</samp> will succeed to reuse a frame only if that frame is
visible.
</p>
<p>The above example would allow the conclusion that users customize
<code class="code">display-buffer-alist</code> for the sole purpose to overrule the
<var class="var">action</var> argument chosen by applications.  Such a conclusion would
be incorrect.  <code class="code">display-buffer-alist</code> is the standard option for
users to direct the course of display of specific buffers in a
preferred way regardless of whether the display is also guided by an
<var class="var">action</var> argument.
</p>
<p>We can, however, reasonably conclude that customizing
<code class="code">display-buffer-alist</code> differs from customizing
<code class="code">display-buffer-base-action</code> in two major aspects: it is stronger
because it overrides the <var class="var">action</var> argument of
<code class="code">display-buffer</code>, and it allows to explicitly specify the
affected buffers.  In fact, displaying other buffers is not affected
in any way by a customization for <samp class="file">*foo*</samp>.  For example,
</p>
<div class="example">
<pre class="example-preformatted">(display-buffer (get-buffer-create &quot;*bar*&quot;))
</pre></div>

<p>continues being governed by the settings of
<code class="code">display-buffer-base-action</code> and
<code class="code">display-buffer-fallback-action</code> only.
</p>
<p>We could stop with our examples here but Lisp programs still have
an ace up their sleeves which they can use to overrule any
customization of <code class="code">display-buffer-alist</code>.  It&rsquo;s the variable
<code class="code">display-buffer-overriding-action</code> which they can bind around
<code class="code">display-buffer</code> calls as follows:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(let ((display-buffer-overriding-action
       '((display-buffer-same-window))))
  (display-buffer
   (get-buffer-create &quot;*foo*&quot;)
   '((display-buffer-below-selected display-buffer-at-bottom))))
</pre></div></div>

<p>Evaluating this form will usually display <samp class="file">*foo*</samp> in the selected
window regardless of the <var class="var">action</var> argument and any user
customizations.  (Usually, an application will not bother to also
provide an <var class="var">action</var> argument.  Here it just serves to illustrate
the fact that it gets overridden.)
</p>
<p>It might be illustrative to look at the list of action functions
<code class="code">display-buffer</code> would have tried to display <samp class="file">*foo*</samp> with
the customizations we provided here.  The list (including comments
explaining who added this and the subsequent elements) is:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(display-buffer-same-window  ;; `display-buffer-overriding-action'
 display-buffer-reuse-window ;; `display-buffer-alist'
 display-buffer-pop-up-frame
 display-buffer-below-selected ;; ACTION argument
 display-buffer-at-bottom
 display-buffer-reuse-window ;; `display-buffer-base-action'
 display-buffer-pop-up-frame
 display-buffer--maybe-same-window ;; `display-buffer-fallback-action'
 display-buffer-reuse-window
 display-buffer--maybe-pop-up-frame-or-window
 display-buffer-in-previous-window
 display-buffer-use-some-window
 display-buffer-pop-up-frame)
</pre></div></div>

<p>Note that among the internal functions listed here,
<code class="code">display-buffer--maybe-same-window</code> is effectively ignored while
<code class="code">display-buffer--maybe-pop-up-frame-or-window</code> actually runs
<code class="code">display-buffer-pop-up-window</code>.
</p>
<p>The action alist passed in each function call is:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">((reusable-frames . visible)
 (reusable-frames . 0))
</pre></div></div>

<p>which shows that we have used the second specification of
<code class="code">display-buffer-alist</code> above, overriding the specification
supplied by <code class="code">display-buffer-base-action</code>.  Suppose our user had
written that as
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(setopt
 display-buffer-alist
 '((&quot;\\*foo\\*&quot;
    (display-buffer-reuse-window display-buffer-pop-up-frame)
    (inhibit-same-window . t)
    (reusable-frames . visible))))
</pre></div></div>

<p>In this case the <code class="code">inhibit-same-window</code> alist entry will
successfully invalidate the <code class="code">display-buffer-same-window</code>
specification from <code class="code">display-buffer-overriding-action</code> and
<code class="code">display-buffer</code> will show <samp class="file">*foo*</samp> on another frame.  To
make <code class="code">display-buffer-overriding-action</code> more robust in this
regard, the application would have to specify an appropriate
<code class="code">inhibit-same-window</code> entry too, for example, as follows:
</p>
<div class="example">
<div class="group"><pre class="example-preformatted">(let ((display-buffer-overriding-action
       '(display-buffer-same-window (inhibit-same-window . nil))))
  (display-buffer (get-buffer-create &quot;*foo*&quot;)))
</pre></div></div>

<p>This last example shows that while the precedence order of action
functions is fixed, as described in <a class="ref" href="Choosing-Window.html">Choosing a Window for Displaying a Buffer</a>, an action
alist entry specified by a display action ranked lower in that order
can affect the execution of a higher ranked display action.
</p>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="The-Zen-of-Buffer-Display.html">The Zen of Buffer Display</a>, Previous: <a href="Choosing-Window-Options.html">Additional Options for Displaying Buffers</a>, Up: <a href="Displaying-Buffers.html">Displaying a Buffer in a Suitable Window</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
