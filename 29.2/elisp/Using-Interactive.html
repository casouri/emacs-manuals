<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 29.2.

Copyright Â© 1990-1996, 1998-2024 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<title>Using Interactive (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Using Interactive (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Using Interactive (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Defining-Commands.html" rel="up" title="Defining Commands">
<link href="Interactive-Codes.html" rel="next" title="Interactive Codes">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
ul.mark-bullet {list-style-type: disc}
-->
</style>
<link rel="stylesheet" type="text/css" href="./manual.css">


</head>

<body lang="en">
<div class="subsection-level-extent" id="Using-Interactive">
<div class="nav-panel">
<p>
Next: <a href="Interactive-Codes.html" accesskey="n" rel="next">Code Characters for <code class="code">interactive</code></a>, Up: <a href="Defining-Commands.html" accesskey="u" rel="up">Defining Commands</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Using-interactive"><span>22.2.1 Using <code class="code">interactive</code><a class="copiable-link" href="#Using-interactive"> &para;</a></span></h4>
<a class="index-entry-id" id="index-arguments_002c-interactive-entry"></a>
<a class="index-entry-id" id="index-interactive-spec_002c-using"></a>

<p>This section describes how to write the <code class="code">interactive</code> form that
makes a Lisp function an interactively-callable command, and how to
examine a command&rsquo;s <code class="code">interactive</code> form.
</p>
<dl class="first-deffn first-defspec-alias-first-deffn">
<dt class="deffn defspec-alias-deffn" id="index-interactive"><span class="category-def">Special Form: </span><span><strong class="def-name">interactive</strong> <var class="def-var-arguments">&amp;optional arg-descriptor &amp;rest modes</var><a class="copiable-link" href="#index-interactive"> &para;</a></span></dt>
<dd><p>This special form declares that a function is a command, and that it
may therefore be called interactively (via <kbd class="kbd">M-x</kbd> or by entering a
key sequence bound to it).  The argument <var class="var">arg-descriptor</var> declares
how to compute the arguments to the command when the command is called
interactively.
</p>
<p>A command may be called from Lisp programs like any other function, but
then the caller supplies the arguments and <var class="var">arg-descriptor</var> has no
effect.
</p>
<a class="index-entry-id" id="index-interactive_002dform_002c-symbol-property"></a>
<p>The <code class="code">interactive</code> form must be located at top-level in the
function body, or in the function symbol&rsquo;s <code class="code">interactive-form</code>
property (see <a class="pxref" href="Symbol-Properties.html">Symbol Properties</a>).  It has its effect because the
command loop looks for it before calling the function
(see <a class="pxref" href="Interactive-Call.html">Interactive Call</a>).  Once the function is called, all its body
forms are executed; at this time, if the <code class="code">interactive</code> form
occurs within the body, the form simply returns <code class="code">nil</code> without
even evaluating its argument.
</p>
<p>The <var class="var">modes</var> list allows specifying which modes the command is
meant to be used in.  See <a class="ref" href="Command-Modes.html">Specifying Modes For Commands</a> for more details about
the effect of specifying <var class="var">modes</var>, and when to use it.
</p>
<p>By convention, you should put the <code class="code">interactive</code> form in the
function body, as the first top-level form.  If there is an
<code class="code">interactive</code> form in both the <code class="code">interactive-form</code> symbol
property and the function body, the former takes precedence.  The
<code class="code">interactive-form</code> symbol property can be used to add an
interactive form to an existing function, or change how its arguments
are processed interactively, without redefining the function.
</p></dd></dl>

<p>There are three possibilities for the argument <var class="var">arg-descriptor</var>:
</p>
<ul class="itemize mark-bullet">
<li>It may be omitted or <code class="code">nil</code>; then the command is called with no
arguments.  This leads quickly to an error if the command requires one
or more arguments.

</li><li>It may be a string; its contents are a sequence of elements separated
by newlines, one for each argument<a class="footnote" id="DOCF16" href="#FOOT16"><sup>16</sup></a>.  Each element consists of a code character
(see <a class="pxref" href="Interactive-Codes.html">Code Characters for <code class="code">interactive</code></a>) optionally followed by a prompt (which
some code characters use and some ignore).  Here is an example:

<div class="example smallexample">
<pre class="example-preformatted">(interactive &quot;P\nbFrobnicate buffer: &quot;)
</pre></div>

<p>The code letter &lsquo;<samp class="samp">P</samp>&rsquo; sets the command&rsquo;s first argument to the raw
command prefix (see <a class="pxref" href="Prefix-Command-Arguments.html">Prefix Command Arguments</a>).  &lsquo;<samp class="samp">bFrobnicate
buffer: </samp>&rsquo; prompts the user with &lsquo;<samp class="samp">Frobnicate buffer: </samp>&rsquo; to enter
the name of an existing buffer, which becomes the second and final
argument.
</p>
<p>The prompt string can use &lsquo;<samp class="samp">%</samp>&rsquo; to include previous argument values
(starting with the first argument) in the prompt.  This is done using
<code class="code">format-message</code> (see <a class="pxref" href="Formatting-Strings.html">Formatting Strings</a>).  For example, here is how
you could read the name of an existing buffer followed by a new name to
give to that buffer:
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">(interactive &quot;bBuffer to rename: \nsRename buffer %s to: &quot;)
</pre></div></div>

<a class="index-entry-id" id="index-_002a-in-interactive"></a>
<a class="index-entry-id" id="index-read_002donly-buffers-in-interactive"></a>
<p>If &lsquo;<samp class="samp">*</samp>&rsquo; appears at the beginning of the string, then an error is
signaled if the buffer is read-only.
</p>
<a class="index-entry-id" id="index-_0040-in-interactive"></a>
<p>If &lsquo;<samp class="samp">@</samp>&rsquo; appears at the beginning of the string, and if the key
sequence used to invoke the command includes any mouse events, then
the window associated with the first of those events is selected
before the command is run.
</p>
<a class="index-entry-id" id="index-_005e-in-interactive"></a>
<a class="index-entry-id" id="index-shift_002dselection_002c-and-interactive-spec"></a>
<p>If &lsquo;<samp class="samp">^</samp>&rsquo; appears at the beginning of the string, and if the command
was invoked through <em class="dfn">shift-translation</em>, set the mark and activate
the region temporarily, or extend an already active region, before the
command is run.  If the command was invoked without shift-translation,
and the region is temporarily active, deactivate the region before the
command is run.  Shift-translation is controlled on the user level by
<code class="code">shift-select-mode</code>; see <a data-manual="emacs" href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Shift-Selection.html#Shift-Selection">Shift Selection</a> in <cite class="cite">The GNU
Emacs Manual</cite>.
</p>
<p>You can use &lsquo;<samp class="samp">*</samp>&rsquo;, &lsquo;<samp class="samp">@</samp>&rsquo;, and <code class="code">^</code> together; the order does
not matter.  Actual reading of arguments is controlled by the rest of
the prompt string (starting with the first character that is not
&lsquo;<samp class="samp">*</samp>&rsquo;, &lsquo;<samp class="samp">@</samp>&rsquo;, or &lsquo;<samp class="samp">^</samp>&rsquo;).
</p>
</li><li>It may be a Lisp expression that is not a string; then it should be a
form that is evaluated to get a list of arguments to pass to the
command.  Usually this form will call various functions to read input
from the user, most often through the minibuffer (see <a class="pxref" href="Minibuffers.html">Minibuffers</a>)
or directly from the keyboard (see <a class="pxref" href="Reading-Input.html">Reading Input</a>).

<p>Providing point or the mark as an argument value is also common, but
if you do this <em class="emph">and</em> read input (whether using the minibuffer or
not), be sure to get the integer values of point or the mark after
reading.  The current buffer may be receiving subprocess output; if
subprocess output arrives while the command is waiting for input, it
could relocate point and the mark.
</p>
<p>Here&rsquo;s an example of what <em class="emph">not</em> to do:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(interactive
 (list (region-beginning) (region-end)
       (read-string &quot;Foo: &quot; nil 'my-history)))
</pre></div>

<p>Here&rsquo;s how to avoid the problem, by examining point and the mark after
reading the keyboard input:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(interactive
 (let ((string (read-string &quot;Foo: &quot; nil 'my-history)))
   (list (region-beginning) (region-end) string)))
</pre></div>

<p><strong class="strong">Warning:</strong> the argument values should not include any data
types that can&rsquo;t be printed and then read.  Some facilities save
<code class="code">command-history</code> in a file to be read in the subsequent
sessions; if a command&rsquo;s arguments contain a data type that prints
using &lsquo;<samp class="samp">#&lt;&hellip;&gt;</samp>&rsquo; syntax, those facilities won&rsquo;t work.
</p>
<p>There are, however, a few exceptions: it is ok to use a limited set of
expressions such as <code class="code">(point)</code>, <code class="code">(mark)</code>,
<code class="code">(region-beginning)</code>, and <code class="code">(region-end)</code>, because Emacs
recognizes them specially and puts the expression (rather than its
value) into the command history.  To see whether the expression you
wrote is one of these exceptions, run the command, then examine
<code class="code">(car command-history)</code>.
</p></li></ul>

<a class="index-entry-id" id="index-examining-the-interactive-form"></a>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-interactive_002dform"><span class="category-def">Function: </span><span><strong class="def-name">interactive-form</strong> <var class="def-var-arguments">function</var><a class="copiable-link" href="#index-interactive_002dform"> &para;</a></span></dt>
<dd><p>This function returns the <code class="code">interactive</code> form of <var class="var">function</var>.
If <var class="var">function</var> is an interactively callable function
(see <a class="pxref" href="Interactive-Call.html">Interactive Call</a>), the value is the command&rsquo;s
<code class="code">interactive</code> form <code class="code">(interactive <var class="var">spec</var>)</code>, which
specifies how to compute its arguments.  Otherwise, the value is
<code class="code">nil</code>.  If <var class="var">function</var> is a symbol, its function definition is
used.
When called on an OClosure, the work is delegated to the generic
function <code class="code">oclosure-interactive-form</code>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-oclosure_002dinteractive_002dform"><span class="category-def">Function: </span><span><strong class="def-name">oclosure-interactive-form</strong> <var class="def-var-arguments">function</var><a class="copiable-link" href="#index-oclosure_002dinteractive_002dform"> &para;</a></span></dt>
<dd><p>Just like <code class="code">interactive-form</code>, this function takes a command and
returns its interactive form.  The difference is that it is a generic
function and it is only called when <var class="var">function</var> is an OClosure
(see <a class="pxref" href="OClosures.html">Open Closures</a>).  The purpose is to make it possible for some
OClosure types to compute their interactive forms dynamically instead
of carrying it in one of their slots.
</p>
<p>This is used for example for <code class="code">kmacro</code> functions in order to
reduce their memory size, since they all share the same interactive
form.  It is also used for <code class="code">advice</code> functions, where the
interactive form is computed from the interactive forms of its
components, so as to make this computation more lazily and to
correctly adjust the interactive form when one of its component&rsquo;s
is redefined.
</p></dd></dl>

</div>
<div class="footnotes-segment">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5 class="footnote-body-heading"><a id="FOOT16" href="#DOCF16">(16)</a></h5>
<p>Some elements actually
supply two arguments.</p>
</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Interactive-Codes.html">Code Characters for <code class="code">interactive</code></a>, Up: <a href="Defining-Commands.html">Defining Commands</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
